Ext.ux.AbstractScheduleSelectionModel=function(){this.locked=false;Ext.ux.AbstractScheduleSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.AbstractScheduleSelectionModel,Ext.util.Observable,{init:function(a){this.schedule=a;this.initEvents()},lock:function(){this.locked=true},unlock:function(){this.locked=false},isLocked:function(){return this.locked}});Ext.ux.ScheduleRowSelectionModel=function(a){Ext.apply(this,a);this.selections=new Ext.util.MixedCollection(false,function(b){return b.id});this.last=false;this.lastActive=false;this.addEvents("selectionchange","beforerowselect","rowselect","rowdeselect");Ext.ux.ScheduleRowSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.ScheduleRowSelectionModel,Ext.ux.AbstractScheduleSelectionModel,{singleSelect:false,initEvents:function(){this.schedule.on("rowmousedown",this.handleMouseDown,this);this.rowNav=new Ext.KeyNav(this.schedule.getScheduleEl(),{up:function(c){if(!c.shiftKey){this.selectPrevious(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive-1);this.schedule.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},down:function(c){if(!c.shiftKey){this.selectNext(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive+1);this.schedule.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},scope:this});var a=this.schedule.view;a.on("refresh",this.onRefresh,this);a.on("rowupdated",this.onRowUpdated,this);a.on("rowremoved",this.onRemove,this)},onRefresh:function(){var f=this.schedule.store,b;var d=this.getSelections();this.clearSelections(true);for(var c=0,a=d.length;c<a;c++){var e=d[c];if((b=f.indexOfId(e.id))!=-1){this.selectRow(b,true)}}if(d.length!=this.selections.getCount()){this.fireEvent("selectionchange",this)}},onRemove:function(a,b,c){if(this.selections.remove(c)!==false){this.fireEvent("selectionchange",this)}},onRowUpdated:function(a,b,c){if(this.isSelected(c)){a.onRowSelect(b)}},selectRecords:function(b,e){if(!e){this.clearSelections()}var d=this.schedule.store;for(var c=0,a=b.length;c<a;c++){this.selectRow(d.indexOf(b[c]),true)}},getCount:function(){return this.selections.length},selectFirstRow:function(){this.selectRow(0)},selectLastRow:function(a){this.selectRow(this.schedule.store.getCount()-1,a)},selectNext:function(a){if(this.hasNext()){this.selectRow(this.last+1,a);this.schedule.getView().focusRow(this.last);return true}return false},selectPrevious:function(a){if(this.hasPrevious()){this.selectRow(this.last-1,a);this.schedule.getView().focusRow(this.last);return true}return false},hasNext:function(){return this.last!==false&&(this.last+1)<this.schedule.store.getCount()},hasPrevious:function(){return !!this.last},getSelections:function(){return[].concat(this.selections.items)},getSelected:function(){return this.selections.itemAt(0)},each:function(e,d){var c=this.getSelections();for(var b=0,a=c.length;b<a;b++){if(e.call(d||this,c[b],b)===false){return false}}return true},clearSelections:function(a){if(this.locked){return}if(a!==true){var c=this.schedule.store;var b=this.selections;b.each(function(d){this.deselectRow(c.indexOfId(d.id))},this);b.clear()}else{this.selections.clear()}this.last=false},selectAll:function(){if(this.locked){return}this.selections.clear();for(var b=0,a=this.schedule.store.getCount();b<a;b++){this.selectRow(b,true)}},hasSelection:function(){return this.selections.length>0},isSelected:function(a){var b=typeof a=="number"?this.schedule.store.getAt(a):a;return(b&&this.selections.key(b.id)?true:false)},isIdSelected:function(a){return(this.selections.key(a)?true:false)},handleMouseDown:function(d,h,f){if(f.button!==0||this.isLocked()){return}var a=this.schedule.getView();if(f.shiftKey&&this.last!==false){var c=this.last;this.selectRange(c,h,f.ctrlKey);this.last=c;a.focusRow(h)}else{var b=this.isSelected(h);if(f.ctrlKey&&b){this.deselectRow(h)}else{if(!b||this.getCount()>1){this.selectRow(h,f.ctrlKey||f.shiftKey);a.focusRow(h)}}}},selectRows:function(c,d){if(!d){this.clearSelections()}for(var b=0,a=c.length;b<a;b++){this.selectRow(c[b],true)}},selectRange:function(b,a,d){if(this.locked){return}if(!d){this.clearSelections()}if(b<=a){for(var c=b;c<=a;c++){this.selectRow(c,true)}}else{for(var c=b;c>=a;c--){this.selectRow(c,true)}}},deselectRange:function(c,b,a){if(this.locked){return}for(var d=c;d<=b;d++){this.deselectRow(d,a)}},selectRow:function(b,d,a){if(this.locked||(b<0||b>=this.schedule.store.getCount())||this.isSelected(b)){return}var c=this.schedule.store.getAt(b);if(c&&this.fireEvent("beforerowselect",this,b,d,c)!==false){if(!d||this.singleSelect){this.clearSelections()}this.selections.add(c);this.last=this.lastActive=b;if(!a){this.schedule.getView().onRowSelect(b)}this.fireEvent("rowselect",this,b,c);this.fireEvent("selectionchange",this)}},deselectRow:function(b,a){if(this.locked){return}if(this.last==b){this.last=false}if(this.lastActive==b){this.lastActive=false}var c=this.schedule.store.getAt(b);if(c){this.selections.remove(c);if(!a){this.schedule.getView().onRowDeselect(b)}this.fireEvent("rowdeselect",this,b,c);this.fireEvent("selectionchange",this)}},restoreLast:function(){if(this._last){this.last=this._last}}});Ext.ux.ScheduleModel=function(a){this.title="Schedule";this.titleRenderer=function(){return this.title};this.labelDataIndex=undefined;this.labelRenderer=undefined;this.labelWidth=250;this.activityDataIndex=undefined;this.activityRenderer=undefined;this.idIndex=undefined;this.parentDataIndex=undefined;this.colorDataIndex=undefined;this.startDate=undefined;this.endDate=undefined;this.dateFormat="Y-m-d H:i";Ext.apply(this,a);if(typeof this.startDate==="string"){this.startDate=Date.parseDate(this.startDate,this.dateFormat)}if(typeof this.endDate==="string"){this.endDate=Date.parseDate(this.endDate,this.dateFormat)}};Ext.ux.TimelineModel=function(a){if(!Ext.ux.TimelineModel.MINUTE){Ext.ux.TimelineModel.MINUTE=0;Ext.ux.TimelineModel.HOUR=1;Ext.ux.TimelineModel.DAY=2;Ext.ux.TimelineModel.MONTH=3;Ext.ux.TimelineModel.YEAR=4}this.defaultTimeUnitWidth=20;this.initial=true;this.addEvents("configchange");this.setConfig(a,true);Ext.ux.TimelineModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.TimelineModel,Ext.util.Observable,{setConfig:function(b,a){this.config=b;this.pixelsPerMinute=null;this.timelines=[null,null,null,null,null];for(var d=0;d<b.length;d++){var f=b[d];if(typeof f.renderer=="string"){f.renderer=Ext.util.Format[f.renderer]}if(!f.interval){f.interval=1}if(typeof f.timeUnit==="string"){var e=Ext.ux.TimelineModel[f.timeUnit];f.timeUnitValue=e?e:0}this.timelines[f.timeUnitValue]=f}for(var d=0;d<5;d++){if(this.timelines[d]!=null){this.timelines[d].width=this.timelines[d].width||this.defaultTimeUnitWidth;break}}if(!a){this.fireEvent("configchange",this)}},getMinuteTimelineConfig:function(d,g){if(!this.timelines[0]){return null}if(!Ext.isDate(d)){d=new Date(d)}if(!Ext.isDate(g)){g=new Date(g)}var j=this.dateToObject(d);var h=this.dateToObject(g);var k=this.timelines[0];if(k.interval!==1){j.m=this.getFirstInterval(0,k.interval,j.m,60)}var c=new Date(j.yy,j.mm,j.dd,j.hh,j.m);var i=new Date(h.yy,h.mm,h.dd,h.hh,h.m);var a=c.getElapsed(i);var b=a/60000;var f=b/k.interval;if(b%k.interval!=0){f++}this.startDate=c;var e={startDate:c,startSpan:1,nextDateFn:function(){c=c.add(Date.MINUTE,k.interval);return c},nextDateSpan:1,nextDateCallCount:f,lastDateSpan:1,unitWidth:k.width};return e},getHourTimelineConfig:function(c,g,k){if(!this.timelines[1]){return null}var j=this.dateToObject(c);var h=this.dateToObject(g);var n=this.timelines[1];if(n.interval!==1){j.hh=getFirstInterval(0,n.interval,j.hh,23)}var b=new Date(j.yy,j.mm,j.dd,j.hh,j.m);var i=new Date(h.yy,h.mm,h.dd,h.hh,h.m);var a=b.getElapsed(i);var m=a/3600000;var f=m/n.interval;if(mins%n.interval!=0){f++}var o,l,e;if(!k){o=l=e=1}else{}var d={startDate:b,startSpan:1,nextDateFn:function(){b=b.add(Date.MINUTE,n.interval);return b},nextDateSpan:1,nextDateCallCount:f,lastDateSpan:1};return d},getPixelsPerMinute:function(){if(this.pixelsPerMinute){return this.pixelsPerMinute}var b=this.timelines,a;if(b[0]!=null){a=b[0].width/b[0].interval}else{if(b[1]!=null){a=b[1].width/(b[1].interval*60)}else{if(b[2]!=null){a=b[2].width/(b[2].interval*1440)}}}this.pixelsPerMinute=a;return a},dateToObject:function(a){return{yy:a.getFullYear(),mm:a.getMonth(),dd:a.getDate(),hh:a.getHours(),m:a.getMinutes()}},getFirstInterval:function(g,c,e,a){var f=g,b=-1;for(var d=c;d<a;d+=c){if(e<d){b=f;break}f=b}if(b==-1){b=f}return b},highlight:function(c,a,b){},highlightRange:function(a,c,b){}});Ext.ux.TimelineModel.defaultRenderer=function(a){if(typeof a=="string"&&a.length<1){return"&#160;"}return a};Ext.ux.ScheduleView=function(a){Ext.apply(this,a);this.addEvents("beforerowremoved","beforerowsinserted","beforerefresh","rowremoved","rowsinserted","rowupdated","refresh");Ext.ux.ScheduleView.superclass.constructor.call(this)};Ext.extend(Ext.ux.ScheduleView,Ext.util.Observable,{scrollOffset:19,resizerWidth:2,lineHeight:21,activitySelector:".x-schedule-activity",activitySelectorDepth:4,labelSelector:".x-schedule-lc",labelSelectorDepth:4,dsSorted:false,treeNodeWidth:18,init:function(a){this.schedule=a;this.initTemplates();this.initData(a.store);this.tm=a.timelineModel;this.sm=a.scheduleModel;this.labelWidth=this.sm.labelWidth;this.initUI(a)},initTemplates:function(){var c=this.templates||{};if(!c.master){c.master=new Ext.Template('<div class="x-schedule" hidefocus="true">','<div class="x-schedule-sidePanel" style="position: absolute; top:0; left:0; width:{labelWidth};"  >','<div class="x-schedule-title" ><div class="x-schedule-title-inner" style="width:{titleWidth};">{title}</div><div class="x-schedule-resizer" style="left:{titleWidth};"></div></div>','<div class="x-schedule-label"><div class="x-schedule-label-inner"  style="width:{labelWidth};"><div class="x-schedule-label-offset">{label}</div></div><div class="x-clear"></div></div>',"</div>",'<div class="x-schedule-timeline" style="left:{timelinePosition};">','<div class="x-schedule-viewport">','<div class="x-schedule-header" ><div class="x-schedule-header-inner"><div class="x-schedule-header-offset">{timelineheader}</div></div><div class="x-clear"></div></div>','<div class="x-schedule-scroller"><div class="x-schedule-body" >{timelinebody}</div><a href="#" class="x-schedule-focus" tabIndex="-1"></a><div class="x-schedule-activities" >{activities}</div><div class="x-schedule-ct" style="left: {ctLeft}; background-color: {ctColor};"></div> </div>',"</div>","</div>",'<div class="x-schedule-resize-marker">&#160;</div>','<div class="x-schedule-resize-proxy">&#160;</div>',"</div>")}if(!c.title){c.title=new Ext.Template("{title}")}if(!c.header){c.header=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0"  style="{tstyle}">','<thead><tr class="x-schedule-hd-row">{cells}</tr></thead>',"</table>")}if(!c.hcell){c.hcell=new Ext.Template('<td class="x-schedule-hd-cell x-schedule-td-{id}" style="{style}" {colspan}><div {tooltip} class="x-schedule-hd-inner x-schedule-hd-{id}" unselectable="on" style="{istyle}">',"{value}</div></td>")}if(!c.label){c.label=new Ext.Template('<div class="x-schedule-lc x-schedule-lc-{id} {alt}" style="{style} height:{height};">{treeNode}<div class="x-schedule-lc-inner" style="left:{lleft};">{value}</div></div>')}if(!c.treeNode){c.treeNode=new Ext.Template('<div class="x-schedule-lc-tree x-schedule-lc-tree-{tree}" style="left:{tleft}; ">&#160;</div>')}if(!c.bstripe){c.bstripe=new Ext.Template('<div class="x-schedule-bstripe x-schedule-bstripe-{id} {css}" style="left: {left}; width: {width}; {style}">{content}</div>')}if(!c.row){c.row=new Ext.Template('<div class="x-schedule-row x-schedule-row-{id}" style="height: {height};">{activities}</div>')}if(!c.activity){c.activity=new Ext.Template('<div class="x-schedule-activity x-schedule-activity-{id}" style="left:{left}; width: {width}; height: {height}; {cstyle}">','<div  {tooltip} class="x-schedule-activity-inner {cls}" style="height: {iheight}; {style}">{value}</div>',"</div>")}for(var a in c){var b=c[a];if(b&&typeof b.compile=="function"&&!b.compiled){b.disableFormats=true;b.compile()}}this.templates=c;this.actRe=new RegExp("x-schedule-activity-([^\\s]+)","");this.tsRe=new RegExp("x-schedule-td-([^\\s]+)","");this.lRe=new RegExp("x-schedule-lc-([^\\s]+)","");this.rowRe=new RegExp("x-schedule-row-([^\\s]+)","")},initData:function(a){if(this.ds){this.ds.un("load",this.onLoad,this);this.ds.un("datachanged",this.onDataChange,this);this.ds.un("add",this.onAdd,this);this.ds.un("remove",this.onRemove,this);this.ds.un("update",this.onUpdate,this);this.ds.un("clear",this.onClear,this)}if(a){a.on("load",this.onLoad,this);a.on("datachanged",this.onDataChange,this);a.on("add",this.onAdd,this);a.on("remove",this.onRemove,this);a.on("update",this.onUpdate,this);a.on("clear",this.onClear,this)}this.ds=a},initUI:function(a){if(a.trackMouseOver){a.on("mouseover",this.onRowOver,this);a.on("mouseout",this.onRowOut,this)}},render:function(){this.renderUI()},renderUI:function(){var e=this.renderTitle();var b=this.renderTimeline();var a=this.renderLabels();var c=this.renderActivities();var d=this.templates.master.apply({title:e,timelineheader:b.timelineheader,timelinebody:b.timelinebody,label:a,labelWidth:this.sm.labelWidth,titleWidth:this.sm.labelWidth-this.resizerWidth,timelineWidth:this.timelineWidth,timelinePosition:this.sm.labelWidth+1,activities:c,ctLeft:-1,ctColor:"#00BB00"});this.schedule.getScheduleEl().dom.innerHTML=d;this.initElements();this.processRows();this.scroller.on("scroll",this.syncScroll,this);this.updateCurrentTimeLocation();this.startCurrentTimeUpdater();new Ext.ux.ScheduleView.SplitDragZone(this.schedule,this.resizer.dom)},renderTitle:function(){var d=this.sm,b=this.templates,a=b.title;var c=d.title;if(d.titleRenderer){c=d.titleRenderer(c)}return a.apply({title:c})},renderTimeline:function(){var q=this.tm,a=this.sm,n=this.templates,m=this.tm.startDate,h=this.tm.endDate;var c=[[],[],[],[],[]];var o=q.getMinuteTimelineConfig(a.startDate,a.endDate);var p=[],l=[],g={},k={},m,j,e=0,b=0;for(var d=-1;d<o.nextDateCallCount;d++){if(d==-1){m=o.startDate;j=o.startSpan}else{if(d==o.nextDateCallCount-1){m=o.nextDateFn();j=o.lastDateSpan}else{m=o.nextDateFn();j=o.nextDateSpan}}g.id="tl-min-"+m.format("mdYHi");g.style="width:"+(o.unitWidth+(Ext.isGecko||Ext.isOpera?-2:0))+"px;overflow:hidden;  ";g.colspan=j==1?"":'colspan="'+j+'"';g.tooltip='ext:qtip="'+m.format(a.dateFormat)+'"';g.istyle="";g.value=q.timelines[0].renderer?q.timelines[0].renderer(m):m.getMinutes();p[p.length]=n.hcell.apply(g);e+=o.unitWidth;k.id="body-"+m.format("mdYHi");k.width=o.unitWidth;k.left=((d+1)*k.width)+1;k.style="border-right: 1px solid #EBEFF2; ";k.style+=(d%2==0)?"background-color: #FAFAFA;":"";l[l.length]=n.bstripe.apply(k)}this.timelineWidth=e;var f={timelineheader:n.header.apply({cells:p.join(""),tstyle:"width:"+e+"px;"}),timelinebody:l.join("")};return f},renderLabels:function(){if(this.ds.getCount()<1){return""}var z=this.sm,p=this.ds,c=this.templates,b=0,w=p.getCount()-1,g=p.getRange(b,w),B=z.parentDataIndex,m=z.idIndex,q=false,i=-1,f=false,t=[],o,h={},s=[],u=0,A,e,d=this.treeNodeWidth;if(B&&this.schedule.enableNesting===true){q=true;if(this.dsSorted==false){this.treeSort()}}var a="";for(var x=0,y=g.length;x<y;x++){o=g[x];if(a!=o.data[z.idIndex]){a=o.data[z.idIndex];u++;if(q){if(t.length==0){t.push(o);i++}else{var l=false;for(var v=t.length-1;v>=0;v--){if(t[v].data[m]==o.data[B]){t.push(o);i++;l=true;break}else{t.pop();i--}}if(!l){t.push(o);i++}}}A=x+1;if(A!=y&&g[A].data[B]==o.data[m]){f=true}else{f=false}h.id=x;h.value=z.labelRenderer?z.labelRenderer(o.data[z.labelDataIndex]):o.data[z.labelDataIndex];h.style="";h.height=this.lineHeight;if(h.value==undefined||h.value===""){h.value="&#160;"}if(f){e={tree:"col",tleft:i*d};h.lleft=e.tleft+d;h.treeNode=c.treeNode.apply(e)}else{h.treeNode=null;h.lleft=(i*d)+d}s[s.length]=c.label.apply(h)}}this.bodyHeight=u*this.lineHeight;return s.join("")},renderActivities:function(){if(this.ds.getCount()<1){return""}var f=this.tm,A=this.sm,o=this.ds,d=this.templates,c=0,w=o.getCount()-1,k=o.getRange(c,w),n,i,t={},B=[],q,u,s,m=this.lineHeight,z=f.getPixelsPerMinute(),l=f.startDate,e,v,b,g;rowac=[];var a="";for(var x=0,y=k.length;x<y;x++){n=k[x];b=n.data[A.startDateIndex];g=n.data[A.endDateIndex];i=false;if(a!=n.data[A.idIndex]&&x!=0){var h={};h.id=x-1;h.height=m+(Ext.isGecko||Ext.isOpera?1:0)+"px";h.activities=rowac.length!=0?rowac.join(""):"";B[B.length]=d.row.apply(h);rowac=[]}a=n.data[A.idIndex];if(b&&b!=""&&g&&g!=""){i=true;if(!Ext.isDate(b)){b=Date.parseDate(b,A.dateFormat)}if(!Ext.isDate(g)){g=Date.parseDate(g,A.dateFormat)}t.id=x+"-0";t.top=x*m;e=l.getElapsed(b)/60000;t.left=e*z;v=b.getElapsed(g)/60000;t.width=(v*z)+"px";if(Ext.isGecko||Ext.isOpera){t.height=(m-1)+"px";t.iheight=(m-2)+"px"}else{t.height=m+"px";t.iheight=(m-1)+"px"}t.cstyle="text-align: center";t.cls=n.data[A.colorDataIndex]!=""?"act-"+n.data[A.colorDataIndex]:"act-blue";u=n.data[A.activityDataIndex];t.value=A.activityRenderer?A.activityRenderer(u,n,x):u;if(t.value==undefined||t.value===""){t.value="&#160;"}t.tooltip='ext:qtip="'+u+'"';rowac[rowac.length]=d.activity.apply(t)}}var h={};h.id=-1;h.height=m+(Ext.isGecko?1:0)+"px";h.activities=rowac.length!=0?rowac.join(""):"";B[B.length]=d.row.apply(h);return B.join("")},initElements:function(){var c=Ext.Element;var a=this.schedule.getScheduleEl().dom.firstChild;var b=a.childNodes;this.el=new c(a,true);this.sidePanel=new c(b[0],true);this.mainTitle=new c(this.sidePanel.dom.childNodes[0],true);this.mainLabel=new c(this.sidePanel.dom.childNodes[1],true);this.timelineArea=new c(b[1],true);this.viewport=new c(this.timelineArea.dom.childNodes[0],true);this.resizeMarker=new c(b[2],true);this.resizeProxy=new c(b[3],true);this.mainHeader=new c(this.viewport.dom.childNodes[0],true);this.innerHeader=this.mainHeader.dom.firstChild;this.headerOffset=new c(this.innerHeader.firstChild,true);this.titleInner=new c(this.mainTitle.dom.childNodes[0],true);this.resizer=new c(this.mainTitle.dom.childNodes[1],true);this.innerLabel=new c(this.mainLabel.dom.childNodes[0],true);this.labelOffset=new c(this.innerLabel.dom.childNodes[0],true);this.scroller=new c(this.viewport.dom.childNodes[1],true);this.mainBody=new c(this.scroller.dom.childNodes[0],true);this.focusEl=new c(this.scroller.dom.childNodes[1],true);this.activitiesArea=new c(this.scroller.dom.childNodes[2],true);this.currentTimeMarker=new c(this.scroller.dom.childNodes[3],true);this.focusEl.swallowEvent("click",true);if(this.schedule.hideHeaders){this.mainHeader.setDisplayed(false);this.mainTitle.setDisplayed(false)}},startCurrentTimeUpdater:function(){if(new Date()<this.sm.endDate){Ext.TaskMgr.start({run:function(){this.updateCurrentTimeLocation()},scope:this,interval:60000})}},layout:function(){if(!this.mainBody){return}var l=this.schedule,h=l.getScheduleEl(),d=h.getSize(true),i=d.width,a=this.labelWidth;if(i<20||d.height<20){return}this.el.setSize(d.width,d.height);var g=this.mainHeader.getHeight();var e=d.height-g;var j=i-a;this.scroller.setSize(j,e);var k=e;if(this.timelineWidth>j){k-=16}var b=Math.max(k,this.bodyHeight);this.mainBody.setHeight(b);this.activitiesArea.setSize(this.timelineWidth,b);this.currentTimeMarker.setHeight(b);if(this.innerHeader){this.innerHeader.style.width=(i)+"px"}this.sidePanel.setWidth(a);this.innerLabel.setSize(a,k);var f=a-this.resizerWidth;this.titleInner.setWidth(f);this.mainTitle.setHeight(g);this.resizer.setLeft(f);this.timelineArea.setLeft(a+1);this.syncHeaderScroll();this.onLayout(i,e)},refresh:function(){this.renderUI();this.layout();this.fireEvent("refresh")},onLayout:function(b,a){},getScrollState:function(){var a=this.scroller.dom;return{left:a.scrollLeft,top:a.scrollTop}},restoreScroll:function(a){var b=this.scroller.dom;b.scrollLeft=a.left;b.scrollTop=a.top},scrollToTop:function(){this.scroller.dom.scrollTop=0;this.scroller.dom.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var a=this.scroller.dom;this.schedule.fireEvent("bodyscroll",a.scrollLeft,a.scrollTop)},syncHeaderScroll:function(){var a=this.scroller.dom;this.innerHeader.scrollLeft=a.scrollLeft;this.innerHeader.scrollLeft=a.scrollLeft;this.innerLabel.dom.scrollTop=a.scrollTop;this.innerLabel.dom.scrollTop=a.scrollTop},getActivityRows:function(){return this.hasRows()?this.activitiesArea.dom.childNodes:[]},getLabelRows:function(){return this.hasRows()?this.labelOffset.dom.childNodes:[]},findLabel:function(a){if(!a){return false}return a.findParent(this.labelSelector,this.labelSelectorDepth)},getRow:function(c){var b=this.getActivityRows();if(b.length>c){return b[c]}return null},getLabel:function(c){var b=this.getLabelRows();if(b.length>c){return b[c]}return null},getFullRow:function(a){return{labelRow:this.getLabel(a),activityRow:this.getRow(a)}},hasRows:function(){var a=this.activitiesArea.dom.firstChild;return a&&a.className!="x-schedule-empty"},getActivity:function(d,a){var b=this.getRow(d),c;if(b){c=b.childNodes[a]}return c||false},findTimelineHeaderId:function(b){var a=Ext.fly(b).findParent(".x-schedule-hd-cell");if(a){return this.getTimelineHeaderId(a)}return false},getTimelineHeaderId:function(b){if(b){var a=b.className.match(this.tsRe);if(a&&a[1]){return a[1]}}return false},findLabelIndex:function(b){var a=Ext.fly(b).findParent(".x-schedule-lc");if(a){return a.rowIndex||this.getLabelIndex(a)}return false},getLabelIndex:function(b){if(b){var a=b.className.match(this.lRe);if(a&&a[1]){return a[1]}}return false},findRowIndex:function(a){var b=Ext.fly(a).findParent(".x-schedule-row");if(b){return b.rowIndex||this.getRowIndex(b)}return false},getRowIndex:function(b){if(b){var a=b.className.match(this.rowRe);if(a&&a[1]){return a[1]}}return false},findActivityIndex:function(c){var b=Ext.fly(c).findParent(".x-schedule-activity");if(b){return this.getActivityIndex(b)}return false},getActivityIndex:function(c,d){if(c){var a=c.className.match(this.actRe);if(a&&a[1]){var e=a[1].indexOf("-"),b=a[1].substring(e+1);if(d===true){var f=a[1].substring(0,e);return{rowIndex:parseInt(f),activityIndex:parseInt(b)}}return parseInt(b)}}return false},fly:function(a){if(!this._flyweight){this._flyweight=new Ext.Element.Flyweight(document.body)}this._flyweight.dom=a;return this._flyweight},treeSort:function(){this.dsSorted=true},updateCurrentTimeLocation:function(){var d=this.sm,a=this.tm,b=new Date();if(b.between(d.startDate,d.endDate)){var c=b.getElapsed(d.startDate)/60000;this.currentTimeMarker.setLeft(c*a.getPixelsPerMinute())}else{this.currentTimeMarker.setLeft(-1)}},addRowClass:function(c,a){var b=this.getRow(c);if(b){this.fly(b).addClass(a)}},removeRowClass:function(c,a){var b=this.getRow(c);if(b){this.fly(b).removeClass(a)}},processRows:function(){var d=this.getLabelRows(),c=this,a;for(var b=0;b<d.length;b++){d[b].rowIndex=b;a=Ext.fly(d[b]).child(".x-schedule-lc-tree");if(a){a.on("click",function(e){c.onTreeNodeClicked(this);e.stopEvent()});d[b].hasChildren=true}Ext.fly(d[b]).addClassOnOver("x-schedule-row-over")}d=this.getActivityRows();for(var b=0;b<d.length;b++){d[b].rowIndex=b;Ext.fly(d[b]).addClassOnOver("x-schedule-row-over")}},collapseRow:function(a){var c=this.getRecordIndex(a);var b=this.getLabel(c);b.isExpanded=false;tn=Ext.fly(b).child(".x-schedule-lc-tree");if(tn){tn.removeClass("x-schedule-lc-tree-col");tn.addClass("x-schedule-lc-tree-exp")}this.changeChildRowDisplay(c,"none")},expandRow:function(b){var d=this.getRecordIndex(b);var c=this.getLabel(d);c.isExpanded=true;var a=Ext.fly(c).child(".x-schedule-lc-tree");if(a){a.removeClass("x-schedule-lc-tree-exp");a.addClass("x-schedule-lc-tree-col")}this.changeChildRowDisplay(d,"block",function(e){return(e.hasChildren&&e.isExpanded===true)})},changeChildRowDisplay:function(b,e,a){var d=this.getChildRecords(b);if(!d){return}for(var c=0;c<d.length;c++){b=this.ds.indexOf(d[c]);row=this.getFullRow(b);Ext.fly(row.labelRow).setStyle("display",e);Ext.fly(row.activityRow).setStyle("display",e);if(!a||a(row.labelRow)){this.changeChildRowDisplay(b,e)}}},getChildRecords:function(j){var b=this.ds,c=this.sm,h=c.parentDataIndex,m=c.idIndex,l=b.getCount()-1,d=b.getRange(j,l),k=d.length,a=[],g,a;if(k<=1){return null}g=d[0].data[m];for(var f=1;f<k;f++){if(d[f].data[h]==g){a.push(d[f])}}return a},getRecordIndex:function(a){var c=this.ds,b;if(typeof a==="number"){return a}else{return c.indexOf(a)}},addActivityClass:function(e,d,c){var b=getActivity(e,d);if(b){this.fly(b).addClass(c)}},removeActivityClass:function(e,d,c){var b=getActivity(e,d);if(b){this.fly(b).removeClass(c)}},focusRow:function(a){this.focusActivity(a,0,false,false)},focusActivity:function(d,c,b){d=Math.min(d,Math.max(0,this.getActivityRows().length-1));var a=this.ensureVisible(d,c,b);this.focusEl.setXY(a||this.scroller.getXY());if(Ext.isGecko){this.focusEl.focus()}else{this.focusEl.focus.defer(1,this.focusEl)}},ensureVisible:function(r,i,f){if(!this.ds){return}if(typeof r!="number"){r=r.rowIndex}if(r<0||r>=this.ds.getCount()){return}i=(i!==undefined?i:0);var j=this.getRow(r),d;if(!(f===false&&i===0)){d=this.getActivity(r,i)}if(!j){return}var m=this.scroller.dom;var q=0;var e=j,n=this.el.dom;while(e&&e!=n){q+=e.offsetTop;e=e.offsetParent}q-=this.mainHeader.dom.offsetHeight;var o=q+j.offsetHeight;var a=m.clientHeight;var n=parseInt(m.scrollTop,10);var l=n+a;if(q<n){m.scrollTop=q}else{if(o>l){m.scrollTop=o-a}}if(f!==false){var k=parseInt(d.offsetLeft,10);var h=k+d.offsetWidth;var g=parseInt(m.scrollLeft,10);var b=g+m.clientWidth;if(k<g){m.scrollLeft=k}else{if(h>b){m.scrollLeft=h-m.clientWidth}}}return d?Ext.fly(d).getXY():[m.scrollLeft+this.el.getX(),Ext.fly(j).getY()]},onActivitySelect:function(a){this.addActivityClass(a,"act-selected")},onActivityDeselect:function(a){this.removeActivityClass(a,"act-selected")},onColumnSplitterMoved:function(a){this.userResized=true;this.labelWidth=this.labelWidth+a-this.resizerWidth;this.layout();this.schedule.fireEvent("labelresize",this.labelWidth)},onLoad:function(){this.scrollToTop()},onDataChange:function(){this.refresh()},onAdd:function(c,a,b){this.refresh()},onRemove:function(d,a,b,c){this.refresh()},onUpdate:function(b,a){},onClear:function(){this.refresh()},onHeaderClick:function(b,a){},onRowOver:function(b,a){},onRowOut:function(b,a){},onTreeNodeClicked:function(c){var a=this.findLabel(c);var b=a.rowIndex;if(Ext.fly(c).hasClass("x-schedule-lc-tree-col")){this.collapseRow(b)}else{this.expandRow(b)}},onRowSelect:function(a){this.addRowClass(a,"x-schedule-row-selected")},onRowDeselect:function(a){this.removeRowClass(a,"x-schedule-row-selected")},onActivitySelect:function(c,a){var b=this.getActivity(c,a);if(b){this.fly(b).addClass("x-schedule-act-selected")}},onActivityDeselect:function(c,a){var b=this.getActivity(c,a);if(b){this.fly(b).removeClass("x-schedule-act-selected")}},onResize:function(){this.layout()}});Ext.ux.ScheduleView.SplitDragZone=function(b,a){this.schedule=b;this.view=b.getView();this.marker=this.view.resizeMarker;this.proxy=this.view.resizeProxy;this.resizer=a;Ext.ux.ScheduleView.SplitDragZone.superclass.constructor.call(this,a,"scheduleSplitters"+this.schedule.getScheduleEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.scroll=false;this.hw=5};Ext.extend(Ext.ux.ScheduleView.SplitDragZone,Ext.dd.DDProxy,{b4StartDrag:function(a,d){var c=this.view.el.getHeight();this.marker.setHeight(c);this.marker.show();this.marker.alignTo(this.resizer,"tl-tr");this.proxy.setHeight(c);var b=this.view.labelWidth-this.schedule.minLabelWidth;this.resetConstraints();this.setXConstraint(b,1000);this.setYConstraint(0,0);this.minX=a-b;this.maxX=a+1000;this.startPos=a;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,a,d)},endDrag:function(d){this.marker.hide();var a=this.view;var b=Math.max(this.minX,d.getPageX());var c=b-this.startPos;a.onColumnSplitterMoved(c)},autoOffset:function(){this.setDelta(0,0)}});Ext.ux.SchedulePanel=Ext.extend(Ext.Panel,{minColumnWidth:25,minLabelWidth:50,enableNesting:true,trackMouseOver:true,loadMask:false,rendered:false,viewReady:false,stateEvents:["timeresize"],initComponent:function(){Ext.ux.SchedulePanel.superclass.initComponent.call(this);this.autoScroll=false;this.autoWidth=false;this.store=Ext.StoreMgr.lookup(this.store);this.addEvents("click","dblclick","contextmenu","mousedown","mouseup","mouseover","mouseout","keypress","keydown")},onRender:function(d,a){Ext.ux.SchedulePanel.superclass.onRender.apply(this,arguments);this.el.addClass("x-schedule-panel");var b=this.getView();b.init(this);var e=this.body;e.on("mousedown",this.onMouseDown,this);e.on("click",this.onClick,this);e.on("dblclick",this.onDblClick,this);e.on("contextmenu",this.onContextMenu,this);e.on("keydown",this.onKeyDown,this);this.relayEvents(e,["mousedown","mouseup","mouseover","mouseout","keypress"]);this.getSelectionModel().init(this);this.view.render()},initEvents:function(){Ext.ux.SchedulePanel.superclass.initEvents.call(this);if(this.loadMask){this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({store:this.store},this.loadMask))}},afterRender:function(){Ext.ux.SchedulePanel.superclass.afterRender.call(this);this.view.layout();this.viewReady=true},onKeyDown:function(a){this.fireEvent("keydown",a)},onDestroy:function(){if(this.rendered){if(this.loadMask){this.loadMask.destroy()}var a=this.body;a.removeAllListeners();this.view.destroy();a.update("")}this.timelineModel.purgeListeners();Ext.ux.SchedulePanel.superclass.onDestroy.call(this)},processEvent:function(f,i){this.fireEvent(f,i);var g=i.getTarget();var c=this.view;var d=c.findLabelIndex(g);if(d!==false){this.fireEvent("label"+f,this,d,i);return}var h=c.findRowIndex(g);if(h!==false){this.fireEvent("row"+f,this,h,i);var b=c.findActivityIndex(g);if(b!==false){this.fireEvent("activity"+f,this,{rowIndex:h,activityIndex:b},i)}}var j=c.findTimelineHeaderId(g);if(j!==false){this.fireEvent("header"+f,this,j,i);return}},onClick:function(a){this.processEvent("click",a)},onMouseDown:function(a){this.processEvent("mousedown",a)},onContextMenu:function(b,a){this.processEvent("contextmenu",b)},onDblClick:function(a){this.processEvent("dblclick",a)},getSelections:function(){return this.selModel.getSelections()},onResize:function(){Ext.ux.SchedulePanel.superclass.onResize.apply(this,arguments);if(this.viewReady){this.view.layout()}},getScheduleEl:function(){return this.body},getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.ux.ScheduleActivitySelectionModel()}return this.selModel},getStore:function(){return this.store},getTimelineModel:function(){if(!this.timelineModel){this.timelineModel=new Ext.ux.TimelineModel()}return this.timelineModel},getView:function(){if(!this.view){this.view=new Ext.ux.ScheduleView(this.viewConfig)}return this.view}});Ext.reg("schedule",Ext.ux.SchedulePanel);