Ext.ns("Ext.ui");Ext.ui.CommonStore=function(d){var c,f,h,e=0,k,g=[];d=Ext.apply(Ext.apply({},this.defaultConfig),d);c=Ext.applyAll(d,d.readerConfig);f=Ext.applyAll(d,d.proxyConfig);d.proxy=d.proxy||(!d.data?new Ext.data.HttpProxy(f):undefined);d.reader=d.reader||new Ext.data.JsonReader(c);if(d.proxy==undefined){d.data=d.data||[];h=d.data;for(e=0;e<h.length;e++){k=h[e];if(Ext.isArray(k)){g.push(this.convertArrayToObject(k,d.fields))}else{g.push(k)}}d.data={};d.data[d.root]=g;d.data[d.totalProperty]=g.length}if(d.id){d.idProperty=d.id;delete d.id}Ext.ui.CommonStore.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ui.CommonStore,Ext.data.Store,{defaultConfig:{autoLoad:true,remoteSort:false,totalProperty:"total",root:"rows",fields:["ID","TEXT"]},convertArrayToObject:function(g,c){var f={},d,e=0;for(e;e<c.length;e++){if(typeof c[e]=="string"){f[c[e]]=g[e]}else{if(typeof c[e]=="object"){f[c[e].name]=g[(typeof c[e].mapping==undefined)?e:c[e].mapping]}}}f.data=g;return f}});Ext.ui.GroupingStore=Ext.extend(Ext.ui.CommonStore,{constructor:function(f){f=f||{};this.hasMultiSort=true;this.multiSortInfo=this.multiSortInfo||{sorters:[]};var g=this.multiSortInfo.sorters,e=f.groupField||this.groupField,d=f.sortInfo||this.sortInfo,c=f.groupDir||this.groupDir;if(e){g.push({field:e,direction:c})}if(d){g.push(d)}Ext.ui.GroupingStore.superclass.constructor.call(this,f);this.addEvents("groupchange");this.applyGroupField()},remoteGroup:false,groupOnSort:false,groupDir:"ASC",clearGrouping:function(){this.groupField=false;if(this.remoteGroup){if(this.baseParams){delete this.baseParams.groupBy;delete this.baseParams.groupDir}var c=this.lastOptions;if(c&&c.params){delete c.params.groupBy;delete c.params.groupDir}this.reload()}else{this.sort();this.fireEvent("datachanged",this)}},groupBy:function(g,c,f){f=f?(String(f).toUpperCase()=="DESC"?"DESC":"ASC"):this.groupDir;if(this.groupField==g&&this.groupDir==f&&!c){return}var e=this.multiSortInfo.sorters;if(e.length>0&&e[0].field==this.groupField){e.shift()}this.groupField=g;this.groupDir=f;this.applyGroupField();var d=function(){this.fireEvent("groupchange",this,this.getGroupState())};if(this.groupOnSort){this.sort(g,f);d.call(this);return}if(this.remoteGroup){this.on("load",d,this,{single:true});this.reload()}else{this.sort(e);d.call(this)}},sort:function(k,e){if(this.remoteSort){return Ext.ui.GroupingStore.superclass.sort.call(this,k,e)}var h=[];if(Ext.isArray(arguments[0])){h=arguments[0]}else{if(k==undefined){h=this.sortInfo?[this.sortInfo]:[]}else{var g=this.fields.get(k);if(!g){return false}var d=g.name,c=this.sortInfo||null,f=this.sortToggle?this.sortToggle[d]:null;if(!e){if(c&&c.field==d){e=(this.sortToggle[d]||"ASC").toggle("ASC","DESC")}else{e=g.sortDir}}this.sortToggle[d]=e;this.sortInfo={field:d,direction:e};h=[this.sortInfo]}}if(this.groupField){h.unshift({direction:this.groupDir,field:this.groupField})}return this.multiSort.call(this,h,e)},applyGroupField:function(){if(this.remoteGroup){if(!this.baseParams){this.baseParams={}}Ext.apply(this.baseParams,{groupBy:this.groupField,groupDir:this.groupDir});var c=this.lastOptions;if(c&&c.params){c.params.groupDir=this.groupDir;delete c.params.groupBy}}},applyGrouping:function(c){if(this.groupField!==false){this.groupBy(this.groupField,true,this.groupDir);return true}else{if(c===true){this.fireEvent("datachanged",this)}return false}},getGroupState:function(){return this.groupOnSort&&this.groupField!==false?(this.sortInfo?this.sortInfo.field:undefined):this.groupField}});Ext.reg("jgroupingstore",Ext.ui.GroupingStore);Ext.ns("Ext.ui");Ext.ui.MappingTreeLoader=Ext.extend(Ext.tree.TreeLoader,{defaultMapping:{id:"id",text:"text",leaf:"leaf",href:"href",nodes:"nodes"},constructor:function(c){c=c||{};c.mapping=Ext.applyIf(c.mapping||{},this.defaultMapping);Ext.ui.MappingTreeLoader.superclass.constructor.call(this,c)},doPreload:function(c){if(this.forceLoading===true){return false}return Ext.ui.MappingTreeLoader.superclass.doPreload.call(this,c)},createNode:function(attr){if(this.baseAttrs){var baseAttrs=this.baseAttrs;if(Ext.isFunction(baseAttrs)){baseAttrs=baseAttrs(attr)}Ext.applyIf(attr,baseAttrs)}if(this.applyLoader!==false&&!attr.loader){attr.loader=this}if(Ext.isString(attr.uiProvider)){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}if(attr.nodeType){return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}else{return attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr)}},isCascaded:function(c){return this.mapping.hasOwnProperty("parent")},getMappingValue:function(d,c){return Ext.isFunction(this.mapping[c])?this.mapping[c](d):d[this.mapping[c]]},wrapNode:function(c){c.id=this.getMappingValue(c,"id");c.text=this.getMappingValue(c,"text");c.leaf=this.getMappingValue(c,"leaf");c.href=this.getMappingValue(c,"href");if(this.isCascaded()){c.parent=c[this.mapping.parent];c.children=[]}return c},sortTree:function(e){var c=Ext.isArray(e)?e:[e];if(Ext.isDefined(this.mapping.sort)){c=this.sortArray(c);for(var d=0;d<c.length;d++){if(c[d].children){c[d].children=this.sortTree(c[d].children)}}}return c},sortArray:function(c){var d=this;return c.sort(function(f,e){return f[d.mapping.sort]-e[d.mapping.sort]})},plainWrap:function(d){for(var c=0;c<d.length;c++){d[c]=this.wrapNode(d[c])}return d},tryFormNodeStructFromData:function(f,c){if(!this.isCascaded()){return this.plainWrap(f)}else{var h={};h[c.id]=this.wrapNode({id:c.id,text:c.text});for(var d=0;d<f.length;d++){var g=this.wrapNode(f[d]);var e=h[g.parent];if(!e){e=this.wrapNode({id:g.parent});h[e.id]=e}h[g.id]=Ext.applyAll(h[g.id]||{},g);e.children.push(h[g.id])}for(obj in h){var g=h[obj];if(g.children.length>0){g.leaf=false}else{g.leaf=true;delete g.children}}return this.sortTree(h[c.id].children)}},processResponse:function(g,f,m,q){var r=g.responseText;try{var c=g.responseData||Ext.decode(r);c=Ext.isArray(c)?c:c[this.mapping.nodes]||[];c=this.tryFormNodeStructFromData(c,f);f.beginUpdate();for(var h=0,k=c.length;h<k;h++){var d=this.createNode(c[h]);if(d){f.appendChild(d)}}f.endUpdate();this.runCallback(m,q||f,[f])}catch(l){this.handleFailure(g)}},processDirectResponse:function(c,d,e){if(d.status){this.handleResponse({responseData:Ext.isArray(c)?c:c[this.mapping.nodes]||[],responseText:c,argument:e})}else{this.handleFailure({argument:e})}}});Ext.ui.AsyncTreePanel=function(c){c=c||{};var d=Ext.applyAll(this.rootConfig,c.rootConfig||{});c.root=this.root||new Ext.tree.AsyncTreeNode(d);var e=c.mapping?Ext.ui.MappingTreeLoader:Ext.tree.TreeLoader;c.loader=this.loader||new e(Ext.applyAll({dataUrl:c.url,mapping:c.mapping,baseAttrs:{uiProvider:(c.checkbox?Ext.ux.TreeCheckNodeUI:false)}},c.loaderConfig||{}));Ext.ui.AsyncTreePanel.superclass.constructor.call(this,c)};Ext.extend(Ext.ui.AsyncTreePanel,Ext.tree.TreePanel,{autoScroll:true,rootConfig:{id:"0",text:"root"},beginForceLoading:function(){this.getLoader().forceLoading=true},endForceLoading:function(){this.getLoader().forceLoading=false},reloadSelectNode:function(e){var d=this;var f=e||d.getSelectionModel().getSelectedNode();if(f){if(f.isLeaf()){var c=f.parentNode;c.reload(function(){var g=c.findChild("id",f.id);d.getSelectionModel().select(c.findChild("id",f.id));g.expand()})}else{d.beginForceLoading();f.reload(function(){d.endForceLoading()})}}}});Ext.reg("asynctreepanel",Ext.ui.AsyncTreePanel);Ext.ns("Ext.ui");Ext.ui.BrowseField=Ext.extend(Ext.form.TriggerField,{initComponent:function(){Ext.ui.BrowseField.superclass.initComponent.call(this);this.on("specialkey",function(c,d){if(d.getKey()==d.ENTER){this.fireEvent("pop",this)}},this);this.addEvents("pop")},triggerClass:"x-form-pop-trigger",onTriggerClick:function(){this.fireEvent("pop",this)}});Ext.reg("browsefield",Ext.ui.BrowseField);Ext.ux.TreeCheckNodeUI=function(){this.checkModel="multiple";this.onlyLeafCheckable=false;Ext.ux.TreeCheckNodeUI.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.TreeCheckNodeUI,Ext.tree.TreeNodeUI,{renderElements:function(f,m,l,o){var q=f.getOwnerTree();this.checkModel=q.checkModel||this.checkModel;this.onlyLeafCheckable=q.onlyLeafCheckable||false;this.indentMarkup=f.parentNode?f.parentNode.ui.getChildIndent():"";var g=(!this.onlyLeafCheckable||m.leaf);var d=m.href?m.href:Ext.isGecko?"":"#";var e=['<li class="x-tree-node"><div ext:tree-node-id="',f.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',m.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',m.icon||this.emptyIcon,'" class="x-tree-node-icon',(m.icon?" x-tree-node-inline-icon":""),(m.iconCls?" "+m.iconCls:""),'" unselectable="on" />',g?('<input class="x-tree-node-cb" type="checkbox" '+(m.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',d,'" tabIndex="1" ',m.hrefTarget?' target="'+m.hrefTarget+'"':"",'><span unselectable="on">',f.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var c;if(o!==true&&f.nextSibling&&(c=f.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",c,e)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",l,e)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var k=this.elNode.childNodes;this.indentNode=k[0];this.ecNode=k[1];this.iconNode=k[2];var h=3;if(g){this.checkbox=k[3];Ext.fly(this.checkbox).on("click",this.check.createDelegate(this,[null]));h++}this.anchor=k[h];this.textNode=k[h].firstChild},check:function(h){var k=this.node;var e=k.getOwnerTree();this.checkModel=e.checkModel||this.checkModel;if(h===null){h=this.checkbox.checked}else{this.checkbox.checked=h}k.attributes.checked=h;e.fireEvent("check",k,h);if(this.checkModel=="single"){var d=e.getChecked();for(var f=0;f<d.length;f++){var g=d[f];if(g.id!=k.id){g.getUI().checkbox.checked=false;g.attributes.checked=false;e.fireEvent("check",g,false)}}}else{if(!this.onlyLeafCheckable){if(this.checkModel=="cascade"||this.checkModel=="parentCascade"){var c=k.parentNode;if(c!==null){this.parentCheck(c,h)}}if(this.checkModel=="cascade"||this.checkModel=="childCascade"){if(!k.expanded&&!k.childrenRendered){k.expand(false,false,this.childCheck)}else{this.childCheck(k)}}else{if(this.checkModel=="free"){e.getChecked()}}}}},childCheck:function(f){var c=f.attributes;if(!c.leaf){var e=f.childNodes;var g;for(var d=0;d<e.length;d++){g=e[d].getUI();if(g.checkbox.checked^c.checked){g.check(c.checked)}}}},parentCheck:function(e,d){var f=e.getUI().checkbox;if(typeof f=="undefined"){return}if(!(d^f.checked)){return}if(!d&&this.childHasChecked(e)){return}f.checked=d;e.attributes.checked=d;e.getOwnerTree().fireEvent("check",e,d);var c=e.parentNode;if(c!==null){this.parentCheck(c,d)}},childHasChecked:function(d){var e=d.childNodes;if(e||e.length>0){for(var c=0;c<e.length;c++){if(e[c].getUI().checkbox.checked){return true}}}return false},toggleCheck:function(e){var c=this.checkbox;if(c){var d=(e===undefined?!c.checked:e);this.check(d)}}});Ext.ux.ComboBoxCheckTree=function(){this.treeId=Ext.id()+"-tree";this.maxHeight=arguments[0].maxHeight||arguments[0].height||this.maxHeight;this.store=new Ext.data.SimpleStore({fields:[],data:[[]]});this.selectedClass="";this.mode="local";this.triggerAction="all";this.onSelect=Ext.emptyFn;this.editable=false;Ext.ux.ComboBoxCheckTree.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.ComboBoxCheckTree,Ext.form.ComboBox,{checkField:"checked",separator:",",initEvents:function(){Ext.ux.ComboBoxCheckTree.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},initComponent:function(){this.on({scope:this})},initList:function(){if(!this.list){var c="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[c,this.listClass].join(" "),constrain:false});var e=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(e);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.title){this.header=this.list.createChild({cls:c+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:c+"-inner"});if(!this.tree.rendered){this.tree.width=e;this.tree.height=this.maxHeight;this.tree.border=false;this.tree.autoScroll=true;if(this.tree.xtype){this.tree=Ext.ComponentMgr.create(this.tree,this.tree.xtype)}this.tree.render(this.innerList);var d=this;this.tree.on("check",function(g,f){d.onTreeCheck()})}if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(k,f,g){this.maxHeight=g-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=f;this.innerList.setWidth(f-this.list.getFrameWidth("lr"));this.restrictHeight()},this)}}},expand:function(){Ext.ux.ComboBoxCheckTree.superclass.expand.call(this);var c=this.tree.getRootNode();if(!c.isLoaded()){c.reload()}},select:function(){},setValue:function(d,e){var c=arguments;if(c.length==1){this.setRawValue(d)}if(c.length==2){this.setRawValue(e)}if(this.hiddenField){this.hiddenField.value=d}this.value=d},beforeBlur:function(){},onTreeCheck:function(){var e=[];var h=[];var d=this.tree.getRootNode();var c=this.tree.getChecked();for(var f=0;f<c.length;f++){var g=c[f];if(this.selectValueModel=="all"||(this.selectValueModel=="leaf"&&g.isLeaf())||(this.selectValueModel=="folder"&&!g.isLeaf())){e.push(g.id);h.push(g.text)}}this.value=e.join(this.separator);this.setRawValue(h.join(this.separator));if(this.hiddenField){this.hiddenField.value=this.value}},getValue:function(){return this.value||""},clearChecked:function(){if(!this.tree.rendered){return}var c=this.tree.getChecked();Ext.each(c,function(d){if(d.attributes.checked){d.attributes.checked=false;if(d.rendered){d.ui.checkbox.checked=false}}})},reset:function(){Ext.ux.ComboBoxCheckTree.superclass.reset.apply(this,arguments);this.clearChecked()},clearValue:function(){this.value="";this.setRawValue(this.value);if(this.hiddenField){this.hiddenField.value=""}this.tree.getSelectionModel().clearSelections()}});Ext.reg("combochecktree",Ext.ux.ComboBoxCheckTree);Ext.ns("Ext.ux.grid");Ext.ux.grid.GridSummary=function(c){Ext.apply(this,c)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(d){this.grid=d;this.cm=d.getColumnModel();this.view=d.getView();var c=this.view;c.onLayout=this.onLayout;c.afterMethod("render",this.refreshSummary,this);c.afterMethod("refresh",this.refreshSummary,this);c.afterMethod("onColumnWidthUpdated",this.doWidth,this);c.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);c.afterMethod("onColumnHiddenUpdated",this.doHidden,this);d.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div           style="overflow-x:hidden;"      class="x-grid3-summary-row ,x-grid3-gridsummary-row-offset" >','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(e,n){var g={},l=n.config;for(var h=0,m=l.length;h<m;h++){var d=l[h],k=d.dataIndex;g[k]=0;if(d.summaryType){for(var f=0,o=e.length;f<o;f++){var c=e[f];g[k]=Ext.ux.grid.GridSummary.Calculations[d.summaryType](c.get(k),c,k,g,f)}}}return g},onLayout:function(c,d){if(Ext.type(d)!="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(d-this.summary.getHeight())}},syncSummaryScroll:function(){var c=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=c.scrollLeft;this.view.summaryWrap.dom.scrollLeft=c.scrollLeft;alert(this.view.summaryWrap.dom.scrollLeft)},doWidth:function(e,c,d){var f=this.view.summary.dom;f.firstChild.style.width=d;f.firstChild.rows[0].childNodes[e].style.width=c},doAllWidths:function(c,d){var g=this.view.summary.dom,h=c.length;g.firstChild.style.width=d;var f=g.firstChild.rows[0].childNodes;for(var e=0;e<h;e++){f[e].style.width=c[e]}},doHidden:function(d,f,c){var e=this.view.summary.dom,g=f?"none":"";e.firstChild.style.width=c;e.firstChild.rows[0].childNodes[d].style.display=g},getColumnDataByName:function(d){var c=this.grid.store.getRange();var f=[];for(var e=0;e<c.length;e++){f.push(c[e].get(d))}return f},renderSummary:function(h,m,r){m=m||this.view.getColumnData();var n=r.config,f=[],s=m.length-1;for(var k=0,o=m.length;k<o;k++){var q=m[k],e=n[k],d={};d.id=q.id;d.style=q.style;d.css=k==0?"x-grid3-cell-first ":(k==s?"x-grid3-cell-last ":"");var g=this.grid.store;var l=e.summaryRenderer;if(l&&g.getTotalCount()>0){if(Ext.type(l)=="string"){l=Ext.ux.grid.GridSummary.Calculations[l]}if(Ext.type(l)=="function"){d.value=l(this.getColumnDataByName(q.name),h,d)}else{d.value=""}}else{d.value=""}if(d.value==undefined||d.value===""){d.value="&#160;"}f[f.length]=this.cellTpl.apply(d)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:f.join("")})},refreshSummary:function(){var k=this.grid,l=k.store,h=this.view.getColumnData(),d=this.cm,e=l.getRange(),f=this.renderSummary(e,h,d);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(f).first();this.view.scroller.setStyle("overflow-x","hidden");var c=this.view;this.view.summary.setStyle("overflow-x","auto");this.view.summary.on("scroll",function(){c.scroller.dom.scrollLeft=c.summary.dom.scrollLeft})},toggleSummary:function(d){var c=this.grid.getGridEl();if(c){if(d===undefined){d=c.hasClass("x-grid-hide-gridsummary")}c[d?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.Calculations={sum:function(g,d,f){var c=0;for(var e=0;e<g.length;e++){c=c+Ext.num(g[e],0)}return c},count:function(e,c,d){return e.length},max:function(g,d,f){var c=0;for(var e=0;e<g.length;e++){c=Math.max(c,Ext.num(g[e],0))}return c},min:function(g,d,f){var c=0;for(var e=0;e<g.length;e++){c=Math.min(c,Ext.num(g[e],0))}return c},average:function(f,d,e){var c=Ext.ux.grid.GridSummary.Calculations.sum.apply(this,arguments);return c/f.length}};if(Ext.ui){Ext.ui.GridSummary=Ext.ux.grid.GridSummary}Ext.ui.ComboBoxTree=function(c){c=c||{};c.tree=c.tree||Ext.applyAll(this.defaultTreeConfig,c.treeConfig||{});if(c.url){Ext.applyIf(c.tree,{url:c.url})}Ext.ui.ComboBoxTree.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ui.ComboBoxTree,Ext.ux.ComboBoxCheckTree,{defaultTreeConfig:{xtype:"asynctreepanel",height:100,checkbox:true,onlyLeafCheckable:false,checkModel:"free",rootConfig:{id:"1",text:"ROOT"}},selectValueModel:"all"});Ext.reg("combotree",Ext.ui.ComboBoxTree);Ext.ns("Ext.ui");Ext.ui.ComboBox=function(c){c=Ext.applyAll(this.defaultConfig,c);c.store=c.store||new Ext.ui.CommonStore(c.storeConfig||{data:[]});Ext.ui.ComboBox.superclass.constructor.call(this,c)};Ext.extend(Ext.ui.ComboBox,Ext.form.ComboBox,{defaultConfig:{typeAhead:true,mode:"local",triggerAction:"all",emptyText:"请选择...",displayField:"TEXT",valueField:"ID",selectFirst:false,selectOnFocus:true},initComponent:function(){Ext.ui.ComboBox.superclass.initComponent.call(this);var c=this;if(this.mode=="local"){if(this.store.getTotalCount()>0){this.on("render",function(){c.setDefault(c.store)})}else{this.store.on("load",this.setDefault,this)}}},onRender:function(){Ext.ui.ComboBox.superclass.onRender.apply(this,arguments);this.el.on("keyup",function(c){if(c.getKey()==Ext.EventObject.BACKSPACE){if(this.getRawValue()==""){this.fireEvent("empty",this)}}},this)},setDefault:function(d){if(!this.selectFirst){return}if(d.getTotalCount()>0){var f;if(typeof this.value!="undefined"&&this.value!=""){f=this.value}else{f=d.getAt(0).get(this.valueField)}this.setValue(f);d.un("load",this.setDefault);var e=this;var c=null;d.each(function(g){if(g.get(e.valueField)==f){c=g}});this.fireEvent("select",this,c)}},setValue:function(e,f){var c=arguments;if(c.length==1){var f=e;if(this.valueField){var d=this.findRecord(this.valueField,e);if(d){f=d.data[this.displayField];e=d.data[this.valueField]}else{if(this.valueNotFoundText!==undefined){f=this.valueNotFoundText}}}this.lastSelectionText=f;if(this.hiddenField){this.hiddenField.value=e}Ext.form.ComboBox.superclass.setValue.call(this,f);this.value=e}else{if(c.length==2){this.value=e;this.setRawValue(f);this.lastSelectionText=f;if(this.hiddenField){this.hiddenField.value=e}}}},reset:function(){Ext.ui.ComboBox.superclass.reset.apply(this,arguments);this.setDefault(this.store)}});Ext.reg("combobox",Ext.ui.ComboBox);Ext.ui.LinkCombo=Ext.extend(Ext.ui.ComboBox,{initComponent:function(){this.afterMethod("initList",this.afterInitList);Ext.ui.LinkCombo.superclass.initComponent.apply(this,arguments)},title:"&nbsp;",linkText:"添加",afterInitList:function(){if(this.header){var c=this.header.getHeight(true);this.header.setStyle("position","relative");var e=this.header.createChild({tag:"a",href:"#",style:"position:absolute;top:3px;right:0;display:inline-block;padding-right:2px;",html:this.linkText});var d=this;e.on("click",function(g,f,h){d.fireEvent("linkClick",g,f,h)})}}});Ext.reg("linkcombo",Ext.ui.LinkCombo);Ext.ns("Ext.ui");Ext.ui.ComBoPanel=function(c){c=c||{};this.maxHeight=c.maxHeight||c.height||this.maxHeight;this.store=new Ext.data.SimpleStore({fields:[],data:[[]]});this.selectedClass="";this.mode="local";this.triggerAction="all";this.onSelect=Ext.emptyFn;var d=c.displayFields||this.displayFields||[];this.initFieldCache(d);Ext.ui.ComBoPanel.superclass.constructor.apply(this,arguments);this._version=0};Ext.extend(Ext.ui.ComBoPanel,Ext.form.ComboBox,{separator:",",forceSelection:true,selectFirstRow:true,initEvents:function(){Ext.ui.ComBoPanel.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},wrapConfig:function(c,e){e=e||function(f){delete f.display};for(var d=0;d<c.length;d++){if(this.fieldCache[c[d].name]){e(c[d])}}return c},initFieldCache:function(d){this.fieldCache={};for(var c=0;c<d.length;c++){this.fieldCache[d[c]]=true}},listPanel:{xtype:"panel",title:"请初始化 listPanel 属性",html:"listPanel配置可以是任何的Panel 或者panel 的子类"},initComponent:function(){Ext.ui.ComBoPanel.superclass.initComponent.apply(this,arguments);this.addEvents("reset");this.queryDelay=500},listIsGrid:false,initList:function(){if(!this.list){var c="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[c,this.listClass].join(" "),constrain:false});var d=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(d);this.list.swallowEvent("mousewheel");this.assetHeight=0;this.innerList=this.list.createChild({cls:c+"-inner"});if(!this.listPanel.rendered){Ext.applyIf(this.listPanel,{width:d,height:this.maxHeight,border:false,autoScroll:true,onQuery:Ext.emptyFn,onRest:Ext.emptyFn});if(this.listPanel.xtype){this.listPanel=Ext.ComponentMgr.create(this.listPanel,this.listPanel.xtype)}if(this.listPanel instanceof Ext.grid.GridPanel){this.listIsGrid=true}this.listPanel.render(this.innerList);this.onlistPanelCreate()}if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(g,e,f){this.maxHeight=f-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=e;this.innerList.setWidth(e-this.list.getFrameWidth("lr"));this.restrictHeight()},this)}}},onlistPanelCreate:function(){var c=this;this.listPanel.getCombo=function(){return c};this.on("reset",this.listPanel.onReset||Ext.emptyFn,this.listPanel);this.on("beforequery",this.listPanel.onQuery||Ext.emptyFn,this.listPanel);if(this.listIsGrid&&this.selectFirstRow){this.listPanel.store.on({load:{fn:function(){this.getSelectionModel().selectFirstRow()},scope:this.listPanel}})}},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{up:function(c){this.inKeyMode=true;this.selectPrev()},down:function(c){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},enter:function(c){this.onViewClick()},esc:function(c){this.collapse()},scope:this,doRelay:function(e,d,c){if(c=="down"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false&&!this.enableKeyEvents){this.el.on("keyup",this.onKeyUp,this)}},onViewClick:function(){this.fireEvent("enter",this,this.listPanel)},selectPrev:function(){if(this.listIsGrid){this.listPanel.getSelectionModel().selectPrevious();var c=this;setTimeout(function(){c.focus()},10)}},selectNext:function(){if(this.listIsGrid){this.listPanel.getSelectionModel().selectNext();var c=this;setTimeout(function(){c.focus()},10)}},select:Ext.emptyFn,beforeBlur:function(){if(this.getValue()==""){this.setRawValue("")}},getCurrentVersion:function(){return this._version},increaseVersion:function(){this._version++;return this._version},setValue:function(e,f,d){if(Ext.type(d)=="number"){if(d<this.getCurrentVersion()){return}}var c=arguments;if(c.length==1){this.setRawValue(e)}if(c.length>=2){this.setRawValue(f)}if(this.hiddenField){this.hiddenField.value=e}this.value=e},getValue:function(){if(Ext.isNotBlank(this.value)){return this.value+""}else{return this.getRawValue()}},validateValue:function(c){if(c.length<1||c===this.emptyText){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(this.hiddenName&&this.hiddenField){if(this.forceSelection&&this.hiddenField.value.length<1){this.markInvalid("你没选中任何值!");return false}}if(c.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(c.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var e=Ext.form.VTypes;if(!e[this.vtype](c,this)){this.markInvalid(this.vtypeText||e[this.vtype+"Text"]);return false}}if(typeof this.validator=="function"){var d=this.validator(c);if(d!==true){this.markInvalid(d);return false}}if(this.regex&&!this.regex.test(c)){this.markInvalid(this.regexText);return false}return true},reset:function(){Ext.ui.ComBoPanel.superclass.reset.apply(this,arguments);this.setRawValue("");if(this.hiddenField){this.hiddenField.value=""}this.value="";this.fireEvent("reset",this)},doQuery:function(e,d){if(e===undefined||e===null){e=""}var c={query:e,forceAll:d,combo:this,cancel:false};e=c.query;d=c.forceAll;if(d===true||(e.length>=this.minChars)){if(this.lastQuery!==e){this.lastQuery=e;if(this.fireEvent("beforequery",c)===false||c.cancel){return false}}}this.expand()}});Ext.reg("combopanel",Ext.ui.ComBoPanel);if("function"!==typeof RegExp.escape){throw ("RegExp.escape function is missing. Include Ext.ux.util.js file.")}Ext.ns("Ext.ui");Ext.ui.MutiComboBox=Ext.extend(Ext.ui.ComboBox,{checkField:"checked",separator:",",constructor:function(c){c=c||{};c.listeners=c.listeners||{};Ext.applyIf(c.listeners,{scope:this,beforequery:this.onBeforeQuery,blur:this.onRealBlur});Ext.ui.MutiComboBox.superclass.constructor.call(this,c)},initComponent:function(){if(!this.tpl){this.tpl='<tpl for="."><div class="x-combo-list-item"><img src="'+Ext.BLANK_IMAGE_URL+'" class="ux-lovcombo-icon ux-lovcombo-icon-{[values.'+this.checkField+'?"checked":"unchecked"]}"><div class="ux-lovcombo-item-text">{'+(this.displayField||"text")+":htmlEncode}</div></div></tpl>"}Ext.ui.MutiComboBox.superclass.initComponent.apply(this,arguments);this.onLoad=this.onLoad.createSequence(function(){if(this.el){var c=this.el.dom.value;this.el.dom.value="";this.el.dom.value=c}})},initEvents:function(){Ext.ui.MutiComboBox.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},clearValue:function(){this.value="";this.setRawValue(this.value);this.store.clearFilter();this.store.each(function(c){c.set(this.checkField,false)},this);if(this.hiddenField){this.hiddenField.value=""}this.applyEmptyText()},getCheckedDisplay:function(){var c=new RegExp(this.separator,"g");return this.getCheckedValue(this.displayField).replace(c,this.separator+" ")},getCheckedValue:function(e){e=e||this.valueField;var f=[];var d=this.store.snapshot||this.store.data;d.each(function(c){if(c.get(this.checkField)){f.push(c.get(e))}},this);return f.join(this.separator)},onBeforeQuery:function(c){c.query=c.query.replace(new RegExp(RegExp.escape(this.getCheckedDisplay())+"[ "+this.separator+"]*"),"")},onRealBlur:function(){this.list.hide();var f=this.getRawValue();var c=f.split(new RegExp(RegExp.escape(this.separator)+" *"));var e=[];var d=this.store.snapshot||this.store.data;Ext.each(c,function(g){d.each(function(h){if(g===h.get(this.displayField)){e.push(h.get(this.valueField))}},this)},this);if(this.forceSelection||e.length>0){this.setValue(e.join(this.separator))}this.store.clearFilter()},onSelect:function(c,d){if(this.fireEvent("beforeselect",this,c,d)!==false){c.set(this.checkField,!c.get(this.checkField));if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent("select",this,c,d)}},setValue:function(c){if(c){c=""+c;if(this.valueField){this.store.clearFilter();this.store.each(function(e){var d=!(!c.match("(^|"+this.separator+")"+RegExp.escape(e.get(this.valueField))+"("+this.separator+"|$)"));e.set(this.checkField,d)},this);this.value=this.getCheckedValue();this.setRawValue(this.getCheckedDisplay());if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=c;this.setRawValue(c);if(this.hiddenField){this.hiddenField.value=c}}if(this.el){this.el.removeClass(this.emptyClass)}}else{this.clearValue()}},selectAll:function(){this.store.each(function(c){c.set(this.checkField,true)},this);this.doQuery(this.allQuery);this.setValue(this.getCheckedValue())},deselectAll:function(){this.clearValue()},beforeBlur:function(){var c=this.getRawValue();if(this.forceSelection){if(c.length>0&&c!=this.emptyText){this.el.dom.value=this.lastSelectionText===undefined?"":this.lastSelectionText;this.applyEmptyText()}else{this.clearValue()}}}});Ext.reg("muticombo",Ext.ui.MutiComboBox);Ext.ns("Ext.ui");Ext.ui.ClearableComboBox=Ext.extend(Ext.ui.ComboBox,{initComponent:function(){Ext.ui.ClearableComboBox.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",style:"padding-right:2px",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-clear-trigger"},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger"}]}},getTrigger:function(c){return this.triggers[c]},onSelect:function(c,d){Ext.ui.ClearableComboBox.superclass.onSelect.call(this,c,d);this.triggers[0].show()},initTrigger:function(){var c=this.trigger.select(".x-form-trigger",true);this.wrap.setStyle("overflow","hidden");var d=this;c.each(function(f,h,e){f.hide=function(){var k=d.wrap.getWidth();this.dom.style.display="none";d.el.setWidth(k-d.trigger.getWidth())};f.show=function(){var k=d.wrap.getWidth();this.dom.style.display="";d.el.setWidth(k-d.trigger.getWidth())};var g="Trigger"+(e+1);if(this["hide"+g]){f.dom.style.display="none"}f.on("click",this["on"+g+"Click"],this,{preventDefault:true});f.addClassOnOver("x-form-trigger-over");f.addClassOnClick("x-form-trigger-click")},this);this.triggers=c.elements;this.triggers[0].hide()},onTrigger1Click:function(){this.reset();this.fireEvent("afterclear",this);this.triggers[0].hide()},onTrigger2Click:function(){this.onTriggerClick()}});Ext.reg("clearablecombo",Ext.ui.ClearableComboBox);Ext.ui.ImageField=Ext.extend(Ext.ui.BrowseField,{autoCreate:{tag:"SPAN",style:"display:inline-block;vertical-align:middle;"},triggerClass:"x-form-pop-trigger x-form-img-pop",setValue:function(c){this.value=c;if(this.rendered){if(c==undefined||c==null){this.img.dom.src=this.defaultUrl||Ext.BLANK_IMAGE_URL;this.hiddenField.dom.value=""}else{this.img.dom.src=c;this.hiddenField.dom.value=c}this.img.on("load",function(){this.fireEvent("imgload")},this,{single:true})}},initComponent:function(){Ext.ui.ImageField.superclass.initComponent.apply(this,arguments);var c=this;this.on("imgload",function(){c.trigger.setStyle({top:(c.el.getHeight()/2-c.trigger.getHeight()/2)})})},initValue:function(){this.setValue(this.value)},getValue:function(){return this.hiddenField.dom.value},getRawValue:function(){return this.hiddenField.dom.value},onRender:function(c){Ext.ui.ImageField.superclass.onRender.apply(this,arguments);this.hiddenField=c.createChild({tag:"input",type:"hidden",name:this.name});this.img=this.el.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,height:this.imgHeight||50,style:"border:1px solid #cfcfcf;"});this.img.on("load",function(){this.fireEvent("imgload")},this,{single:true})},setImgWidth:function(c){if(c){this.img.setWidth(c)}},setWidth:function(c){this.setImgWidth(c);Ext.ui.ImageField.superclass.setWidth.apply(this,arguments)},setSize:function(c,d){if(typeof c=="object"){d=c.height;c=c.width}Ext.ui.ImageField.superclass.setSize.apply(this,arguments);this.setImgWidth(c)}});Ext.reg("imagefield",Ext.ui.ImageField);Ext.ns("Ext.ui");Ext.ui.IPanel=Ext.extend(Ext.Panel,{iftpl:(function(){var c=new Ext.Template();c.set('<iframe id="{id}" name="{id}" scrolling="{scroll}"  marginheight="0" APPLICATION="no"  marginwidth="0" width="100%" height="100%" src="{src}" frameborder="0"></iframe>',true);return c})(),src:Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"about:blank",onRender:function(d,c){Ext.ui.IPanel.superclass.onRender.call(this,d,c);this.createIfrmae()},createIfrmae:function(c){this.iframeId=this.iframeId||("ifm_"+Ext.id());this.iftpl.overwrite(this.body,{id:this.iframeId,src:c||this.src||"#"});var d=this;Ext.get(this.iframeId).on("load",function(){d.fireEvent("load",d.getIframe())},d,{single:true})},loadPage:function(c,e){e=e||Ext.emptyFn;Ext.get(this.iframeId).remove();this.createIfrmae(c);var d=this;this.on("load",function(){e(d.getIframe())},this,{single:true})},maximize:function(){var f=Ext.lib.Dom;var c=f.getViewWidth(),e=f.getViewHeight();var d=Ext.get(this.iframeId);this.restoreConfig={width:d.getWidth(),height:d.getHeight(),position:d.getStyle("position"),"z-index":d.getStyle("z-index")};Ext.getBody().dom.appendChild(d.dom);d.applyStyles({position:"absolute","z-index":2000});d.setSize(c,e);d.center()},restore:function(){var d=Ext.get(this.iframeId);var c=this.restoreConfig;this.body.dom.appendChild(d.dom);if(c){d.applyStyles({position:c.position,"z-index":c["z-index"]});d.setSize(c.width,c.height)}},getIframe:function(){return document.getElementById(this.iframeId).contentWindow}});Ext.reg("ipanel",Ext.ui.IPanel);Ext.ns("Ext.ui");Ext.ui.IWindow=Ext.extend(Ext.Window,{iftpl:(function(){var c=new Ext.Template();c.set('<iframe id="{id}" name="{id}" scrolling="{scroll}"  marginheight="0" APPLICATION="no"  marginwidth="0" width="100%" height="100%" src="{src}" frameborder="0"></iframe>',true);return c})(),src:Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"about:blank",onRender:function(d,c){Ext.ui.IWindow.superclass.onRender.call(this,d,c);this.iframeId=this.iframeId||("ifm_"+Ext.id());this.iftpl.overwrite(this.body,{id:this.iframeId,src:this.src||"#"});var e=this;Ext.get(this.iframeId).on("load",function(){e.fireEvent("load",e.getIframe())},e,{single:true})},getIframe:function(){return document.getElementById(this.iframeId).contentWindow}});Ext.reg("iwindow",Ext.ui.IWindow);Ext.ns("Ext.ui");Ext.ui.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.ui.SearchField.superclass.initComponent.call(this);var c=this;this.on("specialkey",function(d,g){if(g.getKey()==g.ENTER){this.onTrigger2Click();if(c.stopEnterPropagation===true){g.stopEvent()}}},this);this.addEvents("search")},stopEnterPropagation:false,validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,hasSearch:false,paramName:"query",defaultParams:{start:0,limit:10},onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";this.triggers[0].hide();this.hasSearch=false;this.fireEvent("search",this.hasSearch,this)}},onTrigger2Click:function(){var c=this.getRawValue();if(c.length<1){this.onTrigger1Click();return}this.hasSearch=true;this.triggers[0].show();this.fireEvent("search",this.hasSearch,this)},getValue:function(){return new String(Ext.ui.SearchField.superclass.getValue.apply(this,arguments)).trim()}});Ext.reg("searchfield",Ext.ui.SearchField);Ext.ns("Ext.ui");Ext.ui.SelectField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.ui.SelectField.superclass.initComponent.call(this);var c=this;this.on("specialkey",function(d,g){if(g.getKey()==g.ENTER){this.onTrigger2Click();if(c.stopEnterPropagation===true){g.stopEvent()}}},this);this.addEvents("pop")},stopEnterPropagation:false,validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,onTrigger1Click:function(){this.setValue("","");this.triggers[0].hide()},onTrigger2Click:function(){var c=this.getRawValue();if(c.length>1){this.triggers[0].show()}this.fireEvent("pop",this,this)},onRender:function(d,c){Ext.ui.SelectField.superclass.onRender.call(this,d,c);if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.el.dom.removeAttribute("name")}},setValue:function(d,e){var c=arguments;if(c.length==1){this.setRawValue(d)}if(c.length==2){this.setRawValue(e)}if(this.hiddenField){this.hiddenField.value=d}this.value=d},getValue:function(){if(Ext.isNotBlank(this.value)){return this.value+""}else{return this.getRawValue()||""}},validateValue:function(c){if(c.length<1||c===this.emptyText){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(this.hiddenName){if(this.hiddenField.value.length<1){this.markInvalid("你没选中任何值!");return false}}if(c.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(c.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var e=Ext.form.VTypes;if(!e[this.vtype](c,this)){this.markInvalid(this.vtypeText||e[this.vtype+"Text"]);return false}}if(typeof this.validator=="function"){var d=this.validator(c);if(d!==true){this.markInvalid(d);return false}}if(this.regex&&!this.regex.test(c)){this.markInvalid(this.regexText);return false}return true},validateBlur:function(c){return this.validateValue(this.getValue())}});Ext.reg("selectfield",Ext.ui.SelectField);Ext.override(Ext.form.DisplayField,{defaultAutoCreate:{tag:"div",style:"overflow:auto;border:none;background:none;text-decoration:underline;"},fieldClass:"x-form-display-field break-word"});Ext.ns("Ext.ui.grid");Ext.ui.grid.CellActions=Ext.extend(Ext.util.Observable,{init:function(c){this.cellActions=c.cellActions||{};this.grid=c;c.on("click",this.onClick,this)},onClick:function(h){var v=h.getTarget(".x-grid3-row");var s=h.getTarget(".x-grid3-cell");var d=this.grid;var n=d.view;var m=n.findRowIndex(v);var r=n.findCellIndex(s);var k=d.getColumnModel().config[r]||{dataIndex:""};var g,o,q,l,u,f;if(s&&m>=0){g=d.store.getAt(m);if(typeof g=="undefined"){return}o=k.dataIndex;q=g.get(o);for(f in this.cellActions){u=h.getTarget("."+f);l=this.cellActions[f];if(u){if(typeof l=="function"){l.call(d,q,g,m,r,u)}}}}}});Ext.reg("cellactions",Ext.ui.grid.CellActions);Ext.ns("Ext.ui.grid");Ext.ui.grid.GridPrinter=Ext.extend(Ext.util.Observable,{init:function(c){var d=this;c.print=function(){d.print(this)};c.excel=function(e){d.excel(this,e)}},getColumns:function(e){var d=e.getColumnModel().config;var f=[],c=0;for(c=0;c<d.length;c++){if(d[c].exportable===false){continue}if(d[c].exportable===true||(d[c].display!==false&&d[c].print!==false&&d[c].hidden!==true&&d[c].id!="checker")){f.push(d[c])}}return f},excel:function(e,f){var c=f||{};columns=this.getColumns(e);var h=[],g=[];for(var d=0;d<columns.length;d++){h.push(columns[d].header||columns[d].name);g.push(columns[d].name)}Ext.applyIf(c,{excelColIds:g.join(","),excelColTexts:h.join(",").replace(/<\/?[^>]*>/g,""),fileName:"excel导出",start:0,limit:Ext.consts.maxRow});Ext.applyIf(c,e.store.baseParams);Ext.download(Ext.url(Ext.consts.exportUrl),c)},print:function(f){var e=this.getColumns(f);var h=[];f.store.data.each(function(n){var q=[];for(var m in n.data){var o=n.data[m];Ext.each(e,function(r){if(r.dataIndex==m){q[m]=r.renderer?r.renderer(o):o}},this)}h.push(q)});var l=new Ext.XTemplate(this.headerTpl).apply(e);var c=new Ext.XTemplate(this.bodyTpl).apply(e);var g=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',"<html>","<head>",'<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />','<link href="'+this.stylesheetPath+'" rel="stylesheet" type="text/css" media="screen,print" />',"<title>"+f.title+"print</title>","</head>","<body>","<table>",l,'<tpl for=".">',c,"</tpl>","</table>","</body>","</html>"];var d=new Ext.XTemplate(g).apply(h);var k=window.open("","printgrid");k.document.write(d);if(this.printAutomatically){k.print();k.close()}},stylesheetPath:Ext.url("/style/print.css"),printAutomatically:false,headerTpl:["<tr>",'<tpl for=".">',"<th>{header}</th>","</tpl>","</tr>"],bodyTpl:["<tr>",'<tpl for=".">',"<td>{{dataIndex}}</td>","</tpl>","</tr>"]});var requirejs,require,define;(function(Y){function x(b){return J.call(b)==="[object Function]"}function G(b){return J.call(b)==="[object Array]"}function q(b,c){if(b){var e;for(e=0;e<b.length;e+=1){if(b[e]&&c(b[e],e,b)){break}}}}function N(b,c){if(b){var e;for(e=b.length-1;e>-1;e-=1){if(b[e]&&c(b[e],e,b)){break}}}}function y(b,c){for(var e in b){if(b.hasOwnProperty(e)&&c(b[e],e)){break}}}function K(b,c,e,i){c&&y(c,function(c,j){if(e||!b.hasOwnProperty(j)){i&&typeof c!=="string"?(b[j]||(b[j]={}),K(b[j],c,e,i)):b[j]=c}});return b}function s(b,c){return function(){return c.apply(b,arguments)}}function Z(b){if(!b){return b}var c=Y;q(b.split("."),function(b){c=c[b]});return c}function $(b,c,e){return function(){var i=fa.call(arguments,0),g;if(e&&x(g=i[i.length-1])){g.__requireJsBuild=!0}i.push(c);return b.apply(null,i)}}function aa(b,c,e){q([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(i){var g=i[1]||i[0];b[i[0]]=c?$(c[g],e):function(){var b=z[O];return b[g].apply(b,arguments)}})}function H(b,c,e,i){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=i;if(e){c.originalError=e}return c}function ga(){if(I&&I.readyState==="interactive"){return I}N(document.getElementsByTagName("script"),function(b){if(b.readyState==="interactive"){return I=b}});return I}var ha=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ia=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,ba=/\.js$/,ja=/^\.\//,J=Object.prototype.toString,A=Array.prototype,fa=A.slice,ka=A.splice,w=!!(typeof window!=="undefined"&&navigator&&document),ca=!w&&typeof importScripts!=="undefined",la=w&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,O="_",S=typeof opera!=="undefined"&&opera.toString()==="[object Opera]",z={},p={},P=[],L=!1,j,t,C,u,D,I,E,da,ea;if(typeof define==="undefined"){if(typeof requirejs!=="undefined"){if(x(requirejs)){return}p=requirejs;requirejs=void 0}typeof require!=="undefined"&&!x(require)&&(p=require,require=void 0);j=requirejs=function(b,c,e,i){var g=O,r;!G(b)&&typeof b!=="string"&&(r=b,G(c)?(b=c,c=e,e=i):b=[]);if(r&&r.context){g=r.context}(i=z[g])||(i=z[g]=j.s.newContext(g));r&&i.configure(r);return i.require(b,c,e)};j.config=function(b){return j(b)};require||(require=j);j.version="2.0.4";j.jsExtRegExp=/^\/|:|\?|\.js$/;j.isBrowser=w;A=j.s={contexts:z,newContext:function(b){function c(a,d,o){var l=d&&d.split("/"),f=l,b=k.map,c=b&&b["*"],e,g,h;if(a&&a.charAt(0)==="."){if(d){f=k.pkgs[d]?l=[d]:l.slice(0,l.length-1);d=a=f.concat(a.split("/"));for(f=0;d[f];f+=1){if(e=d[f],e==="."){d.splice(f,1),f-=1}else{if(e===".."){if(f===1&&(d[2]===".."||d[0]==="..")){break}else{f>0&&(d.splice(f-1,2),f-=2)}}}}f=k.pkgs[d=a[0]];a=a.join("/");f&&a===d+"/"+f.main&&(a=d)}else{a.indexOf("./")===0&&(a=a.substring(2))}}if(o&&(l||c)&&b){d=a.split("/");for(f=d.length;f>0;f-=1){g=d.slice(0,f).join("/");if(l){for(e=l.length;e>0;e-=1){if(o=b[l.slice(0,e).join("/")]){if(o=o[g]){h=o;break}}}}!h&&c&&c[g]&&(h=c[g]);if(h){d.splice(0,f,h);a=d.join("/");break}}}return a}function e(a){w&&q(document.getElementsByTagName("script"),function(d){if(d.getAttribute("data-requiremodule")===a&&d.getAttribute("data-requirecontext")===h.contextName){return d.parentNode.removeChild(d),!0}})}function i(a){var d=k.paths[a];if(d&&G(d)&&d.length>1){return e(a),d.shift(),h.undef(a),h.require([a]),!0}}function g(a,d,o,b){var f=a?a.indexOf("!"):-1,v=null,e=d?d.name:null,g=a,i=!0,j="",k,m;a||(i=!1,a="_@r"+(N+=1));f!==-1&&(v=a.substring(0,f),a=a.substring(f+1,a.length));v&&(v=c(v,e,b),m=n[v]);a&&(v?j=m&&m.normalize?m.normalize(a,function(a){return c(a,e,b)}):c(a,e,b):(j=c(a,e,b),k=h.nameToUrl(j)));a=v&&!m&&!o?"_unnormalized"+(O+=1):"";return{prefix:v,name:j,parentMap:d,unnormalized:!!a,url:k,originalName:g,isDefine:i,id:(v?v+"!"+j:j)+a}}function r(a){var d=a.id,o=m[d];o||(o=m[d]=new h.Module(a));return o}function p(a,d,o){var b=a.id,f=m[b];if(n.hasOwnProperty(b)&&(!f||f.defineEmitComplete)){d==="defined"&&o(n[b])}else{r(a).on(d,o)}}function B(a,d){var b=a.requireModules,l=!1;if(d){d(a)}else{if(q(b,function(d){if(d=m[d]){d.error=a,d.events.error&&(l=!0,d.emit("error",a))}}),!l){j.onError(a)}}}function u(){P.length&&(ka.apply(F,[F.length-1,0].concat(P)),P=[])}function t(a,d,b){a=a&&a.map;d=$(b||h.require,a,d);aa(d,h,a);d.isBrowser=w;return d}function z(a){delete m[a];q(M,function(d,b){if(d.map.id===a){return M.splice(b,1),d.defined||(h.waitCount-=1),!0}})}function A(a,d){var b=a.map.id,l=a.depMaps,f;if(a.inited){if(d[b]){return a}d[b]=!0;q(l,function(a){if(a=m[a.id]){return !a.inited||!a.enabled?(f=null,delete d[b],!0):f=A(a,K({},d))}});return f}}function C(a,d,b){var l=a.map.id,f=a.depMaps;if(a.inited&&a.map.isDefine){if(d[l]){return n[l]}d[l]=a;q(f,function(f){var f=f.id,c=m[f];!Q[f]&&c&&(!c.inited||!c.enabled?b[l]=!0:(c=C(c,d,b),b[f]||a.defineDepById(f,c)))});a.check(!0);return n[l]}}function D(a){a.check()}function E(){var a=k.waitSeconds*1000,d=a&&h.startTime+a<(new Date).getTime(),b=[],l=!1,f=!0,c,g,j;if(!T){T=!0;y(m,function(a){c=a.map;g=c.id;if(a.enabled&&!a.error){if(!a.inited&&d){i(g)?l=j=!0:(b.push(g),e(g))}else{if(!a.inited&&a.fetched&&c.isDefine&&(l=!0,!c.prefix)){return f=!1}}}});if(d&&b.length){return a=H("timeout","Load timeout for modules: "+b,null,b),a.contextName=h.contextName,B(a)}f&&(q(M,function(a){if(!a.defined){var a=A(a,{}),d={};a&&(C(a,d,{}),y(d,D))}}),y(m,D));if((!d||j)&&l){if((w||ca)&&!U){U=setTimeout(function(){U=0;E()},50)}}T=!1}}function V(a){r(g(a[0],null,!0)).init(a[1],a[2])}function J(a){var a=a.currentTarget||a.srcElement,d=h.onScriptLoad;a.detachEvent&&!S?a.detachEvent("onreadystatechange",d):a.removeEventListener("load",d,!1);d=h.onScriptError;a.detachEvent&&!S||a.removeEventListener("error",d,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}var k={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},m={},W={},F=[],n={},R={},N=1,O=1,M=[],T,X,h,Q,U;Q={require:function(a){return t(a)},exports:function(a){a.usingExports=!0;if(a.map.isDefine){return a.exports=n[a.map.id]={}}},module:function(a){return a.module={id:a.map.id,uri:a.map.url,config:function(){return k.config&&k.config[a.map.id]||{}},exports:n[a.map.id]}}};X=function(a){this.events=W[a.id]||{};this.map=a;this.shim=k.shim[a.id];this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};X.prototype={init:function(a,d,b,l){l=l||{};if(!this.inited){this.factory=d;if(b){this.on("error",b)}else{this.events.error&&(b=s(this,function(a){this.emit("error",a)}))}this.depMaps=a&&a.slice(0);this.depMaps.rjsSkipMap=a.rjsSkipMap;this.errback=b;this.inited=!0;this.ignore=l.ignore;l.enabled||this.enabled?this.enable():this.check()}},defineDepById:function(a,d){var b;q(this.depMaps,function(d,f){if(d.id===a){return b=f,!0}});return this.defineDep(b,d)},defineDep:function(a,d){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=d)},fetch:function(){if(!this.fetched){this.fetched=!0;h.startTime=(new Date).getTime();var a=this.map;if(this.shim){t(this,!0)(this.shim.deps||[],s(this,function(){return a.prefix?this.callPlugin():this.load()}))}else{return a.prefix?this.callPlugin():this.load()}}},load:function(){var a=this.map.url;R[a]||(R[a]=!0,h.load(this.map.id,a))},check:function(a){if(this.enabled&&!this.enabling){var d=this.map.id,b=this.depExports,c=this.exports,f=this.factory,e;if(this.inited){if(this.error){this.emit("error",this.error)}else{if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(x(f)){if(this.events.error){try{c=h.execCb(d,f,b,c)}catch(g){e=g}}else{c=h.execCb(d,f,b,c)}if(this.map.isDefine){if((b=this.module)&&b.exports!==void 0&&b.exports!==this.exports){c=b.exports}else{if(c===void 0&&this.usingExports){c=this.exports}}}if(e){return e.requireMap=this.map,e.requireModules=[this.map.id],e.requireType="define",B(this.error=e)}}else{c=f}this.exports=c;if(this.map.isDefine&&!this.ignore&&(n[d]=c,j.onResourceLoad)){j.onResourceLoad(h,this.map,this.depMaps)}delete m[d];this.defined=!0;h.waitCount-=1;h.waitCount===0&&(M=[])}this.defining=!1;if(!a&&this.defined&&!this.defineEmitted){this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0}}}}else{this.fetch()}}},callPlugin:function(){var a=this.map,d=a.id,b=g(a.prefix,null,!1,!0);p(b,"defined",s(this,function(b){var f=this.map.name,e=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){if(b.normalize&&(f=b.normalize(f,function(a){return c(a,e,!0)})||""),b=g(a.prefix+"!"+f,this.map.parentMap,!1,!0),p(b,"defined",s(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),b=m[b.id]){if(this.events.error){b.on("error",s(this,function(a){this.emit("error",a)}))}b.enable()}}else{f=s(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),f.error=s(this,function(a){this.inited=!0;this.error=a;a.requireModules=[d];y(m,function(a){a.map.id.indexOf(d+"_unnormalized")===0&&z(a.map.id)});B(a)}),f.fromText=function(a,d){var b=L;b&&(L=!1);r(g(a));j.exec(d);b&&(L=!0);h.completeLoad(a)},b.load(a.name,t(a.parentMap,!0,function(a,d){a.rjsSkipMap=!0;return h.require(a,d)}),f,k)}}));h.enable(b,this);this.pluginMaps[b.id]=b},enable:function(){this.enabled=!0;if(!this.waitPushed){M.push(this),h.waitCount+=1,this.waitPushed=!0}this.enabling=!0;q(this.depMaps,s(this,function(a,d){var b,c;if(typeof a==="string"){a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap);this.depMaps[d]=a;if(b=Q[a.id]){this.depExports[d]=b(this);return}this.depCount+=1;p(a,"defined",s(this,function(a){this.defineDep(d,a);this.check()}));this.errback&&p(a,"error",this.errback)}b=a.id;c=m[b];!Q[b]&&c&&!c.enabled&&h.enable(a,this)}));y(this.pluginMaps,s(this,function(a){var b=m[a.id];b&&!b.enabled&&h.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){q(this.events[a],function(a){a(b)});a==="error"&&delete this.events[a]}};return h={config:k,contextName:b,registry:m,defined:n,urlFetched:R,waitCount:0,defQueue:F,Module:X,makeModuleMap:g,configure:function(a){a.baseUrl&&a.baseUrl.charAt(a.baseUrl.length-1)!=="/"&&(a.baseUrl+="/");var b=k.pkgs,c=k.shim,e=k.paths,f=k.map;K(k,a,!0);k.paths=K(e,a.paths,!0);if(a.map){k.map=K(f||{},a.map,!0,!0)}if(a.shim){y(a.shim,function(a,b){G(a)&&(a={deps:a});if(a.exports&&!a.exports.__buildReady){a.exports=h.makeShimExports(a.exports)}c[b]=a}),k.shim=c}if(a.packages){q(a.packages,function(a){a=typeof a==="string"?{name:a}:a;b[a.name]={name:a.name,location:a.location||a.name,main:(a.main||"main").replace(ja,"").replace(ba,"")}}),k.pkgs=b}y(m,function(a,b){a.map=g(b)});if(a.deps||a.callback){h.require(a.deps||[],a.callback)}},makeShimExports:function(a){var b;return typeof a==="string"?(b=function(){return Z(a)},b.exports=a,b):function(){return a.apply(Y,arguments)}},requireDefined:function(a,b){var c=g(a,b,!1,!0).id;return n.hasOwnProperty(c)},requireSpecified:function(a,b){a=g(a,b,!1,!0).id;return n.hasOwnProperty(a)||m.hasOwnProperty(a)},require:function(a,d,c,e){var f;if(typeof a==="string"){if(x(d)){return B(H("requireargs","Invalid require call"),c)}if(j.get){return j.get(h,a,d)}a=g(a,d,!1,!0);a=a.id;return !n.hasOwnProperty(a)?B(H("notloaded",'Module name "'+a+'" has not been loaded yet for context: '+b)):n[a]}c&&!x(c)&&(e=c,c=void 0);d&&!x(d)&&(e=d,d=void 0);for(u();F.length;){if(f=F.shift(),f[0]===null){return B(H("mismatch","Mismatched anonymous define() module: "+f[f.length-1]))}else{V(f)}}r(g(null,e)).init(a,d,c,{enabled:!0});E();return h.require},undef:function(a){var b=g(a,null,!0),c=m[a];delete n[a];delete R[b.url];delete W[a];if(c){if(c.events.defined){W[a]=c.events}z(a)}},enable:function(a){m[a.id]&&r(a).enable()},completeLoad:function(a){var b=k.shim[a]||{},c=b.exports&&b.exports.exports,e,f;for(u();F.length;){f=F.shift();if(f[0]===null){f[0]=a;if(e){break}e=!0}else{f[0]===a&&(e=!0)}V(f)}f=m[a];if(!e&&!n[a]&&f&&!f.inited){if(k.enforceDefine&&(!c||!Z(c))){if(i(a)){return}else{return B(H("nodefine","No define call for "+a,null,[a]))}}else{V([a,b.deps||[],b.exports])}}E()},toUrl:function(a,b){var e=a.lastIndexOf("."),g=null;e!==-1&&(g=a.substring(e,a.length),a=a.substring(0,e));return h.nameToUrl(c(a,b&&b.id,!0),g)},nameToUrl:function(a,b){var c,e,f,g,h,i;if(j.jsExtRegExp.test(a)){g=a+(b||"")}else{c=k.paths;e=k.pkgs;g=a.split("/");for(h=g.length;h>0;h-=1){if(i=g.slice(0,h).join("/"),f=e[i],i=c[i]){G(i)&&(i=i[0]);g.splice(0,h,i);break}else{if(f){c=a===f.name?f.location+"/"+f.main:f.location;g.splice(0,h,c);break}}}g=g.join("/")+(b||".js");g=(g.charAt(0)==="/"||g.match(/^[\w\+\.\-]+:/)?"":k.baseUrl)+g}return k.urlArgs?g+((g.indexOf("?")===-1?"?":"&")+k.urlArgs):g},load:function(a,b){j.load(h,a,b)},execCb:function(a,b,c,e){return b.apply(e,c)},onScriptLoad:function(a){if(a.type==="load"||la.test((a.currentTarget||a.srcElement).readyState)){I=null,a=J(a),h.completeLoad(a.id)}},onScriptError:function(a){var b=J(a);if(!i(b.id)){return B(H("scripterror","Script error",a,[b.id]))}}}}};j({});aa(j);if(w&&(t=A.head=document.getElementsByTagName("head")[0],C=document.getElementsByTagName("base")[0])){t=A.head=C.parentNode}j.onError=function(b){throw b};j.load=function(b,c,e){var i=b&&b.config||{},g;if(w){return g=i.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),g.type=i.scriptType||"text/javascript",g.charset="utf-8",g.async=!0,g.setAttribute("data-requirecontext",b.contextName),g.setAttribute("data-requiremodule",c),g.attachEvent&&!(g.attachEvent.toString&&g.attachEvent.toString().indexOf("[native code")<0)&&!S?(L=!0,g.attachEvent("onreadystatechange",b.onScriptLoad)):(g.addEventListener("load",b.onScriptLoad,!1),g.addEventListener("error",b.onScriptError,!1)),g.src=e,E=g,C?t.insertBefore(g,C):t.appendChild(g),E=null,g}else{ca&&(importScripts(e),b.completeLoad(c))}};w&&N(document.getElementsByTagName("script"),function(b){if(!t){t=b.parentNode}if(u=b.getAttribute("data-main")){if(!p.baseUrl){D=u.split("/"),da=D.pop(),ea=D.length?D.join("/")+"/":"./",p.baseUrl=ea,u=da}u=u.replace(ba,"");p.deps=p.deps?p.deps.concat(u):[u];return !0}});define=function(b,c,e){var i,g;typeof b!=="string"&&(e=c,c=b,b=null);G(c)||(e=c,c=[]);!c.length&&x(e)&&e.length&&(e.toString().replace(ha,"").replace(ia,function(b,e){c.push(e)}),c=(e.length===1?["require"]:["require","exports","module"]).concat(c));if(L&&(i=E||ga())){b||(b=i.getAttribute("data-requiremodule")),g=z[i.getAttribute("data-requirecontext")]}(g?g.defQueue:P).push([b,c,e])};define.amd={jQuery:!0};j.exec=function(b){return eval(b)};j(p)}})(this);(function(c){Ext.ns("Ext.ui");Ext.reg("tb",c);Ext.ui.XTollbar=Ext.extend(Ext.Container,{constructor:function(f){var e=[],g=0,d,k=[],h={};if(Ext.isArray(f)){f={items:f}}else{f=f||{}}d=f.items||[];f.items=[];for(g=0;g<d.length;g++){if(d[g]=="|"){k.push(this.createToolbar(f,e));e=[]}else{if(d[g]=="!"){}else{e.push(d[g])}}}if(e.length){k.push(this.createToolbar(f,e))}f.items=k;Ext.Container.superclass.constructor.call(this,f)},createToolbar:function(e,d){var g=e.ownerCt&&e.ownerCt.enableOverflow;var h={};if(typeof e.defaults=="function"){h=e.defaults(this);e.defaults=h}var f=Ext.apply({enableOverflow:g===true,buttonAlign:this.buttonAlign},e);f.items=d;return this.createComponent(f,"tb")},add:function(e){if(Ext.isArray(e)){return Ext.ui.XTollbar.superclass.add.apply(this,arguments)}var f=null;if(e.getXType){f=e.getXType()}if(e.xtype){f=e.xtype}if(f=="tb"){return Ext.ui.XTollbar.superclass.add.apply(this,arguments)}if(f==null&&e=="|"){return this.add(this.createToolbar({},[]))}else{var d=this.items.itemAt(this.items.getCount()-1);if(!d){var d=this.add(this.createToolbar({},[]))}return d.add(e)}}});Ext.reg("toolbar",Ext.ui.XTollbar)})(Ext.Toolbar);Ext.Panel.prototype.createToolbar=function(d,e){var c;if(Ext.isArray(d)){d={items:d}}c=d.events?Ext.apply(d,e):this.createComponent(Ext.apply({ownerCt:this},d,e),"toolbar");this.toolbars.push(c);return c};Ext.ns("Ext.ui");Ext.ui.XPagingToolbar=Ext.extend(Ext.PagingToolbar,{beforeText:"每页显示",afterText:"条",addBefore:"-",addAfter:null,dynamic:false,displayInfo:true,displayPageSize:true,variations:[5,10,20,50,100,200,500,1000],comboCfg:undefined,getPageSize:function(){return this.pageSize},addSize:function(c){if(c>0){this.sizes.push([c])}},updateStore:function(){if(this.dynamic){var d=this.pageSize,g;d=(d>0)?d:1;this.sizes=[];var e=this.variations;for(var f=0,c=e.length;f<c;f++){this.addSize(d-e[e.length-1-f])}this.addToStore(d);for(var f=0,c=e.length;f<c;f++){this.addSize(d+e[f])}}else{if(!this.staticSizes){this.sizes=[];var e=this.variations;var d=0;for(var f=0,c=e.length;f<c;f++){this.addSize(d+e[f])}this.staticSizes=this.sizes.slice(0)}else{this.sizes=this.staticSizes.slice(0)}}this.combo.store.loadData(this.sizes);this.combo.collapse();this.combo.setValue(this.pageSize)},refresh:function(){this.onClick("refresh")},setPageSize:function(h,m){var n=this;this.combo.collapse();h=parseInt(h)||parseInt(this.combo.getValue());h=(h>0)?h:1;if(h==n.pageSize){return}else{if(h<n.pageSize){n.pageSize=h;var c=Math.round(n.cursor/h)+1;var l=(c-1)*h;var k=n.store;if(l>k.getTotalCount()){n.pageSize=h;n.doLoad(l-h)}else{k.suspendEvents();for(var e=0,f=l-n.cursor;e<f;e++){k.remove(k.getAt(0))}while(k.getCount()>h){k.remove(k.getAt(k.getCount()-1))}k.resumeEvents();k.fireEvent("datachanged",k);n.cursor=l;var g=n.getPageData();this.afterTextItem.setText(String.format(n.afterPageText,g.pages));n.inputItem.setValue(c);n.first.setDisabled(c==1);n.prev.setDisabled(c==1);n.next.setDisabled(c==g.pages);n.last.setDisabled(c==g.pages);n.updateInfo()}}else{this.pageSize=h;this.doLoad(Math.floor(this.cursor/this.pageSize)*this.pageSize)}}this.updateStore()},onRender:function(){Ext.ui.XPagingToolbar.superclass.onRender.apply(this,arguments);this.combo=Ext.ComponentMgr.create(Ext.applyIf(this.comboCfg||{},{store:new Ext.data.SimpleStore({fields:["pageSize"],data:[]}),displayField:"pageSize",valueField:"pageSize",mode:"local",triggerAction:"all",width:50,xtype:"combo"}));this.combo.on("select",this.setPageSize,this);var c=this;c.store.on("beforeload",function(d,e){if(e.params.limit!=c.pageSize){e.params.limit=c.pageSize;c.setPageSize()}});this.updateStore();if(this.addBefore&&this.displayPageSize){this.add(this.addBefore)}if(this.beforeText&&this.displayPageSize){this.add(this.beforeText)}if(this.displayPageSize){this.add(this.combo)}if(this.afterText&&this.displayPageSize){this.add(this.afterText)}if(this.addAfter&&this.displayPageSize){this.add(this.addAfter)}if(this.autoLoad){this.on("render",function(){var d=this;setTimeout(function(){d.doRefresh()},10)})}}});Ext.ns("Ext.ui");Ext.ui.CheckboxColumn=Ext.extend(Ext.grid.Column,{header:'<div class="x-grid3-hd-checker">&#160;</div>',isColumn:true,renderer:function(d,e,c){return'<div class="x-grid3-row-checker">&#160;</div>'},processEvent:function(d,g,f,k,c){var h=f.getSelectionModel();if(d=="mousedown"){this.onMouseDown(g,g.getTarget(),f);return false}else{return Ext.grid.Column.prototype.processEvent.apply(h,arguments)}},onMouseDown:function(g,f,d){if(g.button===0&&f.className=="x-grid3-row-checker"){g.stopEvent();var h=g.getTarget(".x-grid3-row");var k=d.getSelectionModel();if(h){var c=h.rowIndex;if(k.isSelected(c)){k.deselectRow(c)}else{k.selectRow(c,true);d.getView().focusRow(c)}}}},constructor:function(c){c=c||{};Ext.apply(c,{sortable:false,width:20,menuDisabled:true,fixed:true,hideable:false,dataIndex:"",id:"checker",locked:true});Ext.ui.CheckboxColumn.superclass.constructor.call(this,c)}});Ext.grid.Column.types.checkboxcolumn=Ext.ui.CheckboxColumn;Ext.ui.CheckboxSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{constructor:function(){Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);if(this.checkOnly){this.handleMouseDown=Ext.emptyFn}},initEvents:function(){Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){Ext.fly(this.grid.getView().innerHd).on("mousedown",this.onHdMouseDown,this);if(this.grid.getView().lockedHd){Ext.fly(this.grid.getView().lockedHd).on("mousedown",this.onHdMouseDown,this)}},this)},onHdMouseDown:function(f){var c=f.getTarget();if(c.className=="x-grid3-hd-checker"){f.stopEvent();var d=Ext.fly(c.parentNode);var g=d.hasClass("x-grid3-hd-checker-on");if(g){d.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{d.addClass("x-grid3-hd-checker-on");this.selectAll()}}},onEditorSelect:function(d,c){if(c!=d&&!this.checkOnly){this.selectRow(d)}}});Ext.ui.XGridPanel=function(e){var d=[],h=[];if(typeof e.metaTable=="string"){if(Ext.isEmpty(window.Metas)||Ext.isEmpty(window.Metas[e.metaTable])){throw new Error("请初始化表格"+e.metaTable+"元信息");return}d=this.parseMeta(window.Metas[e.metaTable])}if(d.length==0&&Ext.isEmpty(e.fields)){throw new Error("请配置fields")}var h=this.paseFields(e.fields||[]);e.fields=this.mergeColumns(d,h);if(e.fields.length==0){throw new Error("fields 长度为0")}e.storeConfig=Ext.applyAll({fields:e.fields,autoLoad:false},e.storeConfig||{});if(!e.store){e.store=this.createStore(e.storeConfig)}e.columns=Ext.applyAll({},{fields:this.filterNoDisplayColumn(e.fields)}).fields;var g=new Ext.grid.RowNumberer({locked:true,print:false,paste:false}),f=[];if(e.hideRowNumberer===false){f.push(g)}var k=e.sm||new Ext.grid.RowSelectionModel({singleSelect:true});if(e.smConfig){e.smConfig=Ext.apply({singleSelect:true},e.smConfig);k=new Ext.ui.CheckboxSelectionModel(e.smConfig);f.push({xtype:"checkboxcolumn"})}e.sm=k;e.columns=f.concat(e.columns);e.store.on("update",this.onUpdate.createDelegate(this));e.store.on("load",this.onStoreReload.createDelegate(this));this.reset();if(e.pagingConfig){if(e.pagingConfig===true){e.pagingConfig={}}e.bbar=this.createPagingToolbar(e.pagingConfig,e.store)}var c=e.plugins||[];c.push(new Ext.ui.grid.CellActions());c.push(new Ext.ui.grid.GridPrinter());e.plugins=c;this.addEvents("recordchage");this.afterConfig(e);Ext.ui.XGridPanel.superclass.constructor.call(this,e)};Ext.extend(Ext.ui.XGridPanel,Ext.grid.EditorGridPanel,{keepSelection:false,loadMask:true,clicksToEdit:1,stripeRows:true,pageSize:50,autoWidth:true,createPagingToolbar:function(d,c){var e=new Ext.ui.XPagingToolbar(Ext.apply({pageSize:this.pageSize,store:c,autoLoad:true,displayInfo:true},d));return e},createStore:function(c){if(c.group){return new Ext.ui.GroupingStore(c)}else{return new Ext.ui.CommonStore(c)}},afterConfig:function(c){},initComponent:function(){if(this.summary===true){this.plugins.push(new Ext.ui.GridSummary())}Ext.ui.XGridPanel.superclass.initComponent.apply(this,arguments);var c=this.getSelectionModel();c.on("rowselect",this.onRowselect.createDelegate(this));c.on("rowdeselect",this.onRowdeselect.createDelegate(this));this.smSelections=new Ext.util.MixedCollection(false);this.on("render",function(d){d.getView().on("refresh",d.onViewRefresh,d)});if(this.formField){this.bindField(this.formField)}this.on("mouseover",function(k){var d=k.getTarget(".x-grid3-cell",3);if(d){var g=this.view.findCellIndex(d);var m=this.getColumnModel().config[g];var l=this.getView().findRowIndex(d);if(l===false){return}var f=this.store.getAt(l);var h=f.get(m.name);if(m.qtip&&Ext.QuickTips.getQuickTip()){Ext.QuickTips.getQuickTip().show();if(Ext.isFunction(m.qtip)){h=m.qtip(h,f,l)||h}Ext.QuickTips.getQuickTip().show();Ext.QuickTips.getQuickTip().body.update(h);setTimeout(function(){Ext.QuickTips.getQuickTip().show()},100)}}});if(this.restoreScroll===true){this.getView().on("beforerefresh",function(d){d.scrollTop=d.scroller.dom.scrollTop;d.scrollLeft=d.scroller.dom.scrollLeft});this.getView().on("refresh",function(d){setTimeout(function(){d.scroller.dom.scrollTop=d.scrollTop;d.scroller.dom.scrollLeft=d.scrollLeft},200)})}this.on("beforeedit",this.onBeforEdit,this)},setEditable:function(c){this._editable=c},onBeforEdit:function(c){if(this._editable===false){c.cancel=true;return false}else{return true}},bindField:function(c){this.on("recordchage",function(e,d){var f=Ext.getCmp(c);if(f){f.setValue(Ext.encode(e.getValue()))}})},parseMeta:function(e){var c=[],d;for(d=0;d<e.length;d++){c.push(Ext.apply({dataIndex:e[d].name},e[d]))}return c},filterNoDisplayColumn:function(e){var d=[];for(var c=0;c<e.length;c++){if(e[c].display===false){delete e[c].display}else{d.push(e[c])}}return d},paseFields:function(d){var e=0,c=[];for(e=0;e<d.length;e++){if(typeof d[e]=="string"){c.push({name:d[e],header:d[e],dataIndex:d[e]})}else{if(typeof d[e]=="object"){c.push(Ext.apply({header:d[e].name,dataIndex:d[e].name},d[e]))}}}return c},onRowdeselect:function(e,d,c){this.smSelections.removeKey(c.id)},onRowselect:function(e,d,c){if(e.singleSelect===true){this.smSelections.clear()}this.smSelections.add(c)},onViewRefresh:function(){var k=this.getSelectionModel(),c=this.smSelections;if(this.keepSelection){var g=[],f=this.store,d;c.each(function(l){if(d=f.getById(l.id)){g.push(f.indexOf(d));c.add(d)}});if(g.length>0){k.selectRows(g,true)}}else{c.clear();if(k instanceof Ext.grid.RowSelectionModel){var e=k.getSelections();for(var h=0;h<e.length;h++){c.add(e[h])}}}},mergeColumns:function(f,g){var e=this.mappingArray(g,this.columnKeyFn),d=this.mappingArray(f,this.columnKeyFn),c,h=[];c=Ext.applyAll(d,e);for(p in c){h.push(c[p])}return h},columnKeyFn:function(d,c){return d.name},mappingArray:function(f,d){var e={},c;for(c=0;c<f.length;c++){e[d(f[c],c)]=f[c]}return e},insertFirst:function(c){return this.insertAt(c,0)},insertBefore:function(e,c){c=c||this.getSelected();var d=this.store.indexOf(c);if(d<0){throw new Error("找不到前面的记录");return}this.insertAt(e,d)},insertAfter:function(e,d){d=d||this.getSelected();var c=this.store.indexOf(d);if(c<0){throw new Error("找不到后面的记录");return}c=c+1;this.insertAt(e,c)},insertLast:function(c){return this.insertAt(c,this.store.getCount())},insertAt:function(e,c){var d=this.createRecord(e);d.isNew=true;this.stopEditing();this.store.insert(c,d);this.dataMap.inserted.push(d);this.fireEvent("recordchage",this,d)},createRecord:function(c){c=c||{};if(c instanceof Ext.data.Record){return c}else{return new this.store.reader.recordType(c)}},deleteRow:function(c){this.stopEditing();c=c||this.getSelected();if(!c.isNew){this.dataMap.deleted.push(c);this.dataMap.updated.remove(c)}else{this.dataMap.inserted.remove(c)}this.smSelections.remove(c);this.store.remove(c);this.fireEvent("recordchage",this,c)},getValue:function(){this.stopEditing();var e={insert:[],update:[],"delete":[]},c=this.dataMap,d=this;Ext.each(c.inserted,function(f){e.insert.push(d.parseRecord(f))});Ext.each(c.updated,function(f){e.update.push(d.parseRecord(f))});Ext.each(c.deleted,function(f){e["delete"].push(d.parseRecord(f))});e.insertLength=e.insert.length;e.updateLength=e.update.length;e.deleteLength=e["delete"].length;e.length=e.insertLength+e.updateLength+e.deleteLength;return e},reset:function(){delete this.dataMap;delete this.updateCache;this.dataMap={inserted:[],updated:[],deleted:[]}},parseRecord:function(d){var e={},c=d.fields.items,h,g;for(g=0;g<c.length;g++){h=c[g];e[h.name]=h.convert((d.get(h.name)!==undefined)?d.get(h.name):h.defaultValue)}return e},onStoreReload:function(d,c,e){if(e.add!==true){this.reset()}},onUpdate:function(f,c,d){var e=this.updateCache||{};if(Ext.data.Record.EDIT==d){if(!c.isNew&&!e[c.id]){this.dataMap.updated.push(c);e[c.id]=true;this.fireEvent("recordchage",this,c)}}this.updateCache=e},getSelections:function(){return this.smSelections.items},getSelected:function(){return this.smSelections.items.length>0?this.smSelections.items[0]:undefined},hasSelection:function(){return this.smSelections.items.length>0},clearSelections:function(){this.getSelectionModel().clearSelections();this.smSelections.clear()},viewConfig:{emptyText:"没有可显示的数据"},isModifiedRecordsValid:function(){var c=this.dataMap;return this.isValid([].concat(c.inserted).concat(c.updated))},isValid:function(g){var f=this.colModel.config,l=[],h=0,n=true,k;for(h=0;h<f.length;h++){k=f[h].getEditor();if(k){l.push({field:k,dataIndex:f[h].dataIndex,id:f[h].id})}}var q=this.getValue(),e,m=this,o,c,d;g=g||this.store.getRange();Ext.each(g,function(r,s){for(h=0;h<l.length;h++){d=r.get(l[h].dataIndex);if(d==undefined||d==null){d=""}else{d=d}l[h].field.fireEvent("before_record_validate",r);if(!l[h].field.validateValue(d)){e=l[h].field.errorMsg;o=m.getView().getCell(s,m.colModel.getIndexById(l[h].id));c=o.firstChild;o.qtip=e;o.qclass="x-form-invalid-tip";if(c){c.qtip=e;c.qclass="x-form-invalid-tip"}Ext.fly(o).addClass("x-form-invalid");n=false}}});return n},setParam:function(c,d){var e=this.store.baseParams;if(d!==false&&d!==null&&d!==undefined&&d!==""){e[c]=d}else{if(Ext.type(c)=="object"){Ext.apply(this.store.baseParams,c)}}},toSearch:function(d,f,c){var e=this;var g=this.store.baseParams;if(f!==null&&f!==undefined&&f!==""){g[d]=String(f)}else{if(Ext.type(d)=="object"){this.store.baseParams=d}else{if(Ext.type(d)=="string"){delete g[d]}}}setTimeout(function(){e.store.load({params:{start:0,limit:e.pageSize},callback:c||Ext.emptyFn})},0)},toSearchToolbar:function(d){var c={};var e=function(f,g){if(f.items){f.items.each(function(h){if(Ext.type(h.getValue)=="function"){g[h.name||h.id||Ext.id()]=h.getValue()}else{if(h instanceof Ext.Container){e(h,g)}}})}};e(d,c);this.toSearch(c)},getView:function(){if(!this.view){this.view=new Ext.ui.XGridView(this.viewConfig)}return this.view}});Ext.reg("xgrid",Ext.ui.XGridPanel);Ext.grid.GridView.prototype.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-selectable {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" {attr}>{value}</div>',"</td>");Ext.ui.XGridView=Ext.extend(Ext.grid.GridView,{});Ext.override(Ext.grid.RowSelectionModel,{handleMouseDown:function(h,l,k){if(k.button!==0||this.isLocked()){return}var c=this.grid.getView();if(k.shiftKey&&!this.singleSelect&&this.last!==false){var f=this.last;this.selectRange(f,l,k.ctrlKey);this.last=f;c.focusRow(l)}else{var d=this.isSelected(l);if(k.ctrlKey&&d){this.deselectRow(l)}else{if(!d||this.getCount()>1){this.selectRow(l,k.ctrlKey||k.shiftKey)}}}}});(function(){var d=Ext.Editor.prototype.onRender;var c=Ext.Editor.prototype.beforeDestroy;Ext.override(Ext.Editor,{missingBlur:false,onBlur:function(){if(this.allowBlur===true&&this.editing&&this.selectSameEditor!==true){var e=Ext.EventObject;if(!e.within(this.el)&&!(this.field.list&&e.within(this.field.list))){this.completeEdit();this.missingBlur=false}else{this.missingBlur=true}}},onRender:function(){d.apply(this,arguments);Ext.getBody().on("click",this.docBodyClick,this)},docBodyClick:function(e){if(this.missingBlur===true){this.onBlur()}},beforeDestroy:function(){c.apply(this,arguments);Ext.getBody().removeListener("click",this.docBodyClick,this)}})})();Ext.override(Ext.grid.EditorGridPanel,{onEditComplete:function(d,g,c){this.editing=false;this.lastActiveEditor=this.activeEditor;this.activeEditor=null;var f=d.record,k=this.colModel.getDataIndex(d.col);g=this.postEditValue(g,c,f,k);if(this.forceValidation===true||String(g)!==String(c)){var h={grid:this,record:f,field:k,originalValue:c,value:g,row:d.row,column:d.col,cancel:false};if(this.fireEvent("validateedit",h)!==false&&!h.cancel&&String(g)!==String(c)){f.set(k,h.value);delete h.cancel;d.field.fireEvent("afteredit",d.field,f);this.fireEvent("afteredit",h)}}this.view.focusCell(d.row,d.col)}});Ext.grid.LockingGridPanel=Ext.extend(Ext.ui.XGridPanel,{afterConfig:function(c){var d=c.columns;delete c.columns;c.colModel=new Ext.ux.grid.LockingColumnModel(d)},getView:function(){if(!this.view){this.view=new Ext.ux.grid.LockingGridView()}return this.view}});Ext.ns("Ext.ui");Ext.ui.LockingGridPanel=Ext.grid.LockingGridPanel;Ext.grid.ExcelCellSelectionModel=function(c){Ext.apply(this,c);this.selection=null;this.mouseSelectionEnable=false;this.firstSelectedCell=[0,0];this.selectedCellRange=[0,0,0,0];this.addEvents("beforecellselect","cellselect","selectionchange");Ext.grid.ExcelCellSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.grid.ExcelCellSelectionModel,Ext.grid.CellSelectionModel,{initEvents:function(){this.grid.on("cellmouseover",this.handleMouseOver,this);this.grid.on("mouseup",this.handleMouseUp,this);this.grid.on("cellmousedown",this.handleMouseDown,this);this.grid.getGridEl().on(Ext.isIE||Ext.isSafari3?"keydown":"keypress",this.handleKeyDown,this);var c=this.grid.view;c.on("refresh",this.onViewChange,this);c.on("rowupdated",this.onRowUpdated,this);c.on("beforerowremoved",this.clearSelections,this);c.on("beforerowsinserted",this.clearSelections,this);if(this.grid.isEditor){this.grid.on("beforeedit",this.beforeEdit,this)}},clearSelections:function(d){var c=this.selection;if(c){if(d!==true){this.deSelectCellRange()}this.selection=null;this.fireEvent("selectionchange",this,null)}},handleMouseOver:function(d,h,c,f){if(this.mouseSelectionEnable){this.clearSelections();this.select(h,c);this.makeCellRange(h,c,this.firstSelectedCell[0],this.firstSelectedCell[1]);this.selectCellRange()}},handleMouseUp:function(d,h,c,f){this.mouseSelectionEnable=false},handleMouseDown:function(d,h,c,f){if(f.button!==0||this.isLocked()){return}this.mouseSelectionEnable=true;this.clearSelections();this.select(h,c);if(!f.shiftKey){this.firstSelectedCell=[h,c]}this.makeCellRange(h,c,this.firstSelectedCell[0],this.firstSelectedCell[1]);this.selectCellRange()},select:function(h,e,d,g,f){if(this.fireEvent("beforecellselect",this,h,e)!==false){f=f||this.grid.store.getAt(h);this.selection={record:f,cell:[h,e]};if(!d){var c=this.grid.getView();c.onCellSelect(h,e);if(g!==true){c.focusCell(h,e)}}this.fireEvent("cellselect",this,h,e);this.fireEvent("selectionchange",this,this.selection)}},handleKeyDown:function(n){if(!n.isNavKeyPress()){return}var m=this.grid,u=this.selection;if(!u){n.stopEvent();var t=m.walkCells(0,0,1,this.isSelectable,this);if(t){this.select(t[0],t[1])}return}var f=this;var q=function(g,c,e){return m.walkCells(g,c,e,f.isSelectable,f)};var h=n.getKey(),d=u.cell[0],o=u.cell[1];var l;switch(h){case n.TAB:if(n.shiftKey){l=q(d,o-1,-1)}else{l=q(d,o+1,1)}break;case n.DOWN:l=q(d+1,o,1);break;case n.UP:l=q(d-1,o,-1);break;case n.RIGHT:l=q(d,o+1,1);break;case n.LEFT:l=q(d,o-1,-1);break;case n.ENTER:if(m.isEditor&&!m.editing){m.startEditing(d,o);n.stopEvent();return}break}if(l){this.clearSelections();this.select(l[0],l[1]);if(!n.shiftKey){this.firstSelectedCell=l}this.makeCellRange(l[0],l[1],this.firstSelectedCell[0],this.firstSelectedCell[1]);this.selectCellRange();n.stopEvent()}},makeCellRange:function(e,f,c,d){if(e>c){temp_row=e;e=c;c=temp_row}if(f>d){temp_col=f;f=d;d=temp_col}this.selectedCellRange=[e,f,c,d]},selectCellRange:function(){var f=this.selectedCellRange;var h=f[0],k=f[1],e=f[2],g=f[3];for(var d=h;d<=e;d++){for(var l=k;l<=g;l++){this.grid.view.onCellSelect(d,l)}}},getSelectedCellRange:function(){return this.selectedCellRange},deSelectCellRange:function(){var f=this.selectedCellRange;var h=f[0],k=f[1],e=f[2],g=f[3];for(var d=h;d<=e;d++){for(var l=k;l<=g;l++){this.grid.view.onCellDeselect(d,l)}}}});Ext.grid.RowNumberer.prototype.renderer=function(d,e,c,f){if(this.rowspan){e.cellAttr='rowspan="'+this.rowspan+'"'}return'<div class="rownumberer" style="text-align:left;background-color:#efefef;cursor:pointer;">'+(f+1)+"</div>"};Ext.grid.EditorPasteCopyGridPanel=Ext.extend(Ext.ui.XGridPanel,{clicksToEdit:"2",hideRowNumberer:false,afterConfig:function(c){c.sm=new Ext.grid.ExcelCellSelectionModel()},initComponent:function(){Ext.grid.EditorPasteCopyGridPanel.superclass.initComponent.call(this);this.addListener("render",this.addKeyMap,this);this.addListener("cellclick",this.onCellClick)},getView:function(){if(!this.view){this.view=new Ext.grid.GridView(this.viewConfig)}return this.view},onCellClick:function(d,l,f,h){var g=h.getTarget(".rownumberer");var k=Ext.get(d.getView().getRow(l));var c=d.store.getAt(l);if(g){if(k.hasClass("x-grid3-row-selected")){k.removeClass("x-grid3-row-selected");d.smSelections.remove(c)}else{k.addClass("x-grid3-row-selected");d.smSelections.add(c)}}else{d.getEl().select(".x-grid3-row").removeClass("x-grid3-row-selected");d.smSelections.clear();k.addClass("x-grid3-row-selected");d.smSelections.add(c)}},addKeyMap:function(){var c=this;this.body.on("mouseover",this.onMouseOver,this);this.body.on("mouseup",this.onMouseUp,this);new Ext.KeyMap(Ext.DomQuery.selectNode("div[class*=x-grid3-scroller]",this.getEl().dom).id,[{key:"c",ctrl:true,fn:function(){c.copyToClipBoard(c.getSelectionModel().getSelectedCellRange())}},{key:"v",ctrl:true,fn:function(){c.pasteFromClipBoard()}}])},onMouseOver:function(c){this.processEvent("mouseover",c)},onMouseUp:function(c){this.processEvent("mouseup",c)},copyToClipBoard:function(d){this.collectGridData(d);if(window.clipboardData&&clipboardData.setData){clipboardData.setData("text",this.tsvData)}else{var c=this.getHiddenTextArea(true);c.dom.value=this.tsvData;c.focus();c.dom.setSelectionRange(0,c.dom.value.length)}},collectGridData:function(h){var n=h[0],g=h[1],m=h[2],f=h[3];this.tsvData="";var e="";var l=this.getDisplayColumnModelConfig();for(var d=n;d<=m;d++){if(this.tsvData!=""){this.tsvData+="\n"}e="";for(var k=g;k<=f;k++){if(e!=""){e+="\t"}e+=this.store.getAt(d).get(l[k].dataIndex)}this.tsvData+=e}return this.tsvData},pasteFromClipBoard:function(){var c=this.getHiddenTextArea();c.dom.value="";c.focus()},updateGridData:function(){var n=this.hiddentextarea.getValue();n=n.split("\n");var d=[];var h=this.getSelectionModel().getSelectedCellRange();var m=this.getDisplayColumnModelConfig();if(!this.canSetValue(m,h[1])){Ext.tip("提示","该列不能编辑！");this.hiddentextarea.blur();return}var e=h[0];var f=[];if(n[0].split("\t").length==1&&((n.length==1)||(n.length==2&&n[1].trim()==""))){for(var l=h[0];l<=h[2];l++){for(var k=h[1];k<=h[3];k++){if(this.canSetValue(m,k)){this.store.getAt(l).set(m[k].dataIndex,n[0])}}f.push(this.store.getAt(l))}}else{var c=this.store.getCount(),o;for(var l=0;l<n.length;l++){if(n[l].trim()==""){continue}columns=n[l].split("\t");if(e>c-1){this.stopEditing();var g=this.insertAt({},e)}o=h[1];for(var k=0;k<columns.length;k++){if(this.canSetValue(m,o)){this.store.getAt(e).set(m[o].dataIndex,columns[k])}o++}f.push(this.store.getAt(e));e++}}this.fireEvent("paste",f);this.hiddentextarea.blur()},canSetValue:function(d,e){if(e<0){return false}var c=d[e];if(c&&(c.editor||c.paste!==false)){return true}else{return false}},getDisplayColumnModelConfig:function(){var c=[];this.getColumnModel().getColumnsBy(function(d){if(d.hidden!==true){c.push(d)}});return c},getHiddenTextArea:function(c){this.isCopy=c;if(!this.hiddentextarea){this.hiddentextarea=new Ext.Element(document.createElement("textarea"));this.hiddentextarea.setStyle("left","-1000px");this.hiddentextarea.setStyle("position","absolute");this.hiddentextarea.setStyle("z-index","-1");this.hiddentextarea.setStyle("width","100px");this.hiddentextarea.setStyle("height","1px");this.hiddentextarea.addListener("keyup",function(){if(this.isCopy!==true){this.updateGridData()}},this);Ext.get(this.getEl().dom.firstChild).appendChild(this.hiddentextarea.dom)}return this.hiddentextarea}});Ext.reg("editorPasteCopyGrid",Ext.grid.EditorPasteCopyGridPanel);Ext.namespace("Ext.ux.layout");Ext.ux.layout.RowFitLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,trackChildEvents:["collapse","expand","hide","show"],renderAll:function(c,d){Ext.ux.layout.RowFitLayout.superclass.renderAll.apply(this,arguments);c.on("add",this.containerListener);c.on("remove",this.containerListener)},renderItem:function(h,d,f){Ext.ux.layout.RowFitLayout.superclass.renderItem.apply(this,arguments);for(var e=0,g=this.trackChildEvents.length;e<g;e++){h.on(this.trackChildEvents[e],this.itemListener)}h.animCollapse=false;h.rowFit={hasAbsHeight:false,relHeight:0,calcRelHeight:0,calcAbsHeight:0};if(h.height){if(typeof h.height=="string"&&h.height.indexOf("%")){h.rowFit.relHeight=parseInt(h.height)}else{h.setHeight(h.height-h.getEl().getMargins("tb"));h.rowFit.hasAbsHeight=true}}},onLayout:function(k,l){Ext.ux.layout.RowFitLayout.superclass.onLayout.call(this,k,l);if(this.container.collapsed||!k.items||!k.items.length){return}var e=0,s=0,o=1,m=[],t=0;for(var g=0,d=k.items.length;g<d;g++){var r=k.items.itemAt(g);if(!r.isVisible()){continue}if(r.collapsed){e+=r.getFrameHeight()+r.getEl().getMargins("tb")}else{if(r.rowFit.hasAbsHeight){e+=r.height}else{if(!r.rowFit.relHeight){t++}else{s+=r.rowFit.relHeight}m.push(r)}}}if(t==0&&s!=100){o=100/s}var v=l.getStyleSize().height-e,f=v;while(m.length){var r=m.shift(),h=r.rowFit.relHeight*o,u=0;if(!h){h=(100-s)/t}if(!m.length){u=f}else{u=Math.round(v*h/100)}if(u<0){u=0}u=u-r.getEl().getMargins("tb");r.rowFit.calcAbsHeight=u;r.rowFit.calcRelHeight=h;r.setHeight(u);f-=u}var q=(Ext.isIE6&&Ext.isStrict&&l.dom==document.body)?l.getViewSize():l.getStyleSize();for(var g=0,d=k.items.length;g<d;g++){var r=k.items.itemAt(g);if(!r.isVisible()){continue}r.setWidth(q.width)}},itemListener:function(c){c.ownerCt.doLayout()},containerListener:function(c){c.doLayout()}});if(Ext.SplitBar.BasicLayoutAdapter){Ext.ux.layout.RowFitLayout.SplitAdapter=function(e){if(e&&e.el.dom.nextSibling){var d=Ext.getCmp(e.el.dom.nextSibling.id),c=Ext.getCmp(e.resizingEl.id);if(d){e.maxSize=(c.height||c.rowFit.calcAbsHeight)+d.getInnerHeight()-1}e.minSize=c.getFrameHeight()+1}};Ext.extend(Ext.ux.layout.RowFitLayout.SplitAdapter,Ext.SplitBar.BasicLayoutAdapter,{setElementSize:function(h,k,d){var g=Ext.getCmp(h.resizingEl.id);if(!g||g.collapsed||!g.isVisible()){return}if(g.rowFit.hasAbsHeight){g.setHeight(k)}else{if(h.el.dom.nextSibling){var f=Ext.getCmp(h.el.dom.nextSibling.id),o=k-g.rowFit.calcAbsHeight,e=f.rowFit,n=g.rowFit,l=n.calcRelHeight/n.calcAbsHeight,m=l*o;n.relHeight=n.calcRelHeight+m;if(e.hasAbsHeight){var c=f.height-o;f.height=c;f.setHeight(c)}else{e.relHeight=e.calcRelHeight-m}}}g.ownerCt.doLayout()}})}Ext.Container.LAYOUTS.rowfit=Ext.ux.layout.RowFitLayout;Ext.layout.ColumnFitLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,extraCls:"x-column",scrollOffset:0,isValidParent:function(e,d){return(e.getPositionEl?e.getPositionEl():e.getEl()).dom.parentNode==this.innerCt.dom},renderItem:function(f,d,e){Ext.layout.ColumnFitLayout.superclass.renderItem.apply(this,arguments);f.columnFit={hasAbsWidth:false,relWidth:0,calcRelWidth:0,calcAbsWidth:0};if(f.width){if(typeof f.width=="string"&&f.width.indexOf("%")){f.columnFit.relWidth=parseInt(f.width)}else{f.setWidth(f.width-f.getEl().getMargins("lr"));f.columnFit.hasAbsWidth=true}}},onLayout:function(g,n){var k=g.items.items,l=k.length,q,e;if(!this.innerCt){n.addClass("x-column-layout-ct");this.innerCt=n.createChild({cls:"x-column-inner"});this.innerCt.createChild({cls:"x-clear"})}this.renderAll(g,this.innerCt);var u=Ext.isIE&&n.dom!=Ext.getBody().dom?n.getStyleSize():n.getViewSize();if(u.width<1&&u.height<1){return}var r=u.width-n.getPadding("lr")-this.scrollOffset,f=u.height-n.getPadding("tb"),s=r;this.innerCt.setWidth(r);var m=0,o=0,t=100;for(e=0;e<l;e++){q=k[e];if(q.columnFit.hasAbsWidth){s-=(q.getSize().width+q.getEl().getMargins("lr"))}else{if(!q.columnFit.relWidth){m++}}}s=s<0?0:s;for(e=0;e<l;e++){q=k[e];if(q.columnFit.relWidth){o+=q.columnFit.relWidth}}if(o>t){t=o}var d=s-Math.floor(o/t*s);for(e=0;e<l;e++){q=k[e];if(!q.columnFit.hasAbsWidth){if(q.columnFit.relWidth){q.setSize(Math.floor(q.columnFit.relWidth/t*s)-q.getEl().getMargins("lr"),f)}else{if(d){q.setSize(Math.floor(d/m)-q.getEl().getMargins("lr"),f)}}}else{q.setSize(undefined,f)}}}});Ext.Container.LAYOUTS.columnfit=Ext.layout.ColumnFitLayout;Ext.namespace("Ext.ux.layout");Ext.ux.layout.TableFormLayout=Ext.extend(Ext.layout.TableLayout,{monitorResize:true,labelSeparator:":",setContainer:function(){Ext.layout.FormLayout.prototype.setContainer.apply(this,arguments);this.currentRow=0;this.currentColumn=0;this.cells=[]},renderItem:function(g,e,f){if(g&&!g.rendered){if(g instanceof Ext.form.Hidden){Ext.layout.FormLayout.prototype.renderItem.call(this,g,0,f)}else{var d=Ext.get(this.getNextCell(g));d.addClass("x-table-layout-column-"+this.currentColumn);Ext.layout.FormLayout.prototype.renderItem.call(this,g,0,d)}}},onLayout:function(f,D){Ext.ux.layout.TableFormLayout.superclass.onLayout.call(this,f,D);if(!D.hasClass("x-table-form-layout-ct")){D.addClass("x-table-form-layout-ct")}var k=this.getLayoutTargetSize(f,D);var r,z;if(f.anchorSize){if(typeof f.anchorSize=="number"){r=f.anchorSize}else{r=f.anchorSize.width;z=f.anchorSize.height}}else{r=f.initialConfig.width;z=f.initialConfig.height}var l=this.getRenderedItems(f),y=l.length,u,A,C,e,s,d,t,n=[];var o,q,v,g,B,m;for(u=0;u<y;u++){A=l[u];if(A instanceof Ext.form.Hidden){continue}o=A.getEl().parent(".x-table-layout-cell");if(this.columnWidths){g=parseInt(o.dom.className.replace(/.*x\-table\-layout\-column\-([\d]+).*/,"$1"));B=0,m=0;for(j=g;j<(g+(A.colspan||1));j++){B+=this.columnWidths[j];m+=10}q=(k.width*B)-m}else{q=(k.width/this.columns)*(A.colspan||1)}o.setWidth(q);q=q-10;v=o.getHeight();if(!A.anchor&&A.items&&!Ext.isNumber(A.width)&&!(Ext.isIE6&&Ext.isStrict)){A.anchor=this.defaultAnchor}if(A.anchor){C=A.anchorSpec;if(!C){t=A.anchor.split(" ");A.anchorSpec=C={right:this.parseAnchor(t[0],A.initialConfig.width,r),bottom:this.parseAnchor(t[1],A.initialConfig.height,z)}}e=C.right?this.adjustWidthAnchor(C.right(q),A):undefined;s=C.bottom?this.adjustHeightAnchor(C.bottom(v),A):undefined;if(e||s){n.push({comp:A,width:e||undefined,height:s||undefined})}}}for(u=0,y=n.length;u<y;u++){A=n[u];A.comp.setSize(A.width,A.height)}},parseAnchor:function(d,h,c){if(d&&d!="none"){var f;if(/^(r|right|b|bottom)$/i.test(d)){var g=c-h;return function(k){if(k!==f){f=k;return k-g}}}else{if(d.indexOf("%")!=-1){var e=parseFloat(d.replace("%",""))*0.01;return function(k){if(k!==f){f=k;return Math.floor(k*e)}}}else{d=parseInt(d,10);if(!isNaN(d)){return function(k){if(k!==f){f=k;return k+d}}}}}}return false},renderAll:function(g,h){var e=g.items.items,f,k,d=e.length;for(f=0;f<d;f++){k=e[f];if(k&&(!k.rendered||!this.isValidParent(k,h))){this.renderItem(k,f,h)}}},adjustWidthAnchor:function(d,c){return d-(c.isFormField?(c.hideLabel?0:this.labelAdjust):0)},adjustHeightAnchor:function(d,c){return d},isValidParent:function(e,d){return e.getPositionEl().up("table",6).dom.parentNode===(d.dom||d)},getLayoutTargetSize:Ext.layout.AnchorLayout.prototype.getLayoutTargetSize,parseAnchorRE:Ext.layout.AnchorLayout.prototype.parseAnchorRE,parseAnchor:Ext.layout.AnchorLayout.prototype.parseAnchor,getTemplateArgs:Ext.layout.FormLayout.prototype.getTemplateArgs,isValidParent:Ext.layout.FormLayout.prototype.isValidParent,onRemove:Ext.layout.FormLayout.prototype.onRemove,isHide:Ext.layout.FormLayout.prototype.isHide,onFieldShow:Ext.layout.FormLayout.prototype.onFieldShow,onFieldHide:Ext.layout.FormLayout.prototype.onFieldHide,adjustWidthAnchor:Ext.layout.FormLayout.prototype.adjustWidthAnchor,adjustHeightAnchor:Ext.layout.FormLayout.prototype.adjustHeightAnchor,getLabelStyle:Ext.layout.FormLayout.prototype.getLabelStyle,trackLabels:Ext.layout.FormLayout.prototype.trackLabels});Ext.Container.LAYOUTS.tableform=Ext.ux.layout.TableFormLayout;Ext.ErrorWindow=Ext.extend(Ext.Window,{cls:"x-window-dlg",buttonAlign:"center",width:300,height:150,title:"出错了",plain:true,closable:true,autoScroll:true,maximizable:true,fn:Ext.emptyFn,msg:"请传入msg",detail:"请传入detail",initComponent:function(){this.buttons=[{text:"",hidden:true}];Ext.ErrorWindow.superclass.initComponent.apply(this,arguments);var c=this;this.addButton({text:"确定",handler:function(){if(c.fn){c.fn()}c.close()}});this.moreButton=this.addButton({text:"更多>>",handler:function(){c.more()}})},more:function(){this.toggleMaximize();if(this.detail.isDisplayed()){this.moreButton.setText("更多>>");this.detail.hide()}else{this.moreButton.setText("<<返回");this.detail.show()}},afterRender:function(){Ext.ErrorWindow.superclass.afterRender.apply(this,arguments);this.msg=this.body.createChild({html:"<font color=red size=3>"+this.msg+"</font>"});this.detail=this.body.createChild({tag:"textarea",style:"display:block;width:auto;height:auto;",html:this.detail});this.detail.enableDisplayMode();this.detail.hide();var c=this;this.on("resize",function(){var d=c.body.getWidth()-10;var e=c.body.getHeight()-c.msg.getHeight();c.detail.setSize(d,e,false)})}});Ext.error=function(f,d,c){var e=Ext.createUI("Ext.ErrorWindow",{msg:f,detail:d,fn:c||Ext.emptyFn});e.show();return e};Ext.ns("Ext.ui");Ext.ui.Msg=function(){var d;function c(e,f){return['<div class="msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',e,"</h3>",f,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")}return{show:function(k,h){if(!d){d=Ext.DomHelper.insertFirst(document.body,{id:Ext.id()+"msg-div",style:"position:absolute;z-index:10000;width:250px;"},true);d.alignTo(document,"t-t",[0,10])}var f=String.format.apply(String,Array.prototype.slice.call(arguments,1));var e=Ext.DomHelper.append(d,{html:c(k,f)},true);var g=this;g.fx(e);e.on("mouseover",function(){e.stopFx()});e.on("mouseout",function(){e.pause(Ext.tipTimeout?Ext.tipTimeout:2).ghost("t",{remove:true})});return this},fx:function(e){e.slideIn().pause(Ext.tipTimeout?Ext.tipTimeout:2).ghost("t",{remove:true})},showAt:function(e,f){f=f||"tl-tr";if(e instanceof Ext.Component){e=e.wrap||e.el||document}d.alignTo(e,f);return this}}}();Ext.tip=function(c){if(Ext.type(c)=="string"){return Ext.ui.Msg.show.apply(Ext.ui.Msg,arguments)}else{if(Ext.type(c)=="object"){if(c.success){return Ext.ui.Msg.show.call(Ext.ui.Msg,"提示",c.msg)}else{Ext.error(c.msg,c.detail)}}}};Ext.ns("Ext.ui");Ext.ns("Ext.ux.form");Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(e,c){Ext.ux.form.FileUploadField.superclass.onRender.call(this,e,c);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var d=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(d,{renderTo:this.wrap,cls:"x-form-file-btn"+(d.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var c=this.fileInput.dom.value;this.setValue(c);this.fireEvent("fileselected",this,c)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){if(this.rendered){this.fileInput.remove();this.createFileInput();this.bindListeners()}Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(c,d){Ext.ux.form.FileUploadField.superclass.onResize.call(this,c,d);this.wrap.setWidth(c);if(!this.buttonOnly){var c=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(c)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(c){this.fileInput.dom.disabled=c;this.button.setDisabled(c)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])},uploadFileTypes:[],validateValue:function(f){if(f.length<1||f===this.emptyText){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(f.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(f.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var h=Ext.form.VTypes;if(!h[this.vtype](f,this)){this.markInvalid(this.vtypeText||h[this.vtype+"Text"]);return false}}if(typeof this.validator=="function"){var g=this.validator(f);if(g!==true){this.markInvalid(g);return false}}if(this.regex&&!this.regex.test(f)){this.markInvalid(this.regexText);return false}var d=this.uploadFileTypes;var c=false;for(var e=0;e<d.length;e++){if(new RegExp("^.*"+d[e].toLowerCase()+"$").test(String(f).toLowerCase())){c=true;break}}if(d.length>0&&c==false){this.markInvalid("请上传文件类型为:"+d.join(",")+" 的文件");return false}return true}});Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.form.UploadField=Ext.ux.form.FileUploadField;Ext.ui.UploadField=Ext.ux.form.FileUploadField;Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.reg("uploadfield",Ext.ux.form.FileUploadField);Ext.ui.ImageUploadField=Ext.extend(Ext.form.TextField,{autoCreate:{cls:"x-form-field-wrap x-form-file-wrap",style:"position:relative;height:auto;"},setValue:function(c){this.value=c;if(this.rendered){if(c==undefined||c==null){this.img.dom.src=this.defaultUrl||Ext.BLANK_IMAGE_URL}else{this.img.dom.src=c}this.img.on("load",function(){this.fireEvent("imgload")},this,{single:true})}},initComponent:function(){Ext.ui.ImageUploadField.superclass.initComponent.apply(this,arguments);var c=this;this.on("imgload",function(){this.reAlign()})},initValue:function(){this.setValue(this.value)},getValue:function(){return this.value||this.fileField.dom.value},getRawValue:function(){return this.value||this.fileField.dom.value},reAlign:function(){this.button.el.anchorTo(this.el,"r-r");this.fileField.anchorTo(this.el,"r-r")},onRender:function(d){Ext.ui.ImageUploadField.superclass.onRender.apply(this,arguments);this.img=this.el.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,height:this.imgHeight||50,style:"border:1px solid #cfcfcf;"});this.img.on("load",function(){this.fireEvent("imgload")},this,{single:true});this.fileField=this.el.createChild({tag:"input",type:"file",style:"position: absolute;right: 0;-moz-opacity: 0;filter:alpha(opacity: 0);opacity: 0;z-index: 2;z-index:999;",name:this.name});var c=this.buttonConfig||{};this.button=new Ext.Button(Ext.apply(c,{renderTo:this.el,text:c.text||"浏览",cls:"x-form-file-btn"+(c.iconCls?" x-btn-icon":"")}));this.button.el.setStyle("position","absolute");this.reAlign();this.fileField.on({scope:this,change:function(){this.setValue(this.getFileFieldValue());this.fireEvent("fileselected",this,this.getFileFieldValue())}})},getOs:function(){var c="";if(navigator.userAgent.indexOf("MSIE")>0){return"MSIE"}if(isFirefox=navigator.userAgent.indexOf("Firefox")>0){return"Firefox"}if(isSafari=navigator.userAgent.indexOf("Safari")>0){return"Safari"}if(isCamino=navigator.userAgent.indexOf("Camino")>0){return"Camino"}if(isMozilla=navigator.userAgent.indexOf("Gecko/")>0){return"Gecko"}},getFileFieldValue:function(){function c(g){return document.getElementById(g).value}function d(h){var g=document.getElementById(h).files[0];return window.URL.createObjectURL(g)}var f="";var e=this.fileField.id;if("MSIE"==this.getOs()){f=c(e)}else{f=d(e)}return f},setImgWidth:function(c){if(c){this.img.setWidth(c)}},setWidth:function(c){this.setImgWidth(c);Ext.ui.ImageUploadField.superclass.setWidth.apply(this,arguments)},setSize:function(c,d){if(typeof c=="object"){d=c.height;c=c.width}Ext.ui.ImageUploadField.superclass.setSize.apply(this,arguments);this.reAlign();this.setImgWidth(c)}});Ext.reg("imageuploadfield",Ext.ui.ImageUploadField);(function(){var c=Ext.form.Field.prototype.onRender;var d=Ext.form.Field.prototype.onResize;var l=Ext.form.Field.prototype.reset;var n=Ext.form.Field.prototype.onDestroy;var g=Ext.form.Field.prototype.onDisable;var h=Ext.form.Field.prototype.onEnable;var f=Ext.form.Field.prototype.initComponent;var m=function(o){return(typeof o=="undefined"||o==null)};var e=function(o){return typeof o=="function"};function k(){if(this.rendered){var r=this.readOnly===true;if(!m(this.readOnly)){var q=this.getEl();q.dom.setAttribute("readOnly",r);q.dom.readOnly=r;var o=q.up(".x-form-item");if(o){o=o.down(".x-form-item-label")}if(o){this._readOnlyBackGroundColor=this._readOnlyBackGroundColor||q.getStyle("background-color");this._readOnlyBackGroundImage=this._readOnlyBackGroundImage||q.getStyle("background-image");if(r){o.applyStyles(this.defaultLabelIfReadOnlyStyle)}else{this.removeStyleByString(o,this.defaultLabelIfReadOnlyStyle);o.applyStyles(this.lastLabelStyle)}}if(r){q.setStyle("background-color",this.readOnlyBackGroundColor||this._readOnlyBackGroundColor);q.setStyle("background-image","none")}else{if(this._readOnlyBackGroundColor){q.setStyle("background-color",this._readOnlyBackGroundColor)}if(this._readOnlyBackGroundImage){q.setStyle("background-image",this._readOnlyBackGroundImage)}}}}}Ext.override(Ext.form.Field,{getForm:function(){var o;if(this.ownerCt){this.ownerCt.bubble(function(q){if(q.form){o=q.form;return false}},this)}return o},removeStyleByString:function(s,r){var q=this.cssTextToMap(s.dom.style.cssText.toUpperCase());var u=this.cssTextToMap(r.toUpperCase());for(var t in u){delete q[t]}var o="";for(t in q){o=o+t+":"+q[t]+";"}s.dom.style.cssText=o},readOnlyBackGroundColor:"#e0e0e0",cssTextToMap:function(q){var o=/\s?([a-z\-]*)\:\s?([^;]*);?/gi;var r;var s={};while((r=o.exec(q))!=null){s[r[1]]=r[2]}return s},setReadOnly:function(o){this.readOnly=o;k.call(this)},disableTrigger:function(){this.setTriggerDisable(true)},enableTrigger:function(){this.setTriggerDisable(false)},setTriggerDisable:function(o){this.triggerDisabled=o},initInterceptTrigger:function(){var o=this;if(e(o.expand)){o.expand=o.expand.createInterceptor(function(){return !o.triggerDisabled})}if(e(o.onTriggerClick)){o.onTriggerClick=o.onTriggerClick.createInterceptor(function(){return !o.triggerDisabled})}if(e(o.onClick)){o.onClick=o.onClick.createInterceptor(function(){if(o.triggerDisabled){this.el.dom.checked=o.checked}return !o.triggerDisabled})}if(e(o.setValue)&&o instanceof Ext.form.Checkbox){o.setValue=o.setValue.createInterceptor(function(){return !o.triggerDisabled})}},initComponent:function(){f.apply(this,arguments);this.decorateTheLabelIfReadOnly();this.decorateTheLabelIfNotAllowBlank();this.on("render",function(){k.call(this)})},onRender:function(s,r){c.apply(this,arguments);var x=this.appenders||[];this.appenders=x;var u=this;if(x.length>0){var o=u.getForm();u.wrap=u.el.wrap({tag:"div"});u.el.wrap({tag:"div",style:"float: left;"});for(var q=0,t=x.length;q<t;q++){delete x[q].appenders;var w=u.wrap.createChild({tag:"div",style:"float: left;"});var v=new Ext.ComponentMgr.create(x[q],"button");x[q]=v;v.parentCell=w;v.master=u;v.render(w);if(o&&v.isFormField){o.items.add(v)}}if(x.length){u.wrap.createChild({tag:"div",cls:"x-form-clear"})}}setTimeout(function(){if(u.enableSearch){var z=u.el.hasClass("x-form-field")?u.el:u.el.select(".x-form-field",true);if(z){var B=z.wrap({tag:"span",cls:"x-form-field-wrap",style:"position: relative;display:inline-block;"});var A=B.createChild({tag:"span",style:"position:absolute;top:0;right:0;display:none;",html:'<img class="x-form-trigger x-form-clear-trigger " src="'+Ext.BLANK_IMAGE_URL+'">'});var y=A.first();y.addClassOnOver("x-form-trigger-over");y.addClassOnClick("x-form-trigger-click");u.cross=A;u.cross.on("click",u.onCrossClick,u);u.on("specialkey",function(C,D){if(D.getKey()==D.ENTER){u.onEnterKey()}},u)}}},1);if(this.qtip){if(this.wrap){this.wrap.set({qtip:this.qtip})}if(this.el){this.el.set({qtip:this.qtip})}}this.initInterceptTrigger();if(this.readOnly===true){this.setReadOnly(true)}},defaultLabelIfNotAllowBlankStyle:"",decorateTheLabelIfNotAllowBlank:function(){if(this.allowBlank===false&&Ext.isBlank(this.labelStyle)){this.labelStyle=this.defaultLabelIfNotAllowBlankStyle;this.fieldLabel=this.fieldLabel+'<span style="color:#D30B0A;">*</span>'}},defaultLabelIfReadOnlyStyle:"",decorateTheLabelIfReadOnly:function(){this.lastLabelStyle=this.labelStyle;if(this.readOnly===true){this.labelStyle=this.defaultLabelIfReadOnlyStyle}},onCrossClick:function(){this.reset();this.fireEvent("search",false,this);this.hideCross()},onEnterKey:function(){var o=this.getRawValue();if(o.length<1){this.onCrossClick();return}this.showCross();this.fireEvent("search",true,this)},showCross:function(){this.cross.show();if(this instanceof Ext.form.TriggerField){this.cross.setStyle("right",17)}},hideCross:function(){this.cross.hide()},hasAppender:function(){return this.appenders&&this.appenders.length>0},eachAppender:function(o){if(this.hasAppender()){Ext.each(this.appenders,o)}},reset:function(){l.apply(this,arguments)},onResize:function(o,r){d.call(this,o,r);if(this.hasAppender()){this.wrap.setWidth(o);var q=0;this.eachAppender(function(s){q=q+s.parentCell.getWidth()});var o=this.wrap.getWidth()-q;o=o<20?20:o;this.el.setWidth(o)}},onDestroy:function(){n.apply(this,arguments);this.eachAppender(function(o){Ext.destroy(o)});if(this.hasAppender()){Ext.destroy(this.wrap)}},onDisable:function(){g.apply(this,arguments);this.eachAppender(function(o){o.disable()})},onEnable:function(){h.apply(this,arguments);this.eachAppender(function(o){o.enable()})}});Ext.form.FormPanel.prototype.setReadOnly=function(o){this.cascade(function(s){if(s.isFormField){s.setReadOnly(o);s.setTriggerDisable(true)}if(s instanceof Ext.Panel){var r=s.getTopToolbar();var q=s.getBottomToolbar();if(r){r.setDisabled(o)}if(q){q.setDisabled(o)}}})};Ext.override(Ext.form.HtmlEditor,{setReadOnly:function(q){if(q){this.syncValue();var o=this.wrap.mask();o.dom.style.filter="alpha(opacity=0);";o.dom.style.opacity="0";o.dom.style.background="white";o.dom.style.overflow="scroll";this.el.dom.readOnly=true}else{if(this.rendered){this.wrap.unmask()}this.el.dom.readOnly=false}}})})();Ext.override(Ext.Panel,{disableOpacity:0.5,onDisable:function(){if(this.rendered&&this.maskDisabled){var c=this.el.mask();c.setStyle("opacity",this.disableOpacity)}Ext.Panel.superclass.onDisable.call(this)}});(function(){var c=Ext.Window.prototype.initComponent;Ext.Window.prototype.modal=true;Ext.Window.prototype.maximizable=true;Ext.Window.prototype.initComponent=function(){this.on("beforerender",function(){if(this.pWidth&&this.pHeight){var e=Ext.getBody().getViewSize();var f=e.width*this.pWidth;var d=e.height*this.pHeight;if(this.width){this.width=f>this.width?this.width:f}else{this.width=f}if(this.height){this.height=d>this.height?this.height:d}else{this.height=d}}},this);c.apply(this,arguments)}})();Ext.apply(Ext.form.VTypes,{daterange:function(h,g){var d=g.parseDate(h);var f=function(k){var l=k.activeDate;k.activeDate=null;k.update(l)};if(g.startDateField){var e=Ext.getCmp(g.startDateField);e.maxValue=d;if(e.menu&&e.menu.picker){e.menu.picker.maxDate=d;f(e.menu.picker)}}else{if(g.endDateField){var c=Ext.getCmp(g.endDateField);c.minValue=d;if(c.menu&&c.menu.picker){c.menu.picker.minDate=d;f(c.menu.picker)}}}return true},password:function(e,d){if(d.initialPassField){var c=Ext.getCmp(d.initialPassField);return(e==c.getValue())}return true},passwordText:"两次输入的密码不一致！",chinese:function(e,d){var c=/^[\u4e00-\u9fa5]+$/i;if(!c.test(e)){return false}return true},chineseText:"请输入中文",datecn:function(k,g){try{var c=/^(\d{4})-(\d{2})-(\d{2})$/;if(!c.test(k)){return false}var h=new Date(k.replace(c,"$1/$2/$3"));return(parseInt(RegExp.$2,10)==(1+h.getMonth()))&&(parseInt(RegExp.$3,10)==h.getDate())&&(parseInt(RegExp.$1,10)==h.getFullYear())}catch(f){return false}},datecnText:"请使用这样的日期格式: yyyy-mm-dd. 例如:2008-06-20.",ip:function(f,d){try{if((/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(f))){return true}return false}catch(c){return false}},ipText:"请输入正确的IP地址",phone:function(f,d){try{if(/^(?:\d{3}-\d{8}|\d{4}-\d{7})$/.test(f)){return true}return false}catch(c){return false}},phoneText:"请输入正确的电话号码,如:027-29392929",mobilephone:function(f,d){try{if(/^(?:13|15|18)\d{9}$/.test(f)){return true}return false}catch(c){return false}},mobilephoneText:"请输入正确的11位手机号码"});Ext.ns("Ext.ui");Ext.ux.MonthPicker=Ext.extend(Ext.Component,{okText:"&#160;确定&#160;",cancelText:"&#160;取消&#160;",todayTip:"{0} (Spacebar)",minText:"This date is before the minimum date",maxText:"This date is after the maximum date",format:"Y-m",disabledDaysText:"Disabled",disabledDatesText:"Disabled",constrainToViewport:true,monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",initComponent:function(){Ext.ux.MonthPicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime():new Date().clearTime();this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this)}},setMinDate:function(c){this.minDate=c;this.update(this.value,true)},setMaxDate:function(c){this.maxDate=c;this.update(this.value,true)},setValue:function(d){var c=this.value;this.value=d.clearTime(true);if(this.el){this.update(this.value)}},getValue:function(){return this.value},focus:function(){if(this.el){this.update(this.activeDate)}},hideMonthPicker:Ext.emptyFn,onRender:function(d,c){var e=['<table border="0" width="100%" cellspacing="0">'];for(var f=0;f<6;f++){e.push('<tr><td class="x-date-mp-month"><a href="#">',Date.getShortMonthName(f),"</a></td>",'<td class="x-date-mp-month x-date-mp-sep"><a href="#">',Date.getShortMonthName(f+6),"</a></td>",f===0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')}e.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,"</button></td></tr>","</table>");var g=document.createElement("div");g.className="x-date-picker x-unselectable";g.innerHTML=String.format('<div class="x-date-mp" style="display:block;position:static;width:156px;">{0}</div>',e.join(""));d.dom.insertBefore(g,c);this.el=Ext.get(g);this.monthPicker=this.el.down(".x-date-mp");this.mpMonths=this.monthPicker.select("td.x-date-mp-month");this.mpYears=this.monthPicker.select("td.x-date-mp-year");this.mpMonths.each(function(h,k,l){l+=1;if((l%2)==0){h.dom.xmonth=5+Math.round(l*0.5)}else{h.dom.xmonth=Math.round((l-1)*0.5)}});if(Ext.isIE){this.el.repaint()}this.monthPicker.on("click",this.onMonthClick,this);this.monthPicker.on("dblclick",this.onMonthDblClick,this);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPMonth();this.updateMPYear();this.update(this.value)},updateMPYear:function(){this.mpyear=this.mpSelYear;var e=this.mpYears.elements;for(var d=1;d<=10;d++){var f=e[d-1],c;if((d%2)==0){c=this.mpSelYear+Math.round(d*0.5);f.firstChild.innerHTML=c;f.xyear=c}else{c=this.mpSelYear-(5-Math.round(d*0.5));f.firstChild.innerHTML=c;f.xyear=c}this.mpYears.item(d-1)[c==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel");if((this.maxDate&&(this.maxDate.getFullYear()<c))||(this.minDate&&(this.minDate.getFullYear()>c))){Ext.get(e[d-1].firstChild).addClass("x-date-mp-disabled")}else{Ext.get(e[d-1].firstChild).removeClass("x-date-mp-disabled")}}},updateMPMonth:function(){var f=this.mpSelMonth;var e=this.mpSelYear;var d=this.maxDate;var c=this.minDate;this.mpMonths.each(function(g,h,k){g[g.dom.xmonth==f?"addClass":"removeClass"]("x-date-mp-sel");if((d&&(d.getFullYear()<e))||(d&&(d.getFullYear()==e)&&(d.getMonth()<g.dom.xmonth))||(c&&(c.getFullYear()>e))||(c&&(c.getFullYear()==e)&&(c.getMonth()>g.dom.xmonth))){Ext.get(g.dom.firstChild).addClass("x-date-mp-disabled")}else{Ext.get(g.dom.firstChild).removeClass("x-date-mp-disabled")}});if((d&&(d.getFullYear()<e))||(d&&(d.getFullYear()==e)&&(d.getMonth()<f))||(c&&(c.getFullYear()>e))||(c&&(c.getFullYear()==e)&&(c.getMonth()>f))){}},onMonthClick:function(g,d){if(Ext.fly(d).hasClass("x-date-mp-disabled")){return}g.stopEvent();var f=new Ext.Element(d),c;if(f.is("button.x-date-mp-cancel")){this.hideMonthPicker()}else{if(f.is("button.x-date-mp-ok")){this.selectOk()}else{if(c=f.up("td.x-date-mp-month",2)){this.mpMonths.removeClass("x-date-mp-sel");c.addClass("x-date-mp-sel");this.mpSelMonth=c.dom.xmonth;this.updateMPMonth()}else{if(c=f.up("td.x-date-mp-year",2)){this.mpYears.removeClass("x-date-mp-sel");c.addClass("x-date-mp-sel");this.mpSelYear=c.dom.xyear;this.updateMPMonth()}else{if(f.is("a.x-date-mp-prev")){this.mpSelYear=this.mpyear-10;this.mpYears.removeClass("x-date-mp-sel");this.updateMPYear();this.updateMPMonth()}else{if(f.is("a.x-date-mp-next")){this.mpSelYear=this.mpyear+10;this.mpYears.removeClass("x-date-mp-sel");this.updateMPYear();this.updateMPMonth()}}}}}}},onMonthDblClick:function(g,d){if(Ext.fly(d).hasClass("x-date-mp-disabled")){return}g.stopEvent();var f=new Ext.Element(d),c;if(c=f.up("td.x-date-mp-month",2)){this.mpSelMonth=c.dom.xmonth;this.selectOk()}else{if(c=f.up("td.x-date-mp-year",2)){this.mpSelYear=c.dom.xyear;this.selectOk()}}},forceUpdate:function(){this.mpSelMonth=(this.activeDate||this.value).getMonth();this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPMonth();this.updateMPYear();this.update(this.value)},selectOk:function(){var c=new Date(this.mpSelYear,this.mpSelMonth,1);if(c.getMonth()!=this.mpSelMonth){c=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()}this.update(c);this.setValue(c);this.fireEvent("select",this,this.value)},update:function(e){this.activeDate=e;if(!this.internalRender){var c=this.el.dom.firstChild;var d=c.offsetWidth;this.el.setWidth(d+this.el.getBorderWidth("lr"));Ext.fly(c).setWidth(d);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){c.rows[0].cells[1].style.width=(d-(c.rows[0].cells[0].offsetWidth+c.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[e])}}}});Ext.reg("monthpicker",Ext.ux.MonthPicker);Ext.menu.MonthMenu=Ext.extend(Ext.menu.DateMenu,{initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.ux.MonthPicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE9m,ctCls:"x-menu-date-item",id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("show",this.picker.focus,this.picker);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}}});Ext.ux.MonthField=Ext.extend(Ext.form.TriggerField,{format:"Y-m",altFormats:"m/Y|m-Y|mY|m/01/Y|m-01-Y|m01Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d",disabledDaysText:"Disabled",disabledDatesText:"Disabled",minText:"The date in this field must be equal to or after {0}",maxText:"The date in this field must be equal to or before {0}",invalidText:"{0} is not a valid date - it must be in the format {1}",triggerClass:"x-form-date-trigger",defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off"},initComponent:function(){Ext.ux.MonthField.superclass.initComponent.call(this);if(typeof this.minValue=="string"){this.minValue=this.parseDate(this.minValue)}if(typeof this.maxValue=="string"){this.maxValue=this.parseDate(this.maxValue)}this.ddMatch=null},setMinValue:function(c){this.minValue=(typeof c=="string"?this.parseDate(c):c);if(this.menu){this.menu.picker.setMinDate(this.minValue)}},setMaxValue:function(c){this.maxValue=(typeof c=="string"?this.parseDate(c):c);if(this.menu){this.menu.picker.setMaxDate(this.maxValue)}},validateValue:function(g){g=this.formatDate(g);if(!Ext.ux.MonthField.superclass.validateValue.call(this,g)){return false}if(g.length<1){return true}var e=g;g=this.parseDate(g);if(!g){this.markInvalid(String.format(this.invalidText,e,this.format));return false}var h=g.getTime();if(this.minValue&&h<this.minValue.getTime()){this.markInvalid(String.format(this.minText,this.formatDate(this.minValue)));return false}if(this.maxValue&&h>this.maxValue.getTime()){this.markInvalid(String.format(this.maxText,this.formatDate(this.maxValue)));return false}if(this.disabledDays){var c=g.getDay();for(var d=0;d<this.disabledDays.length;d++){if(c===this.disabledDays[d]){this.markInvalid(this.disabledDaysText);return false}}}var f=this.formatDate(g);if(this.ddMatch&&this.ddMatch.test(f)){this.markInvalid(String.format(this.disabledDatesText,f));return false}return true},validateBlur:function(){return !this.menu||!this.menu.isVisible()},getValue:function(){return this.value||this.parseDate(Ext.ux.MonthField.superclass.getValue.call(this))||""},setValue:function(c){if(typeof c=="string"){Ext.ux.MonthField.superclass.setValue.call(this,c)}else{Ext.ux.MonthField.superclass.setValue.call(this,this.formatDate(this.parseDate(c)));this.value=c}},parseDate:function(f){if(!f||Ext.isDate(f)){return f}var d=Date.parseDate(f,this.format);if(!d&&this.altFormats){if(!this.altFormatsArray){this.altFormatsArray=this.altFormats.split("|")}for(var e=0,c=this.altFormatsArray.length;e<c&&!d;e++){d=Date.parseDate(f,this.altFormatsArray[e])}}return d},onRender:function(){Ext.ux.MonthField.superclass.onRender.apply(this,arguments);if(this.showPrevNextTrigger){this.trigger.applyStyles("position:static;vertical-align: middle;");this.prevTrigger=this.el.insertSibling({tag:"img",src:Ext.BLANK_IMAGE_URL,style:"position:static;vertical-align: middle;",cls:"x-form-trigger x-datepickerplus-fieldprev"});this.prevTrigger.addClassOnOver("x-form-trigger-over");this.prevTrigger.addClassOnClick("x-form-trigger-click");this.prevTrigger.on("click",function(){var c=this.getValue(),d=new Date();if(Ext.isDate(c)){}else{c=d}var f=c.getDate(),h=c.getMonth()-1,g=c.getFullYear(),e=0;if(h==-1){h=11;g--}else{e=new Date(g,h,1).getDaysInMonth();if(f>e){f=e}}d=new Date(g,h,f);this.setValue(d);this.fireEvent("select",this,d)},this);this.nextTrigger=this.trigger.insertSibling({tag:"img",src:Ext.BLANK_IMAGE_URL,style:"position:static;vertical-align: middle;",cls:"x-form-trigger x-datepickerplus-fieldnext"},"after");this.nextTrigger.addClassOnOver("x-form-trigger-over");this.nextTrigger.addClassOnClick("x-form-trigger-click");this.nextTrigger.on("click",function(){var c=this.getValue(),d=new Date();if(Ext.isDate(c)){}else{c=d}var f=c.getDate(),h=c.getMonth()+1,g=c.getFullYear(),e=0;if(h==12){h=0;g++}else{e=new Date(g,h,1).getDaysInMonth();if(f>e){f=e}}d=new Date(g,h,f);this.setValue(d);this.fireEvent("select",this,d)},this)}},onResize:function(c,f){Ext.form.TriggerField.superclass.onResize.call(this,c,f);var d=this.trigger.getWidth();var e=d;if(this.showPrevNextTrigger){e+=this.prevTrigger.getWidth()+this.nextTrigger.getWidth()}if(!isNaN(c)){this.el.setWidth(c-e)}},onDestroy:function(){if(this.menu){this.menu.destroy()}if(this.wrap){this.wrap.remove()}Ext.ux.MonthField.superclass.onDestroy.call(this)},formatDate:function(c){return Ext.isDate(c)?c.dateFormat(this.format):c},menuListeners:{select:function(c,e){this.setValue(e);this.fireEvent("select",this,e)},show:function(){this.onFocus()},hide:function(){this.focus.defer(10,this);var c=this.menuListeners;this.menu.un("select",c.select,this);this.menu.un("show",c.show,this);this.menu.un("hide",c.hide,this)}},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.MonthMenu()}Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.ddMatch,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");this.menu.picker.forceUpdate()},beforeBlur:function(){}});Ext.reg("monthfield",Ext.ux.MonthField);Ext.ui.MonthField=Ext.ux.MonthField;Ext.ns("Ext.ui");Ext.data.WeekDataProxy=Ext.extend(Ext.data.DataProxy,{load:function(h,n,r,s,t){var u;try{var q=h.start||new Date();var k=h.limit||10;var l=1-q.format("N");q=q.add(Date.DAY,l);var c=new Array();for(var m=0;m<k;m++){var f=q;var g=q.add(Date.DAY,6);var d=new Array();d.push(q.format("o"));d.push(q.format("W"));d.push(q.format("oW"));d.push(q.format("o")+"年"+q.format("W")+"周");d.push(f.format("Y-m-d"));d.push(g.format("Y-m-d"));c.push(d);q=g.add(Date.DAY,1)}u=n.readRecords(c)}catch(o){this.fireEvent("loadexception",this,t,null,o);r.call(s,null,t,false);return}r.call(s,u,t,true)}});Ext.data.WeekStore=function(c){this.reader=new Ext.data.ArrayReader({},Ext.data.Record.create(["y","w","yw","ywt","s","e"]));this.proxy=new Ext.data.WeekDataProxy();Ext.apply(this,c);Ext.data.WeekStore.superclass.constructor.call(this,c)};Ext.extend(Ext.data.WeekStore,Ext.data.Store,{load:function(c){c=c||{};this.storeOptions(c);var d=Ext.apply(c.params||{},this.baseParams);this.proxy.load(d,this.reader,this.loadRecords,this,c);return true},loadRecords:function(g,c,f){if(!g||f===false){if(f!==false){this.fireEvent("load",this,[],c)}if(c.callback){c.callback.call(c.scope||this,[],c,false)}return}var e=g.records,d=g.totalRecords||e.length;if(!c||c.add!==true){this.data.clear();this.data.addAll(e);this.totalLength=d;this.applySort();this.fireEvent("datachanged",this)}else{this.totalLength=Math.max(d,this.data.length+e.length);this.add(e)}this.fireEvent("load",this,e,c);if(c.callback){c.callback.call(c.scope||this,e,c,true)}}});Ext.ui.WeekField=Ext.extend(Ext.form.ComboBox,{listWidth:160,hiddenName:"WEEK",valueField:"yw",displayField:"ywt",pageSize:6,weekOffset:2,startDay:null,initComponent:function(){this.store=new Ext.data.WeekStore();this.mode="local";Ext.ui.WeekField.superclass.initComponent.call(this)},initValue:function(){if(this.startDay){var c=this.startDay.format("o")+"年"+this.startDay.format("W")+"周";this.value=c}Ext.form.ComboBox.superclass.initValue.call(this);if(this.startDay){this.value=this.startDay.format("oW")}if(this.hiddenField){this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:""}},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus({});if(this.startDay){this.doQuery(this.startDay.add(Date.DAY,this.weekOffset*-7),true)}else{this.doQuery(new Date(),true)}this.el.focus()}},onSelect:function(c,d){if(this.fireEvent("beforeselect",this,c,d)!==false){this.setValue(c.data[this.valueField||this.displayField]);this.selectWeek=c.data;this.startDay=Date.parseDate(c.get("s"),"Y-m-d");this.collapse();this.fireEvent("select",this,c,d)}},onLoad:function(){if(this.store.getCount()>0){this.pageStartDay=Date.parseDate(this.store.getAt(0).get("s"),"Y-m-d");this.expand();this.restrictHeight();if(this.editable){this.el.dom.select()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{this.onEmptyResults()}},initList:function(){if(!this.list){var c="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[c,this.listClass].join(" "),constrain:false});var d=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(d);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.title){this.header=this.list.createChild({cls:c+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:c+"-inner"});this.innerList.on("mouseover",this.onViewOver,this);this.innerList.on("mousemove",this.onViewMove,this);this.innerList.setWidth(d-this.list.getFrameWidth("lr"));this.footer=this.list.createChild({cls:c+"-ft"});this.pageTb=new Ext.Toolbar({items:["->",{tooltip:"上"+this.pageSize+"周",cls:"x-btn-icon",icon:_base+"/style/ex-icon/resultset_previous.gif",handler:function(){this.store.load({params:{start:this.pageStartDay.add(Date.DAY,this.pageSize*-7),limit:this.pageSize}})},scope:this},{tooltip:"下"+this.pageSize+"周",cls:"x-btn-icon",icon:_base+"/style/ex-icon/resultset_next.gif",handler:function(){this.store.load({params:{start:this.pageStartDay.add(Date.DAY,this.pageSize*7),limit:this.pageSize}})},scope:this}],renderTo:this.footer});this.assetHeight+=this.footer.getHeight();if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for="."><div  class="'+c+'-item">',"<b>{ywt}</b><br/> {s}/{e}","</div></tpl>")}this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+c+"-item"});this.view.on("click",this.onViewClick,this);this.bindStore(this.store,true);if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(g,e,f){this.maxHeight=f-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=e;this.innerList.setWidth(e-this.list.getFrameWidth("lr"));this.restrictHeight()},this);this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")}}},doQuery:function(e,d){if(e===undefined||e===null){e=new Date()}var c={query:e,forceAll:d,combo:this,cancel:false};if(this.fireEvent("beforequery",c)===false||c.cancel){return false}e=c.query;d=c.forceAll;if(d===true){if(this.lastQuery!==e){this.lastQuery=e;this.store.baseParams[this.queryParam]=e;this.store.load({params:this.getParams(e)});this.expand()}else{this.selectedIndex=-1;this.onLoad()}}},getParams:function(c){var d={};if(this.pageSize){d.start=c;d.limit=this.pageSize}return d},findRecord:function(e,d){var c;if(this.store.getCount()>0){this.store.each(function(f){if(f.data[e]==d){c=f;return false}})}return c}});Ext.reg("weekfield",Ext.ui.WeekField);Ext.ns("Ext.ui");Ext.data.MonthWeekDataProxy=Ext.extend(Ext.data.DataProxy,{load:function(h,n,t,v,w){var x;try{var q=h.month||new Date().format("Ym");var g=Date.parseDate(q+"01","Ymd");var m=g.getLastDateOfMonth();var r=g;var f=new Array();var c=new Array();while(r<=m){if(r.format("N")==7){if(c.length!=0){f.push(c);c=new Array()}r=r.add(Date.DAY,1);continue}else{if(r.format("Y-m-d")==m.format("Y-m-d")){c.push(r);f.push(c);r=r.add(Date.DAY,1)}else{c.push(r);r=r.add(Date.DAY,1)}}}if(f[0].length<4){f[1]=f[0].concat(f[1]);f.shift()}if(f[f.length-1].length<4){f[f.length-2]=f[f.length-2].concat(f[f.length-1]);f.pop()}var s=new Array();for(var k=0;k<f.length;k++){var l=f[k];var u=[k+1,l[0].format("Ym")+(k+1),String.format("{0}年{1}月第{2}周",l[0].format("Y"),l[0].format("m"),k+1),l[0].format("Y-m-d"),l[l.length-1].format("Y-m-d")];s[k]=u}x=n.readRecords(s)}catch(o){this.fireEvent("loadexception",this,w,null,o);t.call(v,null,w,false);return}t.call(v,x,w,true)}});Ext.data.MonthWeekStore=function(c){this.reader=new Ext.data.ArrayReader({},Ext.data.Record.create(["w","ymw","t","s","e"]));this.proxy=new Ext.data.MonthWeekDataProxy();Ext.apply(this,c);Ext.data.MonthWeekStore.superclass.constructor.call(this,c)};Ext.extend(Ext.data.MonthWeekStore,Ext.data.Store,{load:function(c){c=c||{};this.storeOptions(c);var d=Ext.apply(c.params||{},this.baseParams);this.proxy.load(d,this.reader,this.loadRecords,this,c);return true},loadRecords:function(g,c,f){if(!g||f===false){if(f!==false){this.fireEvent("load",this,[],c)}if(c.callback){c.callback.call(c.scope||this,[],c,false)}return}var e=g.records,d=g.totalRecords||e.length;if(!c||c.add!==true){this.data.clear();this.data.addAll(e);this.totalLength=d;this.applySort();this.fireEvent("datachanged",this)}else{this.totalLength=Math.max(d,this.data.length+e.length);this.add(e)}this.fireEvent("load",this,e,c);if(c.callback){c.callback.call(c.scope||this,e,c,true)}}});Ext.ui.MonthWeekField=Ext.extend(Ext.form.ComboBox,{listWidth:160,hiddenName:"MONTH_WEEK",valueField:"ymw",displayField:"t",startDay:null,initComponent:function(){this.store=new Ext.data.MonthWeekStore();this.mode="local";if(this.startDay){this.startValue=this.getWeek(this.startDay)}Ext.ui.MonthWeekField.superclass.initComponent.call(this)},initValue:function(){if(this.startValue){var c=String.format("{0}年{1}月第{2}周",this.startValue.substring(0,4),this.startValue.substring(4,6),this.startValue.substring(6));this.value=c}Ext.form.ComboBox.superclass.initValue.call(this);if(this.startValue){this.value=this.startValue}if(this.hiddenField){this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:""}},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus({});this.doQuery(this.startDay,true);this.el.focus()}},onSelect:function(c,d){if(this.fireEvent("beforeselect",this,c,d)!==false){this.setValue(c.data[this.valueField||this.displayField]);this.startDay=Date.parseDate(c.get("s"),"Y-m-d");this.collapse();this.fireEvent("select",this,c,d)}},onLoad:function(){if(this.store.getCount()>0){this.pageStartDay=Date.parseDate(this.store.getAt(0).get("s"),"Y-m-d");this.expand();this.restrictHeight();if(this.editable){this.el.dom.select()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{this.onEmptyResults()}},initList:function(){if(!this.list){var c="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[c,this.listClass].join(" "),constrain:false});var d=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(d);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.title){this.header=this.list.createChild({cls:c+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:c+"-inner"});this.innerList.on("mouseover",this.onViewOver,this);this.innerList.on("mousemove",this.onViewMove,this);this.innerList.setWidth(d-this.list.getFrameWidth("lr"));this.footer=this.list.createChild({cls:c+"-ft"});this.pageTb=new Ext.Toolbar({items:["->",{tooltip:"上月",cls:"x-btn-icon",icon:_base+"/style/ex-icon/resultset_previous.gif",handler:function(){this.store.load({params:{month:this.pageStartDay.add(Date.MONTH,-1).format("Ym")}})},scope:this},{tooltip:"下月",cls:"x-btn-icon",icon:_base+"/style/ex-icon/resultset_next.gif",handler:function(){this.store.load({params:{month:this.pageStartDay.add(Date.MONTH,1).format("Ym")}})},scope:this}],renderTo:this.footer});this.assetHeight+=this.footer.getHeight();if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for="."><div  class="'+c+'-item">',"<b>{t}</b><br/> {s}/{e}","</div></tpl>")}this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+c+"-item"});this.view.on("click",this.onViewClick,this);this.bindStore(this.store,true);if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(g,e,f){this.maxHeight=f-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=e;this.innerList.setWidth(e-this.list.getFrameWidth("lr"));this.restrictHeight()},this);this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")}}},doQuery:function(e,d){if(e===undefined||e===null){e=""}var c={query:e,forceAll:d,combo:this,cancel:false};if(this.fireEvent("beforequery",c)===false||c.cancel){return false}e=c.query;d=c.forceAll;if(d===true){if(this.lastQuery!==e){this.lastQuery=e;this.store.baseParams[this.queryParam]=e;this.store.load({params:this.getParams(e)});this.expand()}else{this.selectedIndex=-1;this.onLoad()}}},getParams:function(c){c=c||new Date();return{month:c.format("Ym")}},findRecord:function(e,d){var c;if(this.store.getCount()>0){this.store.each(function(f){if(f.data[e]==d){c=f;return false}})}return c},getWeek:function(h){var n=h.format("Ym");var g=Date.parseDate(n+"01","Ymd");var m=g.getLastDateOfMonth();var o=g;var e=new Array();var c=new Array();while(o<=m){if(o.format("N")==7){if(c.length!=0){e.push(c);c=new Array()}o=o.add(Date.DAY,1);continue}else{if(o.format("Y-m-d")==m.format("Y-m-d")){c.push(o);e.push(c);o=o.add(Date.DAY,1)}else{c.push(o);o=o.add(Date.DAY,1)}}}if(e[0].length<4){e[1]=e[0].concat(e[1]);e.shift()}if(e[e.length-1].length<4){e[e.length-2]=e[e.length-2].concat(e[e.length-1]);e.pop()}var f=1;a:for(var l=0;l<e.length;l++){b:for(var k=0;k<e[l].length;k++){if(h.format("Y-m-d")===e[l][k].format("Y-m-d")){f=l+1;break a}}}return h.format("Ym")+f}});Ext.reg("monthweekfield",Ext.ui.MonthWeekField);Date.prototype.getFirstDateOfWeek=function(d){if(typeof d==="undefined"){d=(Ext.DatePicker?Ext.DatePicker.prototype.startDay:0)}var c=this.getDay()-d;if(c<0){c+=7}return this.add(Date.DAY,-c)};Array.prototype.sortDates=function(){return this.sort(function(d,c){return d.getTime()-c.getTime()})};if(!Ext.util.EasterDate){Ext.util.EasterDate=function(f,k){if(typeof f==="undefined"){f=new Date().getFullYear()}f=parseInt(f,10);if(typeof k==="undefined"){k=0}k=parseInt(k,10);var e=f%19;var g=(19*e+24)%30;var h=g+(2*(f%4)+4*(f%7)+6*g+5)%7;if((h==35)||((h==34)&&(g==28)&&(e>10))){h-=7}var c=new Date(f,2,22);c.setTime(c.getTime()+86400000*h+86400000*k);return c}}Ext.namespace("Ext.ux","Ext.ux.form");Ext.ux.DatePickerPlus=Ext.extend(Ext.DatePicker,{version:"1.4",noOfMonth:1,noOfMonthPerRow:3,fillupRows:true,eventDates:function(c){return[]},styleDisabledDates:false,eventDatesSelectable:true,defaultEventDatesText:"",defaultEventDatesCls:"x-datepickerplus-eventdates",setEventDates:function(e,f){if(typeof f==="undefined"){f=true}this.edArray=[];var d=0,c=e.length;for(;d<c;++d){if(Ext.isDate(e[d])){this.edArray.push({date:e[d],text:this.defaultEventDatesText,cls:this.defaultEventDatesCls})}else{if(e[d].date){e[d].date=this.jsonDate(e[d].date);this.edArray.push(e[d])}}}this.eventDates=function(g){return this.edArray};if(this.rendered&&f){this.eventDatesNumbered=this.convertCSSDatesToNumbers(this.eventDates(this.activeDate.getFullYear()));this.update(this.activeDate)}},eventDatesRE:false,eventDatesRECls:"",eventDatesREText:"",showWeekNumber:true,weekName:"Wk.",selectWeekText:"Click to select all days of this week",selectMonthText:"Click to select all weeks of this month",multiSelection:false,multiSelectByCTRL:true,selectedDates:[],prevNextDaysView:"mark",preSelectedDates:[],lastSelectedDate:false,markNationalHolidays:true,nationalHolidaysCls:"x-datepickerplus-nationalholidays",nationalHolidays:function(f){f=(typeof f==="undefined"?(this.lastRenderedYear?this.lastRenderedYear:new Date().getFullYear()):parseInt(f,10));var h=new Date(f,0,1).getDay();var l=new Date(f,1,1).getDay();var d=new Date(f,4,1).getDay();var k=new Date(f,8,1).getDay();var g=new Date(f,9,1).getDay();var c=new Date(f,10,1).getDay();var e=[{text:"New Year's Day",date:new Date(f,0,1)},{text:"Martin Luther King Day",date:new Date(f,0,(h>1?16+7-h:16-h))},{text:"Washington's Birthday",date:new Date(f,1,(l>1?16+7-l:16-l))},{text:"Memorial Day",date:new Date(f,4,(d==6?31:30-d))},{text:"Independence Day",date:new Date(f,6,4)},{text:"Labor Day",date:new Date(f,8,(k>1?2+7-k:2-k))},{text:"Columbus Day",date:new Date(f,9,(g>1?9+7-g:9-g))},{text:"Veterans Day",date:new Date(f,10,11)},{text:"Thanksgiving Day",date:new Date(f,10,(c>4?26+7-c:26-c))},{text:"Christmas Day",date:new Date(f,11,25)}];return e},markWeekends:true,weekendCls:"x-datepickerplus-weekends",weekendText:"",weekendDays:[6,0],useQuickTips:true,pageKeyWarp:1,maxSelectionDays:false,maxSelectionDaysTitle:"Datepicker",maxSelectionDaysText:"You can only select a maximum amount of %0 days",undoText:"Undo",stayInAllowedRange:true,summarizeHeader:false,resizable:false,renderOkUndoButtons:true,renderTodayButton:true,disablePartialUnselect:true,allowedDates:false,allowedDatesText:"",strictRangeSelect:false,displayMask:3,displayMaskText:"Please wait...",renderPrevNextButtons:true,renderPrevNextYearButtons:false,disableMonthPicker:false,nextYearText:"Next Year (Control+Up)",prevYearText:"Previous Year (Control+Down)",showActiveDate:false,shiftSpaceSelect:true,disabledLetter:false,allowMouseWheel:true,focus:Ext.emptyFn,initComponent:function(){Ext.ux.DatePickerPlus.superclass.initComponent.call(this);this.noOfMonthPerRow=this.noOfMonthPerRow>this.noOfMonth?this.noOfMonth:this.noOfMonthPerRow;this.addEvents("beforeyearchange","afteryearchange","beforemonthchange","aftermonthchange","beforemonthclick","beforeweekclick","beforedateclick","aftermonthclick","afterweekclick","afterdateclick","undo","beforemousewheel","beforemaxdays")},activeDateKeyNav:function(g){if(this.showActiveDate){this.activeDate=this.activeDate.add("d",g);var f=this.activeDateCell.split("#");var e=parseInt(f[0],10);var d=parseInt(f[1],10);var c=Ext.get(this.cellsArray[e].elements[d]);if((d+g>41&&e+1>=this.cellsArray.length)||(d+g<0&&e-1<0)){this.update(this.activeDate)}else{c.removeClass("x-datepickerplus-activedate");d+=g;if(d>41){d-=42;e++}else{if(d<0){d+=42;e--}}c=Ext.get(this.cellsArray[e].elements[d]);c.addClass("x-datepickerplus-activedate");this.activeDateCell=e+"#"+d}}},handleMouseWheel:function(f){if(this.fireEvent("beforemousewheel",this,f)!==false){var c=(this.activeDate?this.activeDate.getMonth():99);var g=(this.activeDate?this.activeDate.getFullYear():0);Ext.ux.DatePickerPlus.superclass.handleMouseWheel.call(this,f);var h=(this.activeDate?this.activeDate.getMonth():999);var d=(this.activeDate?this.activeDate.getFullYear():9999);if(c!=h){this.fireEvent("aftermonthchange",this,c,h)}if(g!=d){this.fireEvent("afteryearchange",this,g,d)}}},doDisabled:function(c){this.keyNav.setDisabled(c);if(this.renderPrevNextButtons){this.leftClickRpt.setDisabled(c);this.rightClickRpt.setDisabled(c)}if(this.renderPrevNextYearButtons){this.leftYearClickRpt.setDisabled(c);this.rightYearClickRpt.setDisabled(c)}if(this.todayBtn){this.todayKeyListener.setDisabled(c);this.todayBtn.setDisabled(c)}},onRender:function(r,I){if(this.noOfMonthPerRow===0){this.noOfMonthPerRow=1}if(this.fillupRows&&this.noOfMonthPerRow>1&&this.noOfMonth%this.noOfMonthPerRow!==0){this.noOfMonth+=(this.noOfMonthPerRow-(this.noOfMonth%this.noOfMonthPerRow))}var c=(Ext.isIE?" x-datepickerplus-ie":"");var w=['<table cellspacing="0"',(this.multiSelection?' class="x-date-multiselect'+c+'" ':(c!==""?'class="'+c+'" ':"")),">"];w.push("<tr>");var G=(Ext.isIE?'<img src="'+Ext.BLANK_IMAGE_URL+'" />':"");var v=(this.multiSelection?(this.useQuickTips?' ext:qtip="'+this.selectWeekText+'" ':' title="'+this.selectWeekText+'" '):"");var n=(this.markWeekends&&this.weekendText!==""?(this.useQuickTips?' ext:qtip="'+this.weekendText+'" ':' title="'+this.weekendText+'" '):"");var D=["<thead><tr>"];if(this.showWeekNumber){D.push('<th class="x-date-weeknumber-header"><a href="#" hidefocus="on" class="x-date-weeknumber" tabIndex="1"><em><span ',(this.multiSelection?(this.useQuickTips?' ext:qtip="'+this.selectMonthText+'" ':' title="'+this.selectMonthText+'" '):""),">"+this.weekName+"</span></em></a></th>")}var y=this.dayNames,A=0,F,z=0,q=0,u=this.noOfMonth;for(;A<7;++A){F=this.startDay+A;if(F>6){F=F-7}D.push("<th><span>",y[F].substr(0,1),"</span></th>")}D.push("</tr></thead><tbody><tr>");if(this.showWeekNumber){D.push('<td class="x-date-weeknumber-cell"><a href="#" hidefocus="on" class="x-date-weeknumber" tabIndex="1"><em><span ',v,"></span></em></a></td>")}for(;z<42;++z){if(z%7===0&&z>0){if(this.showWeekNumber){D.push('</tr><tr><td class="x-date-weeknumber-cell"><a href="#" hidefocus="on" class="x-date-weeknumber" tabIndex="1"><em><span ',v,"></span></em></a></td>")}else{D.push("</tr><tr>")}}D.push('<td class="x-date-date-cell"><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span ',(this.weekendDays.indexOf((z+this.startDay)%7)!=-1?n:""),"></span></em></a></td>")}D.push("</tr></tbody></table></td></tr></table></td>");var g=D.join("");if(this.summarizeHeader&&this.noOfMonth>1){w.push('<td align="center" id="',this.id,'-summarize" colspan="',this.noOfMonthPerRow,'" class="x-date-middle x-date-pickerplus-middle"></td></tr>');w.push("<tr>")}for(;q<u;++q){w.push('<td><table class="x-date-pickerplus',(q%this.noOfMonthPerRow===0?"":" x-date-monthtable"),(!this.prevNextDaysView?" x-date-pickerplus-prevnexthide":""),'" cellspacing="0"><tr>');if(q===0){w.push('<td class="x-date-left">');if(this.renderPrevNextButtons){w.push('<a class="npm" href="#" ',(this.useQuickTips?' ext:qtip="'+this.prevText+'" ':' title="'+this.prevText+'" '),"></a>")}if(this.renderPrevNextYearButtons){w.push('<a class="npy" href="#" ',(this.useQuickTips?' ext:qtip="'+this.prevYearText+'" ':' title="'+this.prevYearText+'" '),"></a>")}w.push("</td>")}else{w.push('<td class="x-date-dummy x-date-middle">',G,"</td>")}w.push("<td class='x-date-middle x-date-pickerplus-middle",(q===0&&!this.disableMonthPicker?" x-date-firstMonth":""),"' align='center'>");if(q>0||this.disableMonthPicker){w.push('<span id="',this.id,"-monthLabel",q,'"></span>')}w.push("</td>");if(q==this.noOfMonthPerRow-1){w.push('<td class="x-date-right">');if(this.renderPrevNextButtons){w.push('<a class="npm" href="#" ',(this.useQuickTips?' ext:qtip="'+this.nextText+'" ':' title="'+this.nextText+'" '),"></a>")}if(this.renderPrevNextYearButtons){w.push('<a class="npy" href="#" ',(this.useQuickTips?' ext:qtip="'+this.nextYearText+'" ':' title="'+this.nextYearText+'" '),"></a>")}w.push("</td>")}else{w.push('<td class="x-date-dummy x-date-middle">',G,"</td>")}w.push('</tr><tr><td colspan="3"><table class="x-date-inner" id="',this.id,"-inner-date",q,'" cellspacing="0">');w.push(g);if((q+1)%this.noOfMonthPerRow===0){w.push("</tr><tr>")}}w.push("</tr>");w.push("<tr><td",(this.noOfMonthPerRow>1?' colspan="'+this.noOfMonthPerRow+'"':""),' class="x-date-bottom" align="center"><div><table width="100%" cellpadding="0" cellspacing="0"><tr><td align="right" class="x-date-multiokbtn">',G,'</td><td align="center" class="x-date-todaybtn">',G,'</td><td align="left" class="x-date-multiundobtn">',G,"</td></tr></table></div></td></tr>");w.push('</table><div class="x-date-mp"></div>');var e=document.createElement("div");e.className="x-date-picker";e.innerHTML=w.join("");r.dom.insertBefore(e,I);this.el=Ext.get(e);this.eventEl=Ext.get(e.firstChild);if(this.renderPrevNextButtons){this.leftClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a.npm"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.rightClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a.npm"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true})}if(this.renderPrevNextYearButtons){this.leftYearClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a.npy"),{handler:this.showPrevYear,scope:this,preventDefault:true,stopDefault:true});this.rightYearClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a.npy"),{handler:this.showNextYear,scope:this,preventDefault:true,stopDefault:true})}if(this.allowMouseWheel){this.eventEl.on("mousewheel",this.handleMouseWheel,this)}this.keyNav=new Ext.KeyNav(this.eventEl,{left:function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextButtons)?this.showPrevMonth():this.activeDateKeyNav(-1))},right:function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextButtons)?this.showNextMonth():this.activeDateKeyNav(1))},up:function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextYearButtons)?this.showNextYear():this.activeDateKeyNav(-7))},down:function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextYearButtons)?this.showPrevYear():this.activeDateKeyNav(7))},pageUp:function(d){if(!this.disabled){this.update(this.activeDate.add("mo",this.pageKeyWarp*(-1)))}},pageDown:function(d){if(!this.disabled){this.update(this.activeDate.add("mo",this.pageKeyWarp))}},enter:function(d){d.stopPropagation();if(!this.disabled){if(this.multiSelection){this.okClicked()}else{this.finishDateSelection(this.activeDate)}}return true},scope:this});if(!this.disableSingleDateSelection){this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"})}if(this.multiSelection&&this.showWeekNumber){this.eventEl.on("click",this.handleWeekClick,this,{delegate:"a.x-date-weeknumber"})}this.cellsArray=[];this.textNodesArray=[];this.weekNumberCellsArray=[];this.weekNumberTextElsArray=[];this.weekNumberHeaderCellsArray=[];var l,h,C,f,t,o=0,H=this.noOfMonth;for(;o<H;++o){l=Ext.get(this.id+"-inner-date"+o).select("tbody td.x-date-date-cell");h=Ext.get(this.id+"-inner-date"+o).query("tbody td.x-date-date-cell span");this.cellsArray[o]=l;this.textNodesArray[o]=h;if(this.showWeekNumber){C=Ext.get(this.id+"-inner-date"+o).select("tbody td.x-date-weeknumber-cell");f=Ext.get(this.id+"-inner-date"+o).select("tbody td.x-date-weeknumber-cell span");this.weekNumberCellsArray[o]=C;this.weekNumberTextElsArray[o]=f;t=Ext.get(this.id+"-inner-date"+o).select("th.x-date-weeknumber-header");this.weekNumberHeaderCellsArray[o]=t}}if(!this.disableMonthPicker){this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-firstMonth",true)});this.mbtn.on("click",this.showMonthPickerPlus,this);this.mbtn.el.child("em").addClass("x-btn-arrow")}if(this.renderTodayButton||this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.spaceKeyPressed,this);var E=new Date().dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom .x-date-todaybtn",true),text:String.format(this.todayText,E),tooltip:String.format(this.todayTip,E),handler:this.selectToday,scope:this})}if(this.multiSelection&&this.renderOkUndoButtons){this.OKBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom .x-date-multiokbtn",true),text:this.okText,handler:this.okClicked,scope:this});this.undoBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom .x-date-multiundobtn",true),text:this.undoText,handler:function(){if(!this.disabled){this.fireEvent("undo",this,this.preSelectedDates);this.preSelectedDates=[];var k=0,d=this.selectedDates.length;for(;k<d;++k){this.preSelectedDates.push(this.selectedDates[k].clearTime().getTime())}this.update(this.activeDate)}},scope:this})}if(Ext.isIE){this.el.repaint()}this.preSelectedDates=[];var s=0,B=this.selectedDates.length;for(;s<B;++s){this.preSelectedDates.push(this.selectedDates[s].clearTime().getTime())}this.update(this.value)},showMonthPickerPlus:function(){if(!this.disabled){this.showMonthPicker()}},convertCSSDatesToNumbers:function(e){var f=[[],[],[]],d=0,c=e.length;for(;d<c;++d){f[0][d]=e[d].date.clearTime().getTime();f[1][d]=(e[d].text?e[d].text:this.defaultEventDatesText);f[2][d]=(e[d].cls?e[d].cls:this.defaultEventDatesCls)}return f},clearSelectedDates:function(c){if(typeof c==="undefined"){c=true}this.selectedDates=[];this.preSelectedDates=[];if(this.rendered&&c){this.update(this.activeDate)}},jsonDate:function(e){if(!Ext.isArray(e)){if(typeof e==="string"){return Date.parseDate(e.replace(/T/," "),"Y-m-d H:i:s")}}else{var d=0,c=e.length;for(;d<c;d++){if(typeof e[d]==="string"){e[d]=Date.parseDate(e[d].replace(/T/," "),"Y-m-d H:i:s")}}}return e},setSelectedDates:function(g,k){if(typeof k==="undefined"){k=true}g=this.jsonDate(g);if(!Ext.isArray(g)){g=[g]}var h,f,e=0,c=g.length;for(;e<c;++e){h=g[e];f=h.clearTime().getTime();if(this.preSelectedDates.indexOf(f)==-1){this.preSelectedDates.push(f);this.selectedDates.push(h)}}if(this.rendered&&k){this.update(this.activeDate)}},setAllowedDates:function(c,d){if(typeof d==="undefined"){d=true}this.allowedDates=this.jsonDate(c);if(this.rendered&&d){this.update(this.activeDate)}},setMinDate:function(c){this.minDate=this.jsonDate(c);this.update(this.value,true)},setMaxDate:function(c){this.maxDate=this.jsonDate(c);this.update(this.value,true)},setDateLimits:function(c,d){this.minDate=this.jsonDate(c);this.maxDate=this.jsonDate(d);this.update(this.value,true)},update:function(aa,g,D){if(typeof D==="undefined"){D=false}if(typeof g==="undefined"){g=false}if(g){var u=this.activeDate;this.activeDate=null;aa=u}var z=(this.displayMask&&(isNaN(this.displayMask)||this.noOfMonth>this.displayMask)?true:false);if(!D&&z){this.el.mask(this.displayMaskText);this.update.defer(10,this,[aa,false,true]);return false}if(this.stayInAllowedRange&&(this.minDate||this.maxDate)){if(this.minDate&&(this.minDate.getFullYear()>aa.getFullYear()||(this.minDate.getMonth()>aa.getMonth()&&this.minDate.getFullYear()==aa.getFullYear()))){aa=new Date(this.minDate.getTime())}else{if(this.maxDate&&(this.maxDate.getFullYear()<aa.getFullYear()||(this.maxDate.getMonth()<aa.getMonth()&&this.maxDate.getFullYear()==aa.getFullYear()))){aa=new Date(this.maxDate.getTime())}}}var K=aa.getMonth();var V=(this.activeDate?this.activeDate.getMonth():K);var T=aa.getFullYear();var C=(this.activeDate?this.activeDate.getFullYear():T);if(V!=K){this.fireEvent("beforemonthchange",this,V,K)}if(C!=T){this.fireEvent("beforeyearchange",this,C,T)}this.activeDate=aa.clearTime();this.preSelectedCells=[];this.lastSelectedDateCell="";this.activeDateCell="";var ab=(this.lastSelectedDate?this.lastSelectedDate:0);var y=new Date().clearTime().getTime();var ag=this.minDate?this.minDate.clearTime().getTime():Number.NEGATIVE_INFINITY;var B=this.maxDate?this.maxDate.clearTime().getTime():Number.POSITIVE_INFINITY;var Q=this.disabledDatesRE;var J=this.disabledDatesText;var O=this.disabledDays?this.disabledDays.join(""):false;var f=this.disabledDaysText;var R=this.eventDatesRE;var r=this.eventDatesRECls;var q=this.eventDatesREText;var m=this.allowedDatesText;var F=this.format;var ac=this.activeDate.getTime();this.todayMonthCell=false;this.todayDayCell=false;if(this.allowedDates){this.allowedDatesT=[];var W=0,af=this.allowedDates.length;for(;W<af;++W){this.allowedDatesT.push(this.allowedDates[W].clearTime().getTime())}}var I=function(e,am,ap,ak){var an,aj=Ext.get(am),al=Ext.get(ap),ao=ak.getTime(),w=false,k;am.title="";am.firstChild.dateValue=ao;var x=ak.getFullYear();if(e.lastRenderedYear!==x){e.lastRenderedYear=x;if(e.markNationalHolidays){e.nationalHolidaysNumbered=e.convertCSSDatesToNumbers(e.nationalHolidays(x))}e.eventDatesNumbered=e.convertCSSDatesToNumbers(e.eventDates(x))}if(ao<ag){am.className=" x-date-disabled";w=e.minText}if(ao>B){am.className=" x-date-disabled";w=e.maxText}if(O){if(O.indexOf(ak.getDay())!=-1){w=f;am.className=" x-date-disabled"}}if(Q&&F){k=ak.dateFormat(F);if(Q.test(k)){w=J.replace("%0",k);am.className=" x-date-disabled"}}if(e.allowedDates&&e.allowedDatesT.indexOf(ao)==-1){am.className=" x-date-disabled";w=m}if(e.markWeekends&&e.weekendDays.indexOf(ak.getDay())!=-1&&!aj.hasClass("x-date-disabled")){aj.addClass(e.weekendCls)}if(!aj.hasClass("x-date-disabled")||e.styleDisabledDates){if(e.eventDatesNumbered[0].length>0){an=e.eventDatesNumbered[0].indexOf(ao);if(an!=-1){if(e.eventDatesNumbered[2][an]!==""){aj.addClass(e.eventDatesNumbered[2][an]+(e.eventDatesSelectable?"":"-disabled"));w=(e.eventDatesNumbered[1][an]!==""?e.eventDatesNumbered[1][an]:false)}}}if(R&&F){k=ak.dateFormat(F);if(R.test(k)){w=q.replace("%0",k);am.className=r}}}if(!aj.hasClass("x-date-disabled")){if(e.markNationalHolidays&&e.nationalHolidaysNumbered[0].length>0){an=e.nationalHolidaysNumbered[0].indexOf(ao);if(an!=-1){aj.addClass(e.nationalHolidaysCls);w=(e.nationalHolidaysNumbered[1][an]!==""?e.nationalHolidaysNumbered[1][an]:false)}}if(e.preSelectedDates.indexOf(ao)!=-1){aj.addClass("x-date-selected");e.preSelectedCells.push(am.firstChild.monthCell+"#"+am.firstChild.dayCell)}if(ao==ab){e.lastSelectedDateCell=am.firstChild.monthCell+"#"+am.firstChild.dayCell}}else{if(e.disabledLetter){ap.innerHTML=e.disabledLetter}}if(ao==y){aj.addClass("x-date-today");w=e.todayText}if(e.showActiveDate&&ao==ac&&e.activeDateCell===""){aj.addClass("x-datepickerplus-activedate");e.activeDateCell=am.firstChild.monthCell+"#"+am.firstChild.dayCell}if(w){if(e.useQuickTips){Ext.QuickTips.register({target:al,text:w})}else{am.title=w}}};var A,P,n,t,E,v,c,ae,G,X,Z,s,U,S,o,h,l,N;var H=[],M=0,L=this.noOfMonth,ad,Y;for(;M<L;++M){if(this.summarizeHeader&&this.noOfMonth>1&&(M===0||M==this.noOfMonth-1)){H.push(this.monthNames[aa.getMonth()]," ",aa.getFullYear());if(M===0){H.push(" - ")}}A=this.cellsArray[M].elements;P=this.textNodesArray[M];if((this.markNationalHolidays||this.eventDates.length>0)&&this.useQuickTips){for(ad=0,Y=P.length;ad<Y;++ad){Ext.QuickTips.unregister(P[ad])}}n=aa.getDaysInMonth();t=aa.getFirstDateOfMonth();E=t.getDay()-this.startDay;if(E<=this.startDay){E+=7}v=aa.add("mo",-1);c=v.getDaysInMonth()-E;n+=E;ae=new Date(v.getFullYear(),v.getMonth(),c).clearTime();X=0;if(this.showWeekNumber){s=this.weekNumberCellsArray[M].elements;U=this.weekNumberTextElsArray[M].elements;S=new Date(ae);S.setDate(S.getDate()+7);o=this.weekNumberHeaderCellsArray[M].elements;o[0].firstChild.monthValue=aa.getMonth();o[0].firstChild.dateValue=S.getTime();o[0].firstChild.monthCell=M;o[0].firstChild.dayCell=0;while(X<s.length){U[X].innerHTML=S.getWeekOfYear();s[X].firstChild.dateValue=S.getTime();s[X].firstChild.monthCell=M;s[X].firstChild.dayCell=(X*7);S.setDate(S.getDate()+7);X++}X=0}for(;X<E;++X){P[X].innerHTML=(++c);A[X].firstChild.monthCell=M;A[X].firstChild.dayCell=X;ae.setDate(ae.getDate()+1);A[X].className="x-date-prevday";I(this,A[X],P[X],ae)}for(;X<n;++X){Z=X-E+1;P[X].innerHTML=(Z);A[X].firstChild.monthCell=M;A[X].firstChild.dayCell=X;ae.setDate(ae.getDate()+1);A[X].className="x-date-active";I(this,A[X],P[X],ae);if(ae.getTime()==y){this.todayMonthCell=M;this.todayDayCell=X}}var ai=0;for(;X<42;++X){P[X].innerHTML=(++ai);A[X].firstChild.monthCell=M;A[X].firstChild.dayCell=X;ae.setDate(ae.getDate()+1);A[X].className="x-date-nextday";I(this,A[X],P[X],ae)}if(M===0&&!this.disableMonthPicker){this.mbtn.setText(this.monthNames[aa.getMonth()]+" "+aa.getFullYear())}else{h=Ext.get(this.id+"-monthLabel"+M);h.update(this.monthNames[aa.getMonth()]+" "+aa.getFullYear())}aa=aa.add("mo",1);if(!this.internalRender){l=this.el.dom.firstChild;N=l.offsetWidth;this.el.setWidth(N+this.el.getBorderWidth("lr"));Ext.fly(l).setWidth(N);this.internalRender=true}}if(this.summarizeHeader&&this.noOfMonth>1){var ah=Ext.get(this.id+"-summarize");ah.update(H.join(""))}this.el.unmask();if(V!=K){this.fireEvent("aftermonthchange",this,V,K)}if(C!=T){this.fireEvent("afteryearchange",this,C,T)}},beforeDestroy:function(){if(this.rendered){this.keyNav.disable();this.keyNav=null;if(this.renderPrevNextButtons){Ext.destroy(this.leftClickRpt,this.rightClickRpt)}if(this.renderPrevNextYearButtons){Ext.destroy(this.leftYearClickRpt,this.rightYearClickRpt)}if(!this.disableMonthPicker){Ext.destroy(this.monthPicker,this.mbtn)}if(this.todayBtn){this.todayBtn.destroy()}if(this.OKBtn){this.OKBtn.destroy()}if(this.undoBtn){this.undoBtn.destroy()}Ext.destroy(this.eventEl)}},handleWeekClick:function(u,w){if(!this.disabled){u.stopEvent();var r=new Date(w.dateValue).getFirstDateOfWeek(this.startDay),q=0,c,m,d;var n=w.monthCell;var h=w.dayCell;switch(w.parentNode.tagName.toUpperCase()){case"TH":q=42;c=w.monthValue;break;case"TD":q=7;break}if((q==42&&this.fireEvent("beforemonthclick",this,c,this.lastStateWasSelected)!==false)||(q==7&&this.fireEvent("beforeweekclick",this,r,this.lastStateWasSelected)!==false)){if(!Ext.EventObject.ctrlKey&&this.multiSelectByCTRL){this.removeAllPreselectedClasses()}d=true;if(this.disablePartialUnselect){var g=r,l=0;for(;l<q;++l){m=g.getMonth();if((q==7||m===c)&&this.preSelectedDates.indexOf(g.clearTime().getTime())==-1){d=false;break}g=g.add(Date.DAY,1)}}var v=false;var s=1;if(this.strictRangeSelect&&((this.preSelectedDates.indexOf(r.add(Date.DAY,-1).clearTime().getTime())==-1&&!d)||(this.preSelectedDates.indexOf(r.add(Date.DAY,-1).clearTime().getTime())!=-1&&d))){v=true;r=r.add(Date.DAY,q-1);s=-1}this.maxNotified=false;var o=0,f;for(;o<q;++o){m=r.getMonth();f=(v?q-1-o:o);if(q==7||m===c){this.markDateAsSelected(r.clearTime().getTime(),true,n,h+f,d)}r=r.add(Date.DAY,s)}if(q==42){this.fireEvent("aftermonthclick",this,c,this.lastStateWasSelected)}else{this.fireEvent("afterweekclick",this,new Date(w.dateValue).getFirstDateOfWeek(this.startDay),this.lastStateWasSelected)}}}},markDateAsSelected:function(h,g,f,d,e){var l=Ext.get(this.cellsArray[f].elements[d]);if((l.hasClass("x-date-prevday")||l.hasClass("x-date-nextday"))&&this.prevNextDaysView!=="mark"){return false}if(this.multiSelection&&(Ext.EventObject.ctrlKey||g)){var c=new Date(h).add(Date.DAY,-1).clearTime().getTime();var k=new Date(h).add(Date.DAY,1).clearTime().getTime();if(this.preSelectedDates.indexOf(h)==-1){if(this.maxSelectionDays===this.preSelectedDates.length){if(!this.maxNotified){if(this.fireEvent("beforemaxdays",this)!==false){Ext.Msg.alert(this.maxSelectionDaysTitle,this.maxSelectionDaysText.replace(/%0/,this.maxSelectionDays))}this.maxNotified=true}return false}if(l.hasClass("x-date-disabled")){return false}if(this.strictRangeSelect&&this.preSelectedDates.indexOf(k)==-1&&this.preSelectedDates.indexOf(c)==-1&&this.preSelectedDates.length>0){return false}this.preSelectedDates.push(h);this.markSingleDays(f,d,false);this.markGhostDatesAlso(f,d,false);this.lastStateWasSelected=true}else{if(e&&(!this.strictRangeSelect||(this.strictRangeSelect&&((this.preSelectedDates.indexOf(k)==-1&&this.preSelectedDates.indexOf(c)!=-1)||(this.preSelectedDates.indexOf(k)!=-1&&this.preSelectedDates.indexOf(c)==-1))))){this.preSelectedDates.remove(h);this.markSingleDays(f,d,true);this.markGhostDatesAlso(f,d,true);this.lastStateWasSelected=false}}}else{this.removeAllPreselectedClasses();this.preSelectedDates=[h];this.preSelectedCells=[];this.markSingleDays(f,d,false);this.markGhostDatesAlso(f,d,false);this.lastStateWasSelected=true}this.lastSelectedDate=h;this.lastSelectedDateCell=f+"#"+d;if(this.multiSelection&&!this.renderOkUndoButtons){this.copyPreToSelectedDays()}return this.lastStateWasSelected},markSingleDays:function(e,d,c){if(!c){Ext.get(this.cellsArray[e].elements[d]).addClass("x-date-selected");this.preSelectedCells.push((e)+"#"+(d))}else{Ext.get(this.cellsArray[e].elements[d]).removeClass("x-date-selected");this.preSelectedCells.remove((e)+"#"+(d))}},markGhostDatesAlso:function(e,d,c){if(this.prevNextDaysView=="mark"){var g=Ext.get(this.cellsArray[e].elements[d]),f;if(g.hasClass("x-date-prevday")&&e>0){f=(5-Math.floor(d/7))*7;if(Ext.get(this.cellsArray[e-1].elements[d+f]).hasClass("x-date-nextday")){f-=7}this.markSingleDays(e-1,d+f,c)}else{if(g.hasClass("x-date-nextday")&&e<this.cellsArray.length-1){f=28;if(this.cellsArray[e].elements[d].firstChild.firstChild.firstChild.innerHTML!=this.cellsArray[e+1].elements[d-f].firstChild.firstChild.firstChild.innerHTML){f=35}this.markSingleDays(e+1,d-f,c)}else{if(g.hasClass("x-date-active")&&((d<14&&e>0)||(d>27&&e<this.cellsArray.length-1))){if(d<14){f=28;if(!Ext.get(this.cellsArray[e-1].elements[d+f]).hasClass("x-date-nextday")){f=35}if(d+f<42&&this.cellsArray[e].elements[d].firstChild.firstChild.firstChild.innerHTML==this.cellsArray[e-1].elements[d+f].firstChild.firstChild.firstChild.innerHTML){this.markSingleDays(e-1,d+f,c)}}else{f=28;if(!Ext.get(this.cellsArray[e+1].elements[d-f]).hasClass("x-date-prevday")){f=35}if(d-f>=0&&this.cellsArray[e].elements[d].firstChild.firstChild.firstChild.innerHTML==this.cellsArray[e+1].elements[d-f].firstChild.firstChild.firstChild.innerHTML){this.markSingleDays(e+1,d-f,c)}}}}}}},removeAllPreselectedClasses:function(){var f=0,d=this.preSelectedCells.length,c;for(;f<d;++f){c=this.preSelectedCells[f].split("#");Ext.get(this.cellsArray[c[0]].elements[c[1]]).removeClass("x-date-selected")}this.preSelectedDates=[];this.preSelectedCells=[]},handleDateClick:function(C,q){C.stopEvent();var c=Ext.fly(q.parentNode);if(!this.disabled&&q.dateValue&&!c.hasClass("x-date-disabled")&&!c.hasClass("x-datepickerplus-eventdates-disabled")&&this.fireEvent("beforedateclick",this,q)!==false){if((!c.hasClass("x-date-prevday")&&!c.hasClass("x-date-nextday"))||this.prevNextDaysView=="mark"){var w=Ext.EventObject;if((!w.ctrlKey&&this.multiSelectByCTRL)||w.shiftKey||!this.multiSelection){this.removeAllPreselectedClasses()}var o=(((!w.ctrlKey&&!this.multiSelectByCTRL)||w.shiftKey)&&this.multiSelection?true:false);if(w.shiftKey&&this.multiSelection&&this.lastSelectedDate){var F=this.lastSelectedDate;var h=q.dateValue;var l=(F<h?1:-1);var v=this.lastSelectedDateCell.split("#");var y=parseInt(v[0],10);var A=parseInt(v[1],10);var n,m=0,k=0;this.maxNotified=false;var s=this.activeDate.getFirstDateOfMonth().clearTime().getTime();var r=this.activeDate.add(Date.MONTH,this.noOfMonth-1).getLastDateOfMonth().clearTime().getTime();if(F<s||F>r){var x=this.minDate?this.minDate.clearTime().getTime():Number.NEGATIVE_INFINITY;var z=this.maxDate?this.maxDate.clearTime().getTime():Number.POSITIVE_INFINITY;var G=this.disabledDays?this.disabledDays.join(""):"";var E=this.disabledDatesRE;var B=this.format;var u=this.allowedDates?this.allowedDatesT:false;var D,g,f;while(F<s||F>r){D=new Date(F);g=false;if(E){f=D.dateFormat(B);g=E.test(f)}if(!(F<x)&&!(F>z)&&G.indexOf(D.getDay())==-1&&!g&&(!u||u.indexOf(F)!=-1)){if(this.maxSelectionDays===this.preSelectedDates.length){if(this.fireEvent("beforemaxdays",this)!==false){Ext.Msg.alert(this.maxSelectionDaysTitle,this.maxSelectionDaysText.replace(/%0/,this.maxSelectionDays))}break}this.preSelectedDates.push(F)}F=new Date(F).add(Date.DAY,l).clearTime().getTime()}y=(l>0?0:this.cellsArray.length-1);A=(l>0?0:41);n=Ext.get(this.cellsArray[y].elements[A]);while(n.hasClass("x-date-prevday")||n.hasClass("x-date-nextday")){n.addClass("x-date-selected");this.preSelectedCells.push((y)+"#"+(A));A+=l;n=Ext.get(this.cellsArray[y].elements[A])}}while((h-F)*l>0&&y>=0&&y<this.cellsArray.length){this.markDateAsSelected(F,o,y,A,true);F=new Date(F).add(Date.DAY,l).clearTime().getTime();n=Ext.get(this.cellsArray[y].elements[A]);if(n.hasClass("x-date-active")){m=0}else{m++}A+=l;if(A==42){y++;A=(m>=7?14:7)}else{if(A<0){y--;A=34;n=Ext.get(this.cellsArray[y].elements[A]);if(n.hasClass("x-date-nextday")||m==7){A=27}}}}}if(this.markDateAsSelected(q.dateValue,o,q.monthCell,q.dayCell,true)){this.finishDateSelection(new Date(q.dateValue))}}}},copyPreToSelectedDays:function(){this.selectedDates=[];var d=0,c=this.preSelectedDates.length;for(;d<c;++d){this.selectedDates.push(new Date(this.preSelectedDates[d]))}},okClicked:function(){this.copyPreToSelectedDays();this.selectedDates=this.selectedDates.sortDates();this.fireEvent("select",this,this.selectedDates)},spaceKeyPressed:function(h){var g=(((!Ext.EventObject.ctrlKey&&!this.multiSelectByCTRL)||Ext.EventObject.shiftKey)&&this.multiSelection?true:false);if(!this.disabled&&this.shiftSpaceSelect==Ext.EventObject.shiftKey&&this.showActiveDate){var f=this.activeDateCell.split("#");var d=parseInt(f[0],10);var c=parseInt(f[1],10);this.markDateAsSelected(this.activeDate.getTime(),g,d,c,true);this.finishDateSelection(this.activeDate)}else{this.selectToday()}},finishDateSelection:function(c){this.setValue(c);if(this.multiSelection){this.fireEvent("afterdateclick",this,c,this.lastStateWasSelected)}else{this.fireEvent("afterdateclick",this,c,this.lastStateWasSelected);this.fireEvent("select",this,this.value)}},selectToday:function(){if(!this.disabled&&this.todayBtn&&!this.todayBtn.disabled){var c=new Date().clearTime();var d=c.getTime();if(typeof this.todayMonthCell==="number"){this.markDateAsSelected(d,false,this.todayMonthCell,this.todayDayCell,true)}else{if(this.multiSelection){this.update(c)}}this.finishDateSelection(c)}},setValue:function(c){if(Ext.isArray(c)){this.selectedDates=[];this.preSelectedDates=[];this.setSelectedDates(c,true);c=c[0]}else{this.setSelectedDates(c,false)}this.value=c.clearTime(true);if(this.el&&!this.multiSelection&&this.noOfMonth==1){this.update(this.value)}},setSize:Ext.emptyFn});Ext.reg("datepickerplus",Ext.ux.DatePickerPlus);if(parseInt(Ext.version.substr(0,1),10)>2){Ext.menu.DateItem=Ext.ux.DatePickerPlus;Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}var c=(this.initialConfig.usePickerPlus?Ext.ux.DatePickerPlus:Ext.DatePicker);Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new c(Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item",id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("show",this.picker.focus,this.picker);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}}})}else{Ext.menu.DateItem=function(c){if(typeof c==="undefined"){c={}}if(c.usePickerPlus){Ext.menu.DateItem.superclass.constructor.call(this,new Ext.ux.DatePickerPlus(Ext.applyIf({listeners:c.datePickerListeners||{}},c)),c)}else{Ext.menu.DateItem.superclass.constructor.call(this,new Ext.DatePicker(Ext.applyIf({listeners:c.datePickerListeners||{}},c)),c)}this.picker=this.component;this.addEvents("select");this.picker.on("render",function(d){d.getEl().swallowEvent("click");d.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)};Ext.extend(Ext.menu.DateItem,Ext.menu.Adapter,{onSelect:function(d,c){this.fireEvent("select",this,c,d);if(d.rendered){Ext.menu.DateItem.superclass.handleClick.call(this)}}})}if(Ext.form&&Ext.form.DateField){Ext.ux.form.DateFieldPlus=Ext.extend(Ext.form.DateField,{showPrevNextTrigger:false,prevNextTriggerType:1,onPrevTriggerRelease:null,onNextTriggerRelease:null,usePickerPlus:true,showWeekNumber:true,noOfMonth:1,noOfMonthPerRow:3,nationalHolidaysCls:"x-datepickerplus-nationalholidays",markNationalHolidays:true,eventDates:function(c){return[]},eventDatesRE:false,eventDatesRECls:"",eventDatesREText:"",multiSelection:false,multiSelectionDelimiter:",",multiSelectByCTRL:true,fillupRows:true,markWeekends:true,weekendText:"",weekendCls:"x-datepickerplus-weekends",weekendDays:[6,0],useQuickTips:true,pageKeyWarp:1,maxSelectionDays:false,resizable:false,renderTodayButton:true,renderOkUndoButtons:true,tooltipType:"qtip",allowedDates:false,allowedDatesText:"",renderPrevNextButtons:true,renderPrevNextYearButtons:false,disableMonthPicker:false,showActiveDate:false,shiftSpaceSelect:true,disabledLetter:false,allowMouseWheel:true,summarizeHeader:false,stayInAllowedRange:true,disableSingleDateSelection:false,eventDatesSelectable:false,styleDisabledDates:false,prevNextDaysView:"mark",allowOtherMenus:false,onBeforeYearChange:function(c,e,d){return this.fireEvent("beforeyearchange",this,e,d,c)},onAfterYearChange:function(c,e,d){return this.fireEvent("afteryearchange",this,e,d,c)},onBeforeMonthChange:function(c,d,e){return this.fireEvent("beforemonthchange",this,d,e,c)},onAfterMonthChange:function(c,d,e){return this.fireEvent("aftermonthchange",this,d,e,c)},onAfterMonthClick:function(c,e,d){return this.fireEvent("aftermonthclick",this,e,d,c)},onAfterWeekClick:function(d,c,e){return this.fireEvent("afterweekclick",this,c,e,d)},onAfterDateClick:function(d,c,e){return this.fireEvent("afterdateclick",this,c,e,d)},onBeforeMonthClick:function(c,e,d){return this.fireEvent("beforemonthclick",this,e,d,c)},onBeforeWeekClick:function(d,c,e){return this.fireEvent("beforeweekclick",this,c,e,d)},onBeforeDateClick:function(d,c){return this.fireEvent("beforedateclick",this,c)},onBeforeMouseWheel:function(c,d){return this.fireEvent("beforemousewheel",this,d,c)},onBeforeMaxDays:function(c){return this.fireEvent("beforemaxdays",this,c)},onUndo:function(d,c){return this.fireEvent("undo",this,c,d)},createMenu:function(){if(!this.menu){this.menu=new Ext.menu.DateMenu({allowOtherMenus:this.allowOtherMenus,usePickerPlus:this.usePickerPlus,noOfMonth:this.noOfMonth,noOfMonthPerRow:this.noOfMonthPerRow,listeners:{beforeyearchange:{fn:this.onBeforeYearChange,scope:this},afteryearchange:{fn:this.onAfterYearChange,scope:this},beforemonthchange:{fn:this.onBeforeMonthChange,scope:this},aftermonthchange:{fn:this.onAfterMonthChange,scope:this},afterdateclick:{fn:this.onAfterDateClick,scope:this},aftermonthclick:{fn:this.onAfterMonthClick,scope:this},afterweekclick:{fn:this.onAfterWeekClick,scope:this},beforedateclick:{fn:this.onBeforeDateClick,scope:this},beforemonthclick:{fn:this.onBeforeMonthClick,scope:this},beforeweekclick:{fn:this.onBeforeWeekClick,scope:this},beforemousewheel:{fn:this.onBeforeMouseWheel,scope:this},beforemaxdays:{fn:this.onBeforeMaxDays,scope:this},undo:{fn:this.onUndo,scope:this}}});this.relayEvents(this.menu,["select"])}if(this.menu.isVisible()){this.menu.hide();return}if(this.disabledDatesRE){this.ddMatch=this.disabledDatesRE}if(typeof this.minDate=="string"){this.minDate=this.parseDate(this.minDate)}if(typeof this.maxDate=="string"){this.maxDate=this.parseDate(this.maxDate)}Ext.apply(this.menu.picker,{minDate:this.minValue||this.minDate,maxDate:this.maxValue||this.maxDate,disabledDatesRE:this.ddMatch,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,showToday:this.showToday,format:this.format,minText:String.format(this.minText,this.formatDate(this.minValue||this.minDate)),maxText:String.format(this.maxText,this.formatDate(this.maxValue||this.maxDate)),showWeekNumber:this.showWeekNumber,nationalHolidaysCls:this.nationalHolidaysCls,markNationalHolidays:this.markNationalHolidays,multiSelectByCTRL:this.multiSelectByCTRL,fillupRows:this.fillupRows,multiSelection:this.multiSelection,markWeekends:this.markWeekends,weekendText:this.weekendText,weekendCls:this.weekendCls,weekendDays:this.weekendDays,useQuickTips:this.useQuickTips,eventDates:this.eventDates,eventDatesRE:this.eventDatesRE,eventDatesRECls:this.eventDatesRECls,eventDatesREText:this.eventDatesREText,pageKeyWarp:this.pageKeyWarp,maxSelectionDays:this.maxSelectionDays,resizable:this.resizable,renderTodayButton:this.renderTodayButton,renderOkUndoButtons:this.renderOkUndoButtons,allowedDates:this.allowedDates,allowedDatesText:this.allowedDatesText,renderPrevNextButtons:this.renderPrevNextButtons,renderPrevNextYearButtons:this.renderPrevNextYearButtons,disableMonthPicker:this.disableMonthPicker,showActiveDate:this.showActiveDate,shiftSpaceSelect:this.shiftSpaceSelect,disabledLetter:this.disabledLetter,allowMouseWheel:this.allowMouseWheel,summarizeHeader:this.summarizeHeader,stayInAllowedRange:this.stayInAllowedRange,disableSingleDateSelection:this.disableSingleDateSelection,eventDatesSelectable:this.eventDatesSelectable,styleDisabledDates:this.styleDisabledDates,prevNextDaysView:this.prevNextDaysView});this.menu.picker.on("select",function(d,c){this.setValue(c)},this)},onTriggerClick:function(){if(this.disabled){return}this.createMenu();if(typeof this.defaultValue=="string"){this.defaultValue=Date.parseDate(this.defaultValue,this.format)}this.menu.picker.setValue(this.getValue()||this.defaultValue||new Date());this.menu.show(this.el,"tl-bl?");this.menu.focus()},setValue:function(c){var k=this;if(Ext.isArray(c)){var g=[],h=0,d=c.length;for(;h<d;++h){g.push(k.formatDate(c[h]))}var f=g.join(this.multiSelectionDelimiter);Ext.form.DateField.superclass.setValue.call(this,f)}else{Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(c)))}},validateValue:function(f){if(this.multiSelection){var k=this;var c=f.split(this.multiSelectionDelimiter);var h=true,g=0,d=c.length;for(;g<d;++g){if(!Ext.ux.form.DateFieldPlus.superclass.validateValue.call(k,c[g])){h=false}}return h}else{return Ext.ux.form.DateFieldPlus.superclass.validateValue.call(this,f)}},getValue:function(){if(this.multiSelection){var f=Ext.form.DateField.superclass.getValue.call(this);var k=this;var c=f.split(this.multiSelectionDelimiter);var h=[],g=0,d=c.length;for(;g<d;++g){var l=k.parseDate(c[g]);if(l){h.push(l)}}return(h.length>0?h:"")}else{return Ext.ux.form.DateFieldPlus.superclass.getValue.call(this)}},beforeBlur:function(){if(this.multiSelection){this.setValue(this.getRawValue().split(this.multiSelectionDelimiter))}else{var c=this.parseDate(this.getRawValue());if(c){this.setValue(c)}}},submitFormat:"Y-m-d",submitFormatAddon:"-format",onResize:function(c,f){Ext.form.TriggerField.superclass.onResize.call(this,c,f);var d=this.trigger.getWidth();var e=d;if(this.showPrevNextTrigger&&!this.multiSelection){e+=this.prevTrigger.getWidth()+this.nextTrigger.getWidth()}if(!isNaN(c)){this.el.setWidth(c-d)}this.wrap.setWidth(this.el.getWidth()+e)},onRender:function(){Ext.ux.form.DateFieldPlus.superclass.onRender.apply(this,arguments);if(this.showPrevNextTrigger&&!this.multiSelection){this.createMenu();this.prevTrigger=this.el.insertSibling({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-datepickerplus-fieldprev"});this.prevTrigger.addClassOnOver("x-form-trigger-over");this.prevTrigger.addClassOnClick("x-form-trigger-click");this.nextTrigger=this.trigger.insertSibling({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-datepickerplus-fieldnext"},"after");this.nextTrigger.addClassOnOver("x-form-trigger-over");this.nextTrigger.addClassOnClick("x-form-trigger-click");if(this.menuEvents){this.el.addClass("x-datepickerplus-prevnext-ext3");this.nextTrigger.addClass("x-datepickerplus-prevnext-ext3-next");this.prevTrigger.addClass("x-datepickerplus-prevnext-ext3-prev");this.trigger.addClass("x-datepickerplus-prevnext-ext3-date")}this.prevTrigRpt=new Ext.util.ClickRepeater(this.prevTrigger,{handler:function(f){var d=this.getValue(),e=new Date();if(Ext.isDate(d)){if(this.prevNextTriggerType==="m"){var h=d.getDate(),l=d.getMonth()-1,k=d.getFullYear(),g=0;if(l==-1){l=11;k--}else{g=new Date(k,l,1).getDaysInMonth();if(h>g){h=g}}e=new Date(k,l,h)}else{e=new Date(d.getTime()-(86400000*this.prevNextTriggerType))}}this.setValue(e);this.menu.picker.setValue([e])},listeners:{mouseup:function(d,f){if(typeof this.scope.onPrevTriggerRelease=="function"){this.scope.onPrevTriggerRelease(this.scope.menu.picker,this.scope.menu.picker.value)}else{this.scope.menu.picker.fireEvent("select",this.scope.menu.picker,this.scope.menu.picker.value)}}},scope:this,preventDefault:true,stopDefault:true});this.nextTrigRpt=new Ext.util.ClickRepeater(this.nextTrigger,{handler:function(f){var d=this.getValue(),e=new Date();if(Ext.isDate(d)){if(this.prevNextTriggerType==="m"){var h=d.getDate(),l=d.getMonth()+1,k=d.getFullYear(),g=0;if(l==12){l=0;k++}else{g=new Date(k,l,1).getDaysInMonth();if(h>g){h=g}}e=new Date(k,l,h)}else{e=new Date(d.getTime()+(86400000*this.prevNextTriggerType))}}this.setValue(e);this.menu.picker.setValue([e])},listeners:{mouseup:function(d,f){if(typeof this.scope.onNextTriggerRelease=="function"){this.scope.onNextTriggerRelease(this.scope.menu.picker,this.scope.menu.picker.value)}else{this.scope.menu.picker.fireEvent("select",this.scope.menu.picker,this.scope.menu.picker.value)}}},scope:this,preventDefault:true,stopDefault:true})}var c=this.name||this.el.dom.name||(this.id+this.submitFormatAddon);if(c==this.id){c+=this.submitFormatAddon}this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:c,value:this.formatHiddenDate(this.parseDate(this.value))},Ext.isIE?"after":"before");this.hiddenName=c;this.el.dom.removeAttribute("name");this.el.on({keyup:{scope:this,fn:this.updateHidden},blur:{scope:this,fn:this.updateHidden}});this.setValue=this.setValue.createSequence(this.updateHidden);if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.trigger},this.tooltip))}else{this.trigger.dom[this.tooltipType]=this.tooltip}}},onDestroy:function(){Ext.ux.form.DateFieldPlus.superclass.onDestroy.apply(this,arguments);if(this.prevTrigger){this.prevTrigRpt.destroy();this.prevTrigger.removeAllListeners();this.prevTrigger.remove()}if(this.nextTrigger){this.nextTrigRpt.destroy();this.nextTrigger.removeAllListeners();this.nextTrigger.remove()}},onDisable:function(){Ext.ux.form.DateFieldPlus.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.dom.setAttribute("disabled","disabled")}},onEnable:function(){Ext.ux.form.DateFieldPlus.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.dom.removeAttribute("disabled")}},formatHiddenDate:function(c){return Ext.isDate(c)?Ext.util.Format.date(c,this.submitFormat):c},formatMultiHiddenDate:function(c){var k=this,g=[],f,h=0,d=c.length;for(;h<d;++h){g.push(k.formatHiddenDate(c[h]))}f=g.join(this.multiSelectionDelimiter);this.hiddenField.dom.value=f},updateHidden:function(c){if(Ext.isArray(c)){this.formatMultiHiddenDate(c)}else{var d=this.getValue();if(Ext.isArray(d)){this.formatMultiHiddenDate(d)}else{this.hiddenField.dom.value=this.formatHiddenDate(d)}}}});Ext.reg("datefieldplus",Ext.ux.form.DateFieldPlus)}if(Ext.ux.DatePickerPlus){Ext.apply(Ext.ux.DatePickerPlus.prototype,{weekName:"周",selectWeekText:"点击选择当周所有天",selectMonthText:"点击选择当月所有周",maxSelectionDaysTitle:"日期选择器",maxSelectionDaysText:"你最多只能选择  %0 天",undoText:"撤销",displayMaskText:"请稍后...",nextYearText:"下一年 (Control+Up)",prevYearText:"上一年 (Control+Down)",nationalHolidays:function(f){f=(typeof f==="undefined"?(this.lastRenderedYear?this.lastRenderedYear:new Date().getFullYear()):parseInt(f,10));var h=new Date(f,0,1).getDay();var l=new Date(f,1,1).getDay();var d=new Date(f,4,1).getDay();var k=new Date(f,8,1).getDay();var g=new Date(f,9,1).getDay();var c=new Date(f,10,1).getDay();var e=[{text:"元旦",date:new Date(f,0,1)},{text:"五一",date:new Date(f,4,1)},{text:"情人节",date:new Date(f,10,11)},{text:"感恩节",date:new Date(f,10,(c>4?26+7-c:26-c))},{text:"圣诞节",date:new Date(f,11,25)}];return e}})}Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(c){Ext.ux.Spinner.superclass.constructor.call(this,c);Ext.apply(this,c);this.mimicing=false},init:function(c){this.field=c;c.afterMethod("onRender",this.doRender,this);c.afterMethod("onEnable",this.doEnable,this);c.afterMethod("onDisable",this.doDisable,this);c.afterMethod("afterRender",this.doAfterRender,this);c.afterMethod("onResize",this.doResize,this);c.afterMethod("onFocus",this.doFocus,this);c.beforeMethod("onDestroy",this.doDestroy,this)},doRender:function(d,c){var e=this.el=this.field.getEl();var g=this.field;if(!g.wrap){g.wrap=this.wrap=e.wrap({cls:"x-form-field-wrap"})}else{this.wrap=g.wrap.addClass("x-form-field-wrap")}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!g.width){this.wrap.setWidth(e.getWidth()+this.trigger.getWidth())}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var c;if(Ext.isIE&&this.el.getY()!=(c=this.trigger.getY())){this.el.position();this.el.setY(c)}},doEnable:function(){if(this.wrap){this.disabled=false;this.wrap.removeClass(this.field.disabledClass)}},doDisable:function(){if(this.wrap){this.disabled=true;this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass)}},doResize:function(c,d){if(typeof c=="number"){this.el.setWidth(c-this.trigger.getWidth())}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this)}},checkTab:function(c){if(c.getKey()==c.TAB){this.triggerBlur()}},mimicBlur:function(c){if(!this.wrap.contains(c.target)&&this.field.validateBlur(c)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(c){c.preventDefault();this.onSpinUp()},down:function(c){c.preventDefault();this.onSpinDown()},pageUp:function(c){c.preventDefault();this.onSpinUpAlternate()},pageDown:function(c){c.preventDefault();this.onSpinDownAlternate()},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(this.disabled){return}var c=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<c)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass)},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(this.disabled){return}var c=this.getMiddle();if(((Ext.EventObject.getPageY()>c)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<c)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return}var c=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<c)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass)},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return}var d=this.getMiddle();var c=(Ext.EventObject.getPageY()<d)?"Up":"Down";this["onSpin"+c]()},getMiddle:function(){var d=this.trigger.getTop();var e=this.trigger.getHeight();var c=d+(e/2);return c},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false}return true},handleMouseWheel:function(c){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return}var d=c.getWheelDelta();if(d>0){this.onSpinUp();c.stopEvent()}else{if(d<0){this.onSpinDown();c.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var d=Ext.fly(this.dd.getDragEl()).getTop();var c="";if(this._previousY>d){c="Up"}if(this._previousY<d){c="Down"}if(c!=""){this["onSpin"+c]()}this._previousY=d},onSpinUp:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.spin(false,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDown:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.spin(true,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},spin:function(f,d){var c=parseFloat(this.field.getValue());var e=(d==true)?this.alternateIncrementValue:this.incrementValue;(f==true)?c-=e:c+=e;c=(isNaN(c))?this.defaultValue:c;c=this.fixBoundries(c);this.field.setRawValue(c)},fixBoundries:function(d){var c=d;if(this.field.minValue!=undefined&&c<this.field.minValue){c=this.field.minValue}if(this.field.maxValue!=undefined&&c>this.field.maxValue){c=this.field.maxValue}return this.fixPrecision(c)},fixPrecision:function(d){var c=isNaN(d);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||c||!d){return c?"":d}return parseFloat(parseFloat(d).toFixed(this.field.decimalPrecision))},doDestroy:function(){if(this.trigger){this.trigger.remove()}if(this.wrap){this.wrap.remove();delete this.field.wrap}if(this.splitter){this.splitter.remove()}if(this.dd){this.dd.unreg();this.dd=null}if(this.proxy){this.proxy.remove()}if(this.repeater){this.repeater.purgeListeners()}if(this.mimicing){Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this)}}});Ext.form.Spinner=Ext.ux.Spinner;Ext.ns("Ext.ux.form");Ext.ns("Ext.ui");Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(e){var d=Ext.copyTo({},e,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass");var f=this.spinner=new Ext.ux.Spinner(d);var c=e.plugins?(Ext.isArray(e.plugins)?e.plugins.push(f):[e.plugins,f]):f;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(e,{plugins:c}))},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}},validateBlur:function(){return true}});Ext.reg("spinnerfield",Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;Ext.ui.SpinnerField=Ext.form.SpinnerField;Ext.ns("Ext.ux.form");Ext.ns("Ext.ui");Ext.ux.form.DateTimePicker=function(c){Ext.ux.form.DateTimePicker.superclass.constructor.call(this,c)};Ext.extend(Ext.ux.form.DateTimePicker,Ext.DatePicker,{hourText:"时",minuteText:"分",spinnerCfg:{width:50},initComponent:function(){Ext.DatePicker.superclass.initComponent.call(this);this.value=this.value?this.value:new Date();this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this)}this.initDisabledDays()},selectToday:function(){this.getHourAndMinuteValue();this.setValue(new Date());this.value.setHours(this.theHours);this.value.setMinutes(this.theMinutes);this.fireEvent("select",this,this.value)},handleDateClick:function(d,c){d.stopEvent();if(c.dateValue&&!Ext.fly(c.parentNode).hasClass("x-date-disabled")){this.getHourAndMinuteValue();this.value=new Date(c.dateValue);this.value.setHours(this.theHours);this.value.setMinutes(this.theMinutes);this.setValue(this.value);this.fireEvent("select",this,this.value)}},onRender:function(c,n){var g=['<table cellspacing="0" width="200px">','<tr><td colspan="3"><table cellspacing="0" width="100%"><tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr></table></td></tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'];var l=this.dayNames;for(var k=0;k<7;k++){var q=this.startDay+k;if(q>6){q=q-7}g.push("<th><span>",l[q].substr(0,1),"</span></th>")}g[g.length]="</tr></thead><tbody><tr>";for(k=0;k<42;k++){if(k%7===0&&k!==0){g[g.length]="</tr><tr>"}g[g.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'}g[g.length]='</tr></tbody></table></td></tr><tr><td class="minutecss" colspan="3" align="center"><table cellspacing="0" ><tr>';g[g.length]='<td class="x-hour"></td><td> &nbsp; '+this.hourText+'</td><td width ="5px"></td><td class="x-minute"></td><td>&nbsp;'+this.minuteText+"</td>";g[g.length]='</tr></table></td></tr><tr><td width="50%"  colspan="2" class="x-date-bottom" align="right"></td><td width="50%" class="x-date-bottom" align="left"></td></tr></table><div class="x-date-mp"></div>';var e=document.createElement("div");e.className="x-date-picker";e.innerHTML=g.join("");c.dom.insertBefore(e,n);this.el=Ext.get(e);this.eventEl=Ext.get(e.firstChild);this.leftClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.rightClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});var o=Ext.apply({},this.spinnerCfg,{readOnly:this.readOnly,disabled:this.disabled,align:"right",selectOnFocus:true,listeners:{spinup:{fn:this.onSpinnerChange,scope:this},spindown:{fn:this.onSpinnerChange,scope:this},change:{fn:this.onSpinnerChange,scope:this}}});this.hoursSpinner=new Ext.form.SpinnerField(Ext.apply({},o,{renderTo:this.el.child("td.x-hour",true),minValue:0,maxValue:23,cls:"first",value:this.theHours}));this.minutesSpinner=new Ext.form.SpinnerField(Ext.apply({},o,{renderTo:this.el.child("td.x-minute",true),minValue:0,maxValue:59,value:this.theMinutes}));this.eventEl.on("mousewheel",this.handleMouseWheel,this);this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");var s=new Ext.KeyNav(this.eventEl,{left:function(d){d.ctrlKey?this.showPrevMonth():this.update(this.activeDate.add("d",-1))},right:function(d){d.ctrlKey?this.showNextMonth():this.update(this.activeDate.add("d",1))},up:function(d){d.ctrlKey?this.showNextYear():this.update(this.activeDate.add("d",-7))},down:function(d){d.ctrlKey?this.showPrevYear():this.update(this.activeDate.add("d",7))},pageUp:function(d){this.showNextMonth()},pageDown:function(d){this.showPrevMonth()},enter:function(d){d.stopPropagation();return true},scope:this});this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);this.el.unselectable();this.cells=this.el.select("table.x-date-inner tbody td");this.textNodes=this.el.query("table.x-date-inner tbody span");this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",true)});this.mbtn.el.child("em").addClass("x-btn-arrow");this.mbtn.on("click",this.showMonthPicker,this);this.mbtn.el.child(this.mbtn.menuClassTarget).addClass("x-btn-with-menu");var f=new Date();var h="";this.theHours=f.getHours();if(this.theHours<10){h="0"+this.theHours}else{h=this.theHours}this.hoursSpinner.setValue(h);this.theMinutes=f.getMinutes();if(this.theMinutes<10){h="0"+this.theMinutes}else{h=this.theMinutes}this.minutesSpinner.setValue(h);var r=(new Date()).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom:nth(1)",true),text:String.format(this.todayText,r),tooltip:String.format(this.todayTip,r),handler:this.selectToday,scope:this});this.okBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom:nth(2)",true),text:this.okText,handler:this.toSelect,scope:this});if(Ext.isIE){this.el.repaint()}this.update(this.value)},toSelect:function(){this.getHourAndMinuteValue();this.value=this.getValue()||new Date();this.value.setHours(this.theHours);this.value.setMinutes(this.theMinutes);this.setValue(this.value);this.fireEvent("select",this,this.value)},onSpinnerChange:function(){if(!this.rendered){return}this.fireEvent("change",this,this.getHourAndMinuteValue())},getHourAndMinuteValue:function(){this.theHours=this.hoursSpinner.getValue();this.theMinutes=this.minutesSpinner.getValue()},setHourAndMinute:function(d){var c="";this.theHours=d.getHours();if(this.theHours<10){c="0"+this.theHours}else{c=this.theHours}this.hoursSpinner.setValue(c);this.theMinutes=d.getMinutes();if(this.theMinutes<10){c="0"+this.theMinutes}else{c=this.theMinutes}this.minutesSpinner.setValue(c)},setValue:function(e){var c=new Date(e.getTime());this.value=e;if(this.el){this.update(new Date(this.value.getTime()))}var d=this;setTimeout(function(){d.setHourAndMinute(c)},51)},update:function(K,E){var c=this.activeDate,s=this.isVisible();this.activeDate=K;if(!E&&c&&this.el){var r=new Date(K.getTime()).clearTime().getTime();if(c.getMonth()==K.getMonth()&&c.getFullYear()==K.getFullYear()){this.cells.removeClass("x-date-selected");this.cells.each(function(d){if(d.dom.firstChild.dateValue==r){d.addClass("x-date-selected");if(s){setTimeout(function(){try{d.dom.firstChild.focus()}catch(t){}},50)}return false}});return}}var m=K.getDaysInMonth();var u=K.getFirstDateOfMonth();var h=u.getDay()-this.startDay;if(h<0){h+=7}var F=K.add("mo",-1);var k=F.getDaysInMonth()-h;var g=this.cells.elements;var v=this.textNodes;m+=h;var C=86400000;var H=(new Date(F.getFullYear(),F.getMonth(),k)).clearTime();var G=new Date().clearTime().getTime();var z=K.clearTime().getTime();var y=this.minDate?this.minDate.clearTime():Number.NEGATIVE_INFINITY;var B=this.maxDate?this.maxDate.clearTime():Number.POSITIVE_INFINITY;var J=this.disabledDatesRE;var x=this.disabledDatesText;var M=this.disabledDays?this.disabledDays.join(""):false;var I=this.disabledDaysText;var D=this.format;if(this.showToday){var o=new Date().clearTime();var f=(o<y||o>B||(J&&D&&J.test(o.dateFormat(D)))||(M&&M.indexOf(o.getDay())!=-1));if(!this.disabled){this.todayBtn.setDisabled(f);this.todayKeyListener[f?"disable":"enable"]()}}var n=function(O,d){d.title="";var w=H.getTime();d.firstChild.dateValue=w;if(w==G){d.className+=" x-date-today";d.title=O.todayText}if(w==z){d.className+=" x-date-selected";if(s){setTimeout(function(){try{d.firstChild.focus()}catch(t){}},50)}}if(w<y){d.className=" x-date-disabled";d.title=O.minText;return}if(w>B){d.className=" x-date-disabled";d.title=O.maxText;return}if(M){if(M.indexOf(H.getDay())!=-1){d.title=I;d.className=" x-date-disabled"}}if(J&&D){var N=H.dateFormat(D);if(J.test(N)){d.title=x.replace("%0",N);d.className=" x-date-disabled"}}};var A=0;for(;A<h;A++){v[A].innerHTML=(++k);H.setDate(H.getDate()+1);g[A].className="x-date-prevday";n(this,g[A])}for(;A<m;A++){var e=A-h+1;v[A].innerHTML=(e);H.setDate(H.getDate()+1);g[A].className="x-date-active";n(this,g[A])}var L=0;for(;A<42;A++){v[A].innerHTML=(++L);H.setDate(H.getDate()+1);g[A].className="x-date-nextday";n(this,g[A])}this.mbtn.setText(this.monthNames[K.getMonth()]+" "+K.getFullYear());if(!this.internalRender){var l=this.el.dom.firstChild;var q=l.offsetWidth;this.el.setWidth(q+this.el.getBorderWidth("lr"));Ext.fly(l).setWidth(q);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){l.rows[0].cells[1].style.width=(q-(l.rows[0].cells[0].offsetWidth+l.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[K])}}}});Ext.ux.form.DateTimeMenu=Ext.extend(Ext.menu.DateMenu,{initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.ux.form.DateTimePicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE9m,ctCls:"x-menu-date-item",id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("show",this.picker.focus,this.picker);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}}});Ext.ui.DateTimeField=Ext.extend(Ext.form.DateField,{constructor:function(c){c=c||{};Ext.applyIf(c,{menu:new Ext.ux.form.DateTimeMenu()});Ext.ui.DateTimeField.superclass.constructor.call(this,c)}});Ext.reg("datetimefield",Ext.ui.DateTimeField);Ext.namespace("Ext.ux.maximgb.treegrid");Ext.ux.maximgb.treegrid.AbstractTreeStore=Ext.extend(Ext.ui.CommonStore,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(c){Ext.ux.maximgb.treegrid.AbstractTreeStore.superclass.constructor.call(this,c);if(!this.paramNames.active_node){this.paramNames.active_node="anode"}this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(c){if(c===this.active_node){this.setActiveNode(null)}this.removeNodeDescendants(c);Ext.ux.maximgb.treegrid.AbstractTreeStore.superclass.remove.call(this,c)},removeNodeDescendants:function(f){var e,c,d=this.getNodeChildren(f);for(e=0,c=d.length;e<c;e++){this.remove(d[e])}},applySort:function(){if(this.sortInfo&&!this.remoteSort){var c=this.sortInfo,d=c.field;this.sortData(d,c.direction)}else{this.applyTreeSort()}},sortData:function(e,g){g=g||"ASC";var c=this.fields.get(e).sortType;var d=function(h,f){var l=c(h.data[e]),k=c(f.data[e]);return l>k?1:(l<k?-1:0)};this.data.sort(g,d);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(g,d)}this.applyTreeSort()},load:function(c){if(c){if(c.params){if(c.params[this.paramNames.active_node]===undefined){c.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{c.params={};c.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{c={params:{}};c.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}if(c.params[this.paramNames.active_node]!==null){c.add=true}return Ext.ux.maximgb.treegrid.AbstractTreeStore.superclass.load.call(this,c)},loadRecords:function(d,q,h){if(!d||h===false){if(h!==false){this.fireEvent("load",this,[],q)}if(q.callback){q.callback.call(q.scope||this,[],q,false)}return}var c=d.records,n=d.totalRecords||c.length,k=this.getPageOffsetFromOptions(q),m=this.getLoadedNodeIdFromOptions(q),g,e,f,l=this;if(!q||q.add!==true||m===null){if(this.pruneModifiedRecords){this.modified=[]}for(var e=0,f=c.length;e<f;e++){c[e].join(this)}if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(c);this.page_offset=k;this.totalLength=n;this.applySort();this.fireEvent("datachanged",this)}else{g=this.getById(m);if(g){this.setNodeChildrenOffset(g,k);this.setNodeChildrenTotalCount(g,Math.max(n,c.length));this.removeNodeDescendants(g);this.suspendEvents();for(e=0,f=c.length;e<f;e++){this.add(c[e])}this.applySort();this.resumeEvents();idx=[];c.sort(function(t,o){var u=l.data.indexOf(t),s=l.data.indexOf(o),v;if(u>s){v=1}else{v=-1}return v});if(c.length>0){this.fireEvent("add",this,c,this.data.indexOf(c[0]))}}}this.fireEvent("load",this,c,q);if(q.callback){q.callback.call(q.scope||this,c,q,true)}},applyTreeSort:function(){var g,c,f,h,e=[],d=this.getRootNodes();for(g=0,c=d.length;g<c;g++){h=d[g];e.push(h);this.collectNodeChildrenTreeSorted(e,h)}if(e.length>0){this.data.clear();this.data.addAll(e)}if(this.snapshot&&this.snapshot!==this.data){f=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=f}},collectNodeChildrenTreeSorted:function(d,g){var f,c,h,e=this.getNodeChildren(g);for(f=0,c=e.length;f<c;f++){h=e[f];d.push(h);this.collectNodeChildrenTreeSorted(d,h)}},getActiveNode:function(){return this.active_node},setActiveNode:function(c){if(this.active_node!==c){if(c){if(this.data.indexOf(c)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,c)!==false){this.active_node=c;this.fireEvent("activenodechange",this,this.active_node,c)}}else{throw"Given record is not from the store."}}else{if(this.fireEvent("beforeactivenodechange",this,this.active_node,c)!==false){this.active_node=c;this.fireEvent("activenodechange",this,this.active_node,c)}}}},isExpandedNode:function(c){return c.ux_maximgb_treegrid_expanded===true},setNodeExpanded:function(d,c){d.ux_maximgb_treegrid_expanded=c},isVisibleNode:function(g){var e,d,f=this.getNodeAncestors(g),c=true;if(f.length==0){return true}f=this.getNodeAncestors(this.getNodeParent(g));for(e=0,d=f.length;e<d;e++){c=c&&this.isExpandedNode(f[e]);if(!c){break}}return c},isLeafNode:function(c){return c.get(this.leaf_field_name)==true},isLoadedNode:function(d){var c;if(d.ux_maximgb_treegrid_loaded!==undefined){c=d.ux_maximgb_treegrid_loaded}else{if(this.isLeafNode(d)||this.hasChildNodes(d)){c=true}else{c=false}}return c},setNodeLoaded:function(d,c){d.ux_maximgb_treegrid_loaded=c},getNodeChildrenOffset:function(c){return c.ux_maximgb_treegrid_offset||0},setNodeChildrenOffset:function(d,c){d.ux_maximgb_treegrid_offset=c},getNodeChildrenTotalCount:function(c){return c.ux_maximgb_treegrid_total||0},setNodeChildrenTotalCount:function(d,c){d.ux_maximgb_treegrid_total=c},collapseNode:function(c){if(this.isExpandedNode(c)&&this.fireEvent("beforecollapsenode",this,c)!==false){this.setNodeExpanded(c,false);this.fireEvent("collapsenode",this,c)}},expandNode:function(d,c){var e;if(!this.isExpandedNode(d)&&this.fireEvent("beforeexpandnode",this,d)!==false){if(c==true){this.setNodeLoaded(d,false)}if(this.isLoadedNode(d)){this.setNodeExpanded(d,true);this.fireEvent("expandnode",this,d)}else{e={};e[this.paramNames.active_node]=d.id;Ext.apply(e,d.data);this.load({add:true,params:e,callback:this.expandNodeCallback,scope:this})}}},expandNodeCallback:function(d,c,f){var e=this.getById(c.params[this.paramNames.active_node]);if(f&&e){this.setNodeLoaded(e,true);this.setNodeExpanded(e,true);this.fireEvent("expandnode",this,e)}else{this.fireEvent("expandnodefailed",this,c.params[this.paramNames.active_node],e)}},getLoadedNodeIdFromOptions:function(d){var c=null;if(d&&d.params&&d.params[this.paramNames.active_node]){c=d.params[this.paramNames.active_node]}return c},getPageOffsetFromOptions:function(d){var c=0;if(d&&d.params&&d.params[this.paramNames.start]){c=parseInt(d.params[this.paramNames.start],10);if(isNaN(c)){c=0}}return c},hasNextSiblingNode:function(c){return this.getNodeNextSibling(c)!==null},hasPrevSiblingNode:function(c){return this.getNodePrevSibling(c)!==null},hasChildNodes:function(c){return this.getNodeChildrenCount(c)>0},getNodeAncestors:function(e){var d=[],c;c=this.getNodeParent(e);while(c){d.push(c);c=this.getNodeParent(c)}return d},getNodeChildrenCount:function(c){return this.getNodeChildren(c).length},getNodeNextSibling:function(f){var g,e,d,c=null;e=this.getNodeParent(f);if(e){g=this.getNodeChildren(e)}else{g=this.getRootNodes()}d=g.indexOf(f);if(d<g.length-1){c=g[d+1]}return c},getNodePrevSibling:function(f){var g,e,d,c=null;e=this.getNodeParent(f);if(e){g=this.getNodeChildren(e)}else{g=this.getRootNodes()}d=g.indexOf(f);if(d>0){c=g[d-1]}return c},getRootNodes:function(){throw"Abstract method call"},getNodeDepth:function(c){throw"Abstract method call"},getNodeParent:function(c){throw"Abstract method call"},getNodeChildren:function(c){throw"Abstract method call"},addToNode:function(c,d){throw"Abstract method call"},removeFromNode:function(c,d){throw"Abstract method call"},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){var c;if(this.active_node){c=this.getNodeChildrenOffset(this.active_node)}else{c=this.getPageOffset()}return c},getActiveNodeCount:function(){var c;if(this.active_node){c=this.getNodeChildrenCount(this.active_node)}else{c=this.getRootNodes().length}return c},getActiveNodeTotalCount:function(){var c;if(this.active_node){c=this.getNodeChildrenTotalCount(this.active_node)}else{c=this.getTotalCount()}return c}});Ext.ux.maximgb.treegrid.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.treegrid.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var f,d,c=[],e=this.data.getRange();for(f=0,d=e.length;f<d;f++){if(e[f].get(this.parent_id_field_name)==null){c.push(e[f])}}return c},getNodeDepth:function(c){return this.getNodeAncestors(c).length},getNodeParent:function(c){return this.getById(c.get(this.parent_id_field_name))},getNodeChildren:function(g){var f,d,c=[],e=this.data.getRange();for(f=0,d=e.length;f<d;f++){if(e[f].get(this.parent_id_field_name)==g.id){c.push(e[f])}}return c},reload:function(c){var e=this.getActiveNode();var d=this.getNodeParent(e);if(d){this.collapseNode(d);this.expandNode(d,true)}else{Ext.ux.maximgb.treegrid.AdjacencyListStore.superclass.reload.call(this,c)}}});Ext.ux.maximgb.treegrid.NestedSetStore=Ext.extend(Ext.ux.maximgb.treegrid.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var f,d,c=[],e=this.data.getRange();for(f=0,d=e.length;f<d;f++){if(e[f].get(this.level_field_name)==this.root_node_level){c.push(e[f])}}return c},getNodeDepth:function(c){return c.get(this.level_field_name)-this.root_node_level},getNodeParent:function(c){var q=null,k,h=this.data.getRange(),l,m,o,g,n,f,e,d;o=c.get(this.left_field_name);n=c.get(this.right_field_name);e=c.get(this.level_field_name);for(l=0,m=h.length;l<m;l++){k=h[l];g=k.get(this.left_field_name);f=k.get(this.right_field_name);d=k.get(this.level_field_name);if(d==e-1&&g<o&&f>n){q=k;break}}return q},getNodeChildren:function(c){var m,g,l,f,d,e,h,k,n=[];h=this.data.getRange();m=c.get(this.left_field_name);l=c.get(this.right_field_name);d=c.get(this.level_field_name);for(i=0,len=h.length;i<len;i++){k=h[i];g=k.get(this.left_field_name);f=k.get(this.right_field_name);e=k.get(this.level_field_name);if(e==d+1&&g>m&&f<l){n.push(k)}}return n}});Ext.ux.maximgb.treegrid.GridView=Ext.extend(Ext.grid.GridView,{breadcrumbs_el:null,hideBreadCrumb:false,initTemplates:function(){var c=this.templates||{};var d="";if(this.hideBreadCrumb===true){d="display:none;"}c.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset">','<div class="ux-maximgb-treegrid-breadcrumbs" style="'+d+'">&#160;</div>',"</div>","</div>",'<div class="x-clear"></div>','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset">{header}</div>',"</div>",'<div class="x-clear"></div>',"</div>",'<div class="x-grid3-scroller">','<div class="x-grid3-body">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>',"</div>","</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");c.row=new Ext.Template('<div class="x-grid3-row {alt} ux-maximgb-treegrid-level-{level}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody>","</table>","</div>");c.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");c.treeui=new Ext.Template('<div class="ux-maximgb-treegrid-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>");c.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>');c.brd_item=new Ext.Template('<a href="#" id="ux-maximgb-treegrid-brditem-{id}" class="ux-maximgb-treegrid-brditem" title="{title}">{caption}</a>');this.templates=c;Ext.ux.maximgb.treegrid.GridView.superclass.initTemplates.call(this)},initElements:function(){var e=Ext.Element;var d=this.grid.getGridEl().dom.firstChild;var c=d.childNodes;this.el=new e(d);this.mainWrap=new e(c[0]);this.mainHd=new e(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.mainHd.setDisplayed(false)}this.innerHd=this.mainHd.dom.childNodes[2];this.scroller=new e(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle("overflow-x","hidden")}this.mainBody=new e(this.scroller.dom.firstChild);this.focusEl=new e(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent("click",true);this.resizeMarker=new e(c[1]);this.resizeProxy=new e(c[2]);this.breadcrumbs_el=this.el.child(".ux-maximgb-treegrid-breadcrumbs");this.setRootBreadcrumbs()},doRender:function(h,l,t,d,s,x){var e=this.templates,g=e.cell,k=e.row,m=s-1;var f="width:"+this.getTotalWidth()+";";var A=[],u,B,v={},n={tstyle:f},q;for(var w=0,z=l.length;w<z;w++){q=l[w];u=[];var o=(w+d);for(var y=0;y<s;y++){B=h[y];v.id=B.id;v.css=y==0?"x-grid3-cell-first ":(y==m?"x-grid3-cell-last ":"");v.attr=v.cellAttr="";v.value=B.renderer(q.data[B.name],v,q,o,y,t);v.style=B.style;if(v.value==undefined||v.value===""){v.value="&#160;"}if(q.dirty&&typeof q.modified[B.name]!=="undefined"){v.css+=" x-grid3-dirty-cell"}if(B.id==this.grid.master_column_id){v.treeui=this.renderCellTreeUI(q,t)}else{v.treeui=""}u[u.length]=g.apply(v)}var C=[];if(x&&((o+1)%2==0)){C[0]="x-grid3-row-alt"}if(q.dirty){C[1]=" x-grid3-dirty-row"}n.cols=s;if(this.getRowClass){C[2]=this.getRowClass(q,o,n,t)}n.alt=C.join(" ");n.cells=u.join("");if(!t.isVisibleNode(q)){n.display_style="display: none;"}else{n.display_style=""}n.level=t.getNodeDepth(q);A[A.length]=k.apply(n)}return A.join("")},renderCellTreeUI:function(c,d){var e=this.templates.treeui,l=this.templates.elbow_line,g={},k,f,h=level=d.getNodeDepth(c);g.wrap_width=(h+1)*16;if(level>0){g.elbow_line="";k=c;left=0;while(level--){f=d.getNodeParent(k);if(f){if(d.hasNextSiblingNode(f)){g.elbow_line=l.apply({left:level*16,cls:"ux-maximgb-treegrid-elbow-line"})+g.elbow_line}else{g.elbow_line=l.apply({left:level*16,cls:"ux-maximgb-treegrid-elbow-empty"})+g.elbow_line}}else{throw ["Tree inconsistency can't get level ",level+1," node(id=",k.id,") parent."].join("")}k=f}}if(d.isLeafNode(c)){if(d.hasNextSiblingNode(c)){g.cls="ux-maximgb-treegrid-elbow"}else{g.cls="ux-maximgb-treegrid-elbow-end"}}else{g.cls="ux-maximgb-treegrid-elbow-active ";if(d.isExpandedNode(c)){if(d.hasNextSiblingNode(c)){g.cls+="ux-maximgb-treegrid-elbow-minus"}else{g.cls+="ux-maximgb-treegrid-elbow-end-minus"}}else{if(d.hasNextSiblingNode(c)){g.cls+="ux-maximgb-treegrid-elbow-plus"}else{g.cls+="ux-maximgb-treegrid-elbow-end-plus"}}}g.left=1+h*16;return e.apply(g)},getBreadcrumbsEl:function(){return this.breadcrumbs_el},expandRow:function(f,k){var d=this.ds,e,h,n,l,c,g,m;if(typeof f=="number"){g=f;f=d.getAt(g)}else{g=d.indexOf(f)}n=this.getRow(g);l=Ext.fly(n).child(".ux-maximgb-treegrid-elbow-active");if(l){if(d.hasNextSiblingNode(f)){l.removeClass("ux-maximgb-treegrid-elbow-plus");l.removeClass("ux-maximgb-treegrid-elbow-end-plus");l.addClass("ux-maximgb-treegrid-elbow-minus")}else{l.removeClass("ux-maximgb-treegrid-elbow-plus");l.removeClass("ux-maximgb-treegrid-elbow-end-plus");l.addClass("ux-maximgb-treegrid-elbow-end-minus")}if(d.isVisibleNode(f)){c=d.getNodeChildren(f);for(e=0,h=c.length;e<h;e++){m=d.indexOf(c[e]);n=this.getRow(m);Ext.fly(n).setStyle("display","block");if(d.isExpandedNode(c[e])){this.expandRow(m)}}}}},collapseRow:function(d){var h=this.ds,g,c,f,k,e;if(typeof d=="number"){e=d;d=h.getAt(e)}else{e=h.indexOf(d)}k=this.getRow(e);pmel=Ext.fly(k).child(".ux-maximgb-treegrid-elbow-active");if(pmel){if(h.hasNextSiblingNode(d)){pmel.removeClass("ux-maximgb-treegrid-elbow-minus");pmel.removeClass("ux-maximgb-treegrid-elbow-end-minus");pmel.addClass("ux-maximgb-treegrid-elbow-plus")}else{pmel.removeClass("ux-maximgb-treegrid-elbow-minus");pmel.removeClass("ux-maximgb-treegrid-elbow-end-minus");pmel.addClass("ux-maximgb-treegrid-elbow-end-plus")}f=h.getNodeChildren(d);for(g=0,c=f.length;g<c;g++){e=h.indexOf(f[g]);k=this.getRow(e);Ext.fly(k).setStyle("display","none");this.collapseRow(e)}}},initData:function(d,c){Ext.ux.maximgb.treegrid.GridView.superclass.initData.call(this,d,c);if(this.ds){this.ds.un("activenodechange",this.onStoreActiveNodeChange,this);this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(d){d.on("activenodechange",this.onStoreActiveNodeChange,this);d.on("expandnode",this.onStoreExpandNode,this);d.on("collapsenode",this.onStoreCollapseNode,this)}},onStoreActiveNodeChange:function(m,c,g){var l,e,f,d,k=[],h=this.templates;if(g){l=this.ds.getNodeAncestors(g),l.reverse();l.push(g);for(e=0,f=l.length;e<f;e++){d=l[e];k.push(h.brd_item.apply({id:d.id,title:this.grid.i18n.breadcrumbs_tip,caption:d.get(this.cm.getDataIndex(this.cm.getIndexById(this.grid.master_column_id)))}))}this.breadcrumbs_el.update(this.grid.i18n.path_separator+h.brd_item.apply({id:"",title:this.grid.i18n.breadcrumbs_root_tip,caption:this.grid.root_title})+this.grid.i18n.path_separator+k.join(this.grid.i18n.path_separator))}else{this.setRootBreadcrumbs()}},setRootBreadcrumbs:function(){var c=this.templates;this.breadcrumbs_el.update(this.grid.i18n.path_separator+c.brd_item.apply({id:"",title:this.grid.i18n.breadcrumbs_root_tip,caption:this.grid.root_title}))},onLoad:function(d,c,e){var f=d.getLoadedNodeIdFromOptions(e);if(f===null){Ext.ux.maximgb.treegrid.GridView.superclass.onLoad.call(this,d,c,e)}},onStoreExpandNode:function(c,d){this.expandRow(d)},onStoreCollapseNode:function(c,d){this.collapseRow(d)}});Ext.ux.maximgb.treegrid.GridPanel=Ext.extend(Ext.ui.XGridPanel,{master_column_id:0,root_title:null,i18n:null,initComponent:function(){Ext.ux.maximgb.treegrid.GridPanel.superclass.initComponent.call(this);Ext.applyIf(this.i18n,Ext.ux.maximgb.treegrid.GridPanel.prototype.i18n);if(!this.root_title){this.root_title=this.title||this.i18n.root_title}this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this)},getView:function(){if(!this.view){this.view=new Ext.ux.maximgb.treegrid.GridView(this.viewConfig)}return this.view},onClick:function(f){var g=f.getTarget(),k=this.getView(),n=k.findRowIndex(g),l=this.getStore(),c=this.getSelectionModel(),d,h,m=true;if(n!==false){if(Ext.fly(g).hasClass("ux-maximgb-treegrid-elbow-active")){d=l.getAt(n);if(l.isExpandedNode(d)){l.collapseNode(d)}else{l.expandNode(d)}m=false}}else{if(Ext.fly(g).hasClass("ux-maximgb-treegrid-brditem")){h=Ext.id(g);h=h.substr(h.lastIndexOf("-")+1);if(h!=""){d=l.getById(h);n=l.indexOf(d);if(f.hasModifier()){if(l.isExpandedNode(d)){l.collapseNode(d)}else{l.expandNode(d)}}else{if(c.isSelected&&!c.isSelected(n)){c.selectRow(n)}}}else{c.clearSelections()}f.preventDefault()}}if(m){Ext.ux.maximgb.treegrid.GridPanel.superclass.onClick.call(this,f)}},onMouseDown:function(d){var c=d.getTarget();if(!Ext.fly(c).hasClass("ux-maximgb-treegrid-elbow-active")){Ext.ux.maximgb.treegrid.GridPanel.superclass.onMouseDown.call(this,d)}},onDblClick:function(k){var h=k.getTarget(),d=this.getView(),l=d.findRowIndex(h),f=this.getStore(),m=this.getSelectionModel(),c,g;if(!l&&Ext.fly(h).hasClass("ux-maximgb-treegrid-brditem")){g=Ext.id(h);g=g.substr(g.lastIndexOf("-")+1);if(g!=""){c=f.getById(g);l=f.indexOf(c);if(f.isExpandedNode(c)){f.collapseNode(c)}else{f.expandNode(c)}if(m.isSelected&&!m.isSelected(l)){m.selectRow(l)}}else{m.clearSelections()}}Ext.ux.maximgb.treegrid.GridPanel.superclass.onDblClick.call(this,k)},onTreeGridSelectionChange:function(e,d){var c;if(e.getSelected){c=e.getSelected();this.getStore().setActiveNode(c)}else{if(Ext.type(d)=="array"&&d.length>0){c=store.getAt(d[0]);this.getStore().setActiveNode(c)}else{throw"Unknown selection model applyed to the grid."}}}});Ext.ux.maximgb.treegrid.GridPanel.prototype.i18n={path_separator:" / ",root_title:"[root]",breadcrumbs_tip:"Click to select node, CTRL+Click to expand or collapse node, Double click to select and expand or collapse node.",breadcrumbs_root_tip:"Click to select the top level node."};Ext.ux.maximgb.treegrid.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(d,c){Ext.ux.maximgb.treegrid.PagingToolbar.superclass.onRender.call(this,d,c);this.updateUI()},getPageData:function(){var c=0,d=0;if(this.store){d=this.store.getActiveNodePageOffset();c=this.store.getActiveNodeTotalCount()}return{total:c,activePage:Math.ceil((d+this.pageSize)/this.pageSize),pages:c<this.pageSize?1:Math.ceil(c/this.pageSize)}},updateInfo:function(){var d=0,f=0,c=0,e;if(this.displayEl){if(this.store){f=this.store.getActiveNodePageOffset();d=this.store.getActiveNodeCount();c=this.store.getActiveNodeTotalCount()}e=d==0?this.emptyMsg:String.format(this.displayMsg,f+1,f+d,c);this.displayEl.update(e)}},updateUI:function(){var f=this.getPageData(),c=f.activePage,e=f.pages;this.afterTextItem.setText(String.format(this.afterPageText,f.pages));this.inputItem.setValue(c);this.first.setDisabled(c==1);this.prev.setDisabled(c==1);this.next.setDisabled(c==e);this.last.setDisabled(c==e);this.refresh.enable();this.updateInfo()},unbind:function(c){Ext.ux.maximgb.treegrid.PagingToolbar.superclass.unbind.call(this,c);c.un("activenodechange",this.onStoreActiveNodeChange,this)},bind:function(c){Ext.ux.maximgb.treegrid.PagingToolbar.superclass.bind.call(this,c);c.on("activenodechange",this.onStoreActiveNodeChange,this)},beforeLoad:function(c,d){Ext.ux.maximgb.treegrid.PagingToolbar.superclass.beforeLoad.call(this,c,d);if(d&&d.params){var e=this.getParams();if(d.params[e.start]===undefined){d.params[e.start]=0}if(d.params[e.limit]===undefined){d.params[e.limit]=this.pageSize}}},onClick:function(h){var d=this.store,g=d?d.getActiveNodePageOffset():0,f=d?d.getActiveNodeTotalCount():0;switch(h){case"first":this.doLoad(0);break;case"prev":this.doLoad(Math.max(0,g-this.pageSize));break;case"next":this.doLoad(g+this.pageSize);break;case"last":var c=f%this.pageSize;var e=c?(f-c):f-this.pageSize;this.doLoad(e);break;case"refresh":this.doLoad(g);break}},onStoreActiveNodeChange:function(d,e,c){if(this.rendered){this.updateUI()}}});Ext.ui.TreeGrid=Ext.extend(Ext.ux.maximgb.treegrid.GridPanel,{createPagingToolbar:function(d,c){var e=new Ext.ux.maximgb.treegrid.PagingToolbar(Ext.apply({pageSize:50,store:c,autoLoad:true,displayInfo:true},d));return e},createStore:function(c){return new Ext.ux.maximgb.treegrid.AdjacencyListStore(c)}});Ext.reg("treegrid",Ext.ui.TreeGrid);Ext.ns("Ext.ui");Ext.ui.ReportPanel=Ext.extend(Ext.ui.IPanel,{reportName:null,initComponent:function(){Ext.ui.ReportPanel.superclass.initComponent.call(this)},afterRender:function(){Ext.ui.ReportPanel.superclass.afterRender.call(this);this.mask=new Ext.LoadMask(this.getEl(),"报表加载中...");this.on("load",function(){this.mask.hide()},this)},load:function(d){d=d||{};d.params=d.params||{};var c=String.format("{0}?reportName={1}&{2}",Ext.url("/reportView/ReportView.jsp"),this.reportName,Ext.urlEncode(d.params));this.mask.show();this.loadPage(c,d.callback||Ext.emptyFn())}});Ext.layout.ColumnFieldLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,extraCls:"",scrollOffset:0,isValidParent:function(e,d){return true},fieldAdjustWidth:function(c,d){return d},renderItem:function(g,d,e){if(g&&!g.rendered){var f=e.dom.childNodes[d];g._wrapper=e.createChild({tag:"div",style:"text-align:center;",cls:"x-column"}).insertBefore(f)}if(g instanceof Ext.form.Field){g.adjustWidth=this.fieldAdjustWidth}if(g instanceof Ext.form.Hidden){g.width=0;Ext.layout.ColumnFieldLayout.superclass.renderItem.call(this,g,d,e)}else{Ext.layout.ColumnFieldLayout.superclass.renderItem.call(this,g,0,g._wrapper)}g.columnFit={hasAbsWidth:false,relWidth:0,calcRelWidth:0,calcAbsWidth:0};if(g instanceof Ext.Button){g.width=g.getEl().getWidth()}if(typeof g.width=="number"){if(g.setWidth){g.setWidth(g.width-g.getEl().getMargins("lr"))}g.columnFit.hasAbsWidth=true}else{if(typeof g.width=="string"&&g.width.indexOf("%")){g.columnFit.relWidth=parseInt(g.width)}}},onLayout:function(g,n){var k=g.items.items,l=k.length,q,e,t=0;if(!this.innerCt){n.addClass("x-column-layout-ct");this.innerCt=n.createChild({cls:"x-column-inner",style:"zoom:1;"});this.innerCt.createChild({cls:"x-clear"})}var v=Ext.isIE&&n.dom!=Ext.getBody().dom?n.getStyleSize():n.getViewSize();this.renderAll(g,this.innerCt);if(v.width<1&&v.height<1){return}var r=v.width-n.getPadding("lr")-this.scrollOffset,f=v.height-n.getPadding("tb"),s=r;this.innerCt.setWidth(r);var m=0,o=0,u=100;for(e=0;e<l;e++){q=k[e];if(q.columnFit.hasAbsWidth){s-=((q.getSize?q.getSize().width:q.getEl().getWidth())+q.getEl().getMargins("lr"))}else{if(!q.columnFit.relWidth){m++}}}s=s<0?0:s;for(e=0;e<l;e++){q=k[e];if(q.columnFit.relWidth){o+=q.columnFit.relWidth}t=Math.max(q.getSize?q.getSize().height:0,t)}if(o>u){u=o}var d=s-Math.floor(o/u*s);for(e=0;e<l;e++){q=k[e];if(!q.columnFit.hasAbsWidth){if(q.columnFit.relWidth){q.setSize(Math.floor(q.columnFit.relWidth/u*s)-q.getEl().getMargins("lr"),undefined)}else{if(d){q.setSize(Math.floor(d/m)-q.getEl().getMargins("lr"),undefined)}}}else{}if(q._wrapper&&q._wrapper.getHeight()<t){}}}});Ext.Container.LAYOUTS.columnfield=Ext.layout.ColumnFieldLayout;Ext.ns("Ext.ui");Ext.ui.Spacer=Ext.extend(Ext.BoxComponent,{autoEl:{tag:"div",html:"&nbsp;"},width:3});Ext.reg("spacer",Ext.ui.Spacer);Ext.ui.ColumnField=Ext.extend(Ext.Container,{isFormField:true,autoEl:{tag:"div",cls:"x-form-field",style:"_zoom:1;"},adjustSize:function(c,e){var d=Ext.form.Field.superclass.adjustSize.call(this,c,e);d.width=this.adjustWidth(this.el.dom.tagName,d.width);return d},adjustWidth:function(c,d){if(typeof d=="number"&&!Ext.isWebKit){if(Ext.isIE){if(!Ext.isStrict){return d-3}if(Ext.isStrict){return d-(Ext.isIE6?4:1)}}}return d},layout:"columnfield",isValid:function(){var c=true;this.items.each(function(d){if(!d.validate()){c=false}});return c},validate:function(){var c=true;this.items.each(function(d){if(d.isFormField&&!d.validate()){c=false}});return c},reset:function(){this.items.each(function(c){if(c.reset){c.reset()}})},findField:function(d){var c=this.items.get(d);if(!(c&&typeof c=="object")){this.items.each(function(e){if(e.isFormField&&(e.dataIndex==d||e.id==d||e.getName()==d)){c=e;return false}})}return c},disable:function(){this.items.each(function(c){c.disable()})},enable:function(){this.items.each(function(c){c.enable()})}});Ext.reg("columnfield",Ext.ui.ColumnField);Ext.ns("Ext.ui");Ext.ui.LogPanel=Ext.extend(Ext.Panel,{cacheSize:100,bodyStyle:"background-color:black;overflow:auto;padding:3 5 5 3;",initComponent:function(){var c=this;if(!this.logTpl){this.logTpl=new Ext.XTemplate('<tpl for="logs">',"<p style=\"color:#0c0;font-size: 12px;line-height: 16px;font-weight: 400;font-family: 'Inconsolata',Courier,sans-serif;\">{.}</p>","</tpl>")}this.bbar=["->","-",{iconCls:"lock",enableToggle:true,toggleHandler:function(d,e){if(e){c.lock()}else{c.unlock()}}},"-",{iconCls:"del",handler:function(){c.clear()}}];Ext.ui.LogPanel.superclass.initComponent.apply(this,arguments)},lock:function(){this.islock=true},unlock:function(){this.islock=false},clear:function(){this.body.update("");this.logCounter=0},log:function(){if(arguments.length==1){var c=arguments[0];if(Ext.isArray(c)){this.appendLog(c)}else{c=[c]}this.appendLog(c)}else{this.appendLog([].slice.call(arguments,0))}},logCounter:0,appendLog:function(c){if(this.islock===true&&this.logCounter>=this.cacheSize){return}this.logTpl.append(this.body,{logs:c});this.logCounter=this.logCounter+c.length;this.trimLog();this.scrollToButtom()},scrollToButtom:function(){var c=this.body.dom;if(c.scrollHeight&&this.islock!==true){c.scrollTop=c.scrollHeight}},trimLog:function(d){d=this.logCounter-this.cacheSize;var c=2;if(d>0){var f=this.body.dom;for(var e=0;e<d+c;e++){f.removeChild(f.firstChild)}this.logCounter=this.logCounter-(d+c)}}});Ext.reg("logpanel",Ext.ui.LogPanel);Ext.define("Ext.ui.GalleryPanel",{extend:"Ext.Panel",layout:"fit",initComponent:function(){this.storeConfig=this.storeConfig||{};this.viewConfig=this.viewConfig||{};this.store=this.store||new Ext.ui.CommonStore(this.storeConfig||{});this.viewConfig.store=this.store;this.view=this.view||new Ext.ui.GalleryView(this.viewConfig);this.items=[this.view];this.view.on("selectionchange",this.onViewSelectionChange,this);if(this.pagingConfig){this.bbar=this.createPagingToolbar(this.pagingConfig,this.store)}this.view.on("render",function(){if(this.store.getRange().length){var c=this;setTimeout(function(){c.refresh()},0)}});return this.callParent(arguments)},getView:function(){return this.view},toSearch:function(d,e,c){var f=this.store.baseParams;if(e!==null&&e!==undefined&&e!==""){f[d]=String(e)}else{if(Ext.type(d)=="object"){this.store.baseParams=d}else{if(Ext.type(d)=="string"){delete f[d]}}}this.store.load({params:{start:0},callback:c||Ext.emptyFn})},createPagingToolbar:function(d,c){var e=new Ext.ui.XPagingToolbar(Ext.apply({pageSize:10,store:c,autoLoad:true,displayInfo:true},d));return e},onViewSelectionChange:function(e,d){var c=d.length;this.setTitle("共选择了 ("+c+" )张图片。")}});Ext.define("Ext.ui.GalleryView",{extend:"Ext.DataView",autoHeight:true,multiSelect:false,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:"没有图片可以展示",cls:"images-view",singleSelect:true,removable:false,defaultMapping:{name:"name",url:"url"},initComponent:function(){var f='<a class="tr-clear-trigger" href="#" style="{0}">X</a>';var g="display:none;";if(this.removable===true){g=""}var d=Ext.apply({},this.defaultMapping);this.mapping=Ext.apply(d,this.mapping||{});var c=this.imgWidth||80;var e=this.imgHeight||60;f=String.format(f,g);if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap">',String.format('<div class="thumb"><img src="{url}" title="{name}" width="{0}px" height="{1}px">{2}</div>',c,e,f),'<span class="x-editable">{shortName}</span></div>',"</tpl>",'<div class="x-clear"></div>')}this.on("click",this.onClearClick,this);this.callParent(arguments);this.addEvents("beforeitemremove","itemremove")},onClearClick:function(g,d,f,h){if(this.fireEvent("beforeitemremove",g,d,f,h)===false){return false}var c=h.getTarget(".tr-clear-trigger",f);if(c){g.store.removeAt(d);this.fireEvent("itemremove",g,d,f,h)}},prepareData:function(c){c.name=this.mappingData(c,this.mapping.name);c.url=this.mappingData(c,this.mapping.url);c.shortName=Ext.util.Format.ellipsis(c.name,15);return c},mappingData:function(d,c){if(Ext.isFunction(c)){return c(d)}return d[c]}});